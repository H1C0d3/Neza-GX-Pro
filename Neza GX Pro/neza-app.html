<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Neza Browser - Aplicación Completa</title>
    <style>
        :root {
            --neza-primary: #00D4AA;
            --neza-primary-hover: #00B89A;
            --neza-primary-light: rgba(0, 212, 170, 0.3);
            --neza-primary-shadow: rgba(0, 212, 170, 0.4);
            --neza-secondary: #1BCED6;
            --neza-accent: #00A693;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
            user-select: none;
        }

        /* ============ SCROLLBAR GLOBAL PERSONALIZADO - NEZA STYLE ============ */
        /* Aplicar a todos los elementos con scroll */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 212, 170, 0.3) rgba(0, 212, 170, 0.05);
        }

        /* Scrollbar WebKit (Chrome, Safari, Edge, Opera) */
        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        *::-webkit-scrollbar-track {
            background: rgba(0, 212, 170, 0.05);
            border-radius: 5px;
        }

        *::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, 
                rgba(0, 212, 170, 0.4) 0%, 
                rgba(0, 212, 170, 0.6) 50%, 
                rgba(0, 212, 170, 0.4) 100%);
            border-radius: 5px;
            border: 2px solid rgba(26, 26, 26, 0.8);
            transition: all 0.3s ease;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, 
                rgba(0, 212, 170, 0.6) 0%, 
                rgba(0, 212, 170, 0.8) 50%, 
                rgba(0, 212, 170, 0.6) 100%);
            border-color: rgba(26, 26, 26, 0.6);
            box-shadow: 0 0 10px rgba(0, 212, 170, 0.4);
        }

        *::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, 
                rgba(0, 212, 170, 0.7) 0%, 
                var(--neza-primary) 50%, 
                rgba(0, 212, 170, 0.7) 100%);
        }

        /* Scrollbar para esquinas */
        *::-webkit-scrollbar-corner {
            background: rgba(0, 212, 170, 0.05);
        }

        /* ASEGURAR EVENTOS DE CLICK EN ELEMENTOS INTERACTIVOS */
        .homepage-shortcut-card,
        .nav-button,
        .tab,
        .new-tab-button,
        .control-button,
        .address-input,
        .copy-url-button,
        .tab-close,
        button {
            pointer-events: auto;
            cursor: pointer;
        }

        input[type="text"] {
            pointer-events: auto;
        }

        .address-input {
            cursor: text;
        }

        .app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Title Bar */
        .title-bar {
            height: 32px !important;
            background-color: #2a2a2a !important;
            display: flex !important;
            align-items: center;
            justify-content: flex-end;
            padding: 0 8px;
            border-bottom: 1px solid #3a3a3a;
            position: relative !important;
            -webkit-app-region: drag;
            z-index: 2000 !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .control-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer !important;
            transition: opacity 0.2s;
            -webkit-app-region: no-drag !important;
            pointer-events: auto !important;
            z-index: 3000 !important;
            position: relative !important;
        }

        .control-button.minimize { background-color: #ffbd2e; }
        .control-button.maximize { background-color: #28ca42; }
        .control-button.close { background-color: #ff5f57; }

        .control-button:hover {
            opacity: 0.8;
            transform: scale(1.1);
        }

        .control-button:active {
            transform: scale(0.9);
        }

        /* Iconos internos para las bolitas */
        .control-button.minimize:hover::after {
            content: '−';
            color: #333;
            font-size: 10px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .control-button.maximize:hover::after {
            content: '□';
            color: #333;
            font-size: 8px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .control-button.close:hover::after {
            content: '×';
            color: #333;
            font-size: 10px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .control-button {
            position: relative;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer !important;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
            position: relative;
            -webkit-app-region: no-drag !important;
            pointer-events: auto !important;
            z-index: 7000 !important;
        }

        .brand:hover {
            background-color: #3a3a3a;
            box-shadow: 0 0 10px var(--neza-primary-light);
        }

        /* Neza Logo Dropdown Menu */
        .brand-dropdown {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: inline-block;
            z-index: 6000 !important;
            pointer-events: auto !important;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2a2a2a;
            min-width: 220px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            z-index: 5000 !important;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
            margin-top: 8px;
            overflow: hidden;
            animation: dropdownSlideIn 0.3s ease-out;
        }

        @keyframes dropdownSlideIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            text-decoration: none;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #3a3a3a;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: #3a3a3a;
            color: var(--neza-primary);
        }

        .dropdown-item .icon {
            margin-right: 12px;
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .dropdown-item.stealth-mode {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            color: #fff;
            position: relative;
            overflow: hidden;
        }

        .dropdown-item.stealth-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139, 69, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .dropdown-item.stealth-mode:hover::before {
            left: 100%;
        }

        .dropdown-item.stealth-mode:hover {
            background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
            color: #8b45ff;
            box-shadow: inset 0 0 20px rgba(139, 69, 255, 0.1);
        }

        /* Stealth Mode Panel Styles */
        .stealth-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .stealth-mode-overlay.show {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        .stealth-mode-panel {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border-radius: 16px;
            border: 1px solid #3a3a3a;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            animation: stealthPanelSlideIn 0.4s ease-out;
            display: flex;
            flex-direction: column;
        }

        @keyframes stealthPanelSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .stealth-header {
            background: linear-gradient(135deg, #8b45ff, #6b35cc);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3a3a3a;
        }

        .stealth-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stealth-icon {
            font-size: 24px;
        }

        .stealth-header h2 {
            margin: 0;
            color: white;
            font-size: 20px;
            font-weight: 600;
        }

        .close-stealth {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 20px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-stealth:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .stealth-content {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .stealth-description {
            text-align: center;
            margin-bottom: 24px;
        }

        .stealth-description p {
            color: #cccccc;
            margin: 0;
            font-size: 14px;
        }

        .stealth-layers {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .stealth-layer {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #3a3a3a;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stealth-layer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139, 69, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .stealth-layer:hover::before {
            left: 100%;
        }

        .stealth-layer:hover {
            background: rgba(139, 69, 255, 0.1);
            border-color: #8b45ff;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(139, 69, 255, 0.2);
        }

        .layer-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(139, 69, 255, 0.2);
            border-radius: 8px;
            flex-shrink: 0;
        }

        .layer-info h3 {
            margin: 0 0 4px 0;
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .layer-info p {
            margin: 0;
            color: #cccccc;
            font-size: 12px;
            line-height: 1.4;
        }

        .brand-logo {
            width: 20px;
            height: 20px;
            object-fit: contain;
            border-radius: 4px;
        }

        .brand-logo-full {
            height: 24px;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 212, 170, 0.3));
            transition: all 0.3s ease;
        }

        .brand:hover .brand-logo-full {
            filter: drop-shadow(0 2px 8px rgba(0, 212, 170, 0.5));
            transform: scale(1.05);
        }

        .brand-icon {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--neza-primary), var(--neza-primary-hover));
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .title-bar-controls-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Navigation Bar */
        .navigation-bar {
            height: 48px !important;
            background-color: #2a2a2a !important;
            display: flex !important;
            align-items: center;
            padding: 0 16px;
            gap: 12px;
            border-bottom: 1px solid #3a3a3a;
            -webkit-app-region: no-drag;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 1500 !important;
            position: relative !important;
        }

        .nav-button {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #ffffff;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 16px;
        }

        .nav-button:hover { 
            background-color: #3a3a3a; 
            transform: scale(1.1);
            color: var(--neza-primary);
        }

        .nav-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Music Control Button */
        .music-control-btn {
            position: relative;
            overflow: hidden;
        }

        .music-control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(0, 212, 170, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .music-control-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        .music-control-btn.active {
            background: var(--neza-primary);
            color: #000;
        }

        /* Music Panel Overlay */
        .music-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            animation: fadeIn 0.3s ease-out;
        }

        .music-panel-overlay[style*="display: flex"],
        .music-panel-overlay[style*="display:flex"] {
            display: flex;
            pointer-events: all;
        }

        .music-panel {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 2px solid var(--neza-primary);
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            box-shadow: 0 20px 60px rgba(0, 212, 170, 0.3);
            animation: slideUp 0.4s ease-out;
            overflow: hidden;
        }

        .music-panel-header {
            background: linear-gradient(135deg, var(--neza-primary), var(--neza-secondary));
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #000;
        }

        .music-header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .music-icon-large {
            font-size: 32px;
            animation: musicPulse 2s infinite;
        }

        .music-header-text h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
        }

        .music-header-text p {
            margin: 5px 0 0 0;
            font-size: 12px;
            opacity: 0.8;
        }

        .remote-tab-indicator {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.5);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 10px;
            margin-top: 3px;
            color: #FFD700;
            animation: pulseGlow 2s infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                background: rgba(255, 215, 0, 0.2);
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
            }
            50% { 
                background: rgba(255, 215, 0, 0.4);
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            }
        }

        .close-panel-btn {
            background: rgba(0, 0, 0, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            color: #000;
            transition: all 0.2s ease;
        }

        .close-panel-btn:hover {
            background: rgba(0, 0, 0, 0.4);
            transform: scale(1.1);
        }

        .panel-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .refresh-btn {
            background: rgba(0, 150, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            color: #0096ff;
            transition: all 0.2s ease;
        }

        .refresh-btn:hover {
            background: rgba(0, 150, 255, 0.4);
            transform: scale(1.1);
        }

        .debug-btn {
            background: rgba(255, 165, 0, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            color: #FFA500;
            transition: all 0.2s ease;
        }

        .debug-btn:hover {
            background: rgba(255, 165, 0, 0.4);
            transform: scale(1.1);
        }

        .music-panel-content {
            padding: 25px;
        }

        /* Current Track Info */
        .current-track-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(0, 212, 170, 0.2);
        }

        .track-artwork {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--neza-primary), var(--neza-secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .track-details {
            flex: 1;
        }

        .track-title {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 5px;
        }

        .track-artist {
            font-size: 14px;
            color: var(--neza-primary);
            margin-bottom: 3px;
        }

        .track-source {
            font-size: 12px;
            color: #888;
        }

        /* Progress Bar */
        .music-progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .progress-time {
            font-size: 12px;
            color: #888;
            min-width: 35px;
            text-align: center;
        }

        .progress-bar-container {
            flex: 1;
            height: 6px;
            background: #3a3a3a;
            border-radius: 3px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .progress-track {
            width: 100%;
            height: 100%;
            background: #3a3a3a;
            border-radius: 3px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neza-primary), var(--neza-secondary));
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            position: absolute;
            top: 0;
            left: 0;
        }

        .progress-thumb {
            width: 14px;
            height: 14px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            left: 0%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: left 0.3s ease;
        }

        /* Main Controls */
        .main-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .control-btn.secondary {
            width: 40px;
            height: 40px;
        }

        .control-btn.primary {
            width: 50px;
            height: 50px;
            font-size: 18px;
        }

        .control-btn.play-pause-main {
            width: 65px;
            height: 65px;
            background: var(--neza-primary);
            color: #000;
            font-size: 24px;
            border: none;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn.play-pause-main:hover {
            background: var(--neza-primary-hover);
        }

        .control-btn.active {
            background: var(--neza-primary);
            color: #000;
        }

        /* Volume Control */
        .volume-control {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .volume-icon {
            font-size: 18px;
            color: var(--neza-primary);
        }

        .volume-slider-container {
            flex: 1;
        }

        .volume-slider {
            width: 100%;
            height: 4px;
            background: #3a3a3a;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--neza-primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-percent {
            font-size: 12px;
            color: #888;
            min-width: 35px;
            text-align: center;
        }

        /* Additional Controls */
        .additional-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .extra-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 8px;
            color: #fff;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .extra-btn:hover {
            background: rgba(0, 212, 170, 0.1);
            border-color: var(--neza-primary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
        }

        @keyframes fadeOut {
            from { 
                opacity: 1; 
                backdrop-filter: blur(10px);
            }
            to { 
                opacity: 0; 
                backdrop-filter: blur(0px);
            }
        }

        @keyframes musicPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ===============================================
           SETTINGS PANEL STYLES - Neza DESIGN
           =============================================== */

        .settings-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .settings-panel-overlay.show {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        .settings-panel {
            background: linear-gradient(135deg, #1e1e1e 0%, #252525 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 1200px;
            height: 80%;
            max-height: 700px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateY(30px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .settings-panel-overlay.show .settings-panel {
            transform: translateY(0) scale(1);
        }

        .settings-panel-header {
            background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
            padding: 20px 25px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .settings-icon-large {
            font-size: 32px;
            filter: drop-shadow(0 0 10px rgba(64, 224, 208, 0.5));
        }

        .settings-header-text h3 {
            color: #ffffff;
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .settings-header-text p {
            color: #888;
            margin: 2px 0 0 0;
            font-size: 14px;
        }

        .close-panel-btn {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-panel-btn:hover {
            background: #ff3742;
            transform: scale(1.05);
        }

        .settings-panel-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .settings-sidebar {
            width: 280px;
            background: linear-gradient(180deg, #252525 0%, #1e1e1e 100%);
            border-right: 1px solid #333;
            padding: 10px 0;
            overflow-y: auto;
        }

        .settings-nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            margin: 2px 0;
        }

        .settings-nav-item:hover {
            background: rgba(64, 224, 208, 0.1);
            border-left-color: rgba(64, 224, 208, 0.3);
        }

        .settings-nav-item.active {
            background: rgba(64, 224, 208, 0.15);
            border-left-color: #40e0d0;
            color: #40e0d0;
        }

        .settings-nav-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .settings-nav-text {
            font-size: 14px;
            font-weight: 500;
            color: #ffffff;
        }

        .settings-nav-item.active .settings-nav-text {
            color: #40e0d0;
        }

        .settings-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: linear-gradient(135deg, #1e1e1e 0%, #252525 100%);
        }

        .settings-content h2 {
            color: #ffffff;
            font-size: 28px;
            margin: 0 0 8px 0;
            font-weight: 600;
        }

        .section-description {
            color: #888;
            font-size: 14px;
            margin: 0 0 25px 0;
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        .settings-group {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-group h3 {
            color: #ffffff;
            font-size: 16px;
            margin: 0 0 12px 0;
            font-weight: 600;
        }

        .settings-group h4 {
            color: #ffffff;
            font-size: 15px;
            margin: 0 0 4px 0;
            font-weight: 500;
        }

        .settings-toggle-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .settings-toggle-item:last-child {
            margin-bottom: 0;
        }

        .toggle-info {
            flex: 1;
        }

        .toggle-info p {
            color: #888;
            font-size: 13px;
            margin: 0;
            line-height: 1.4;
        }

        .feature-badge {
            background: linear-gradient(135deg, #40e0d0, #00bcd4);
            color: #000;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 6px;
            margin-left: 8px;
            text-transform: uppercase;
        }

        /* Toggle Switch */
        .Neza-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .Neza-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: .3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #40e0d0, #00bcd4);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        /* Form Elements */
        .Neza-select, .Neza-input {
            width: 100%;
            padding: 10px 12px;
            background: #2a2a2a;
            color: #ffffff;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .Neza-select:focus, .Neza-input:focus {
            outline: none;
            border-color: #40e0d0;
            box-shadow: 0 0 0 2px rgba(64, 224, 208, 0.2);
        }

        .Neza-select-small {
            padding: 6px 8px;
            background: #2a2a2a;
            color: #ffffff;
            border: 1px solid #444;
            border-radius: 6px;
            font-size: 12px;
            width: 100px;
        }

        .Neza-select-small:focus {
            outline: none;
            border-color: #40e0d0;
        }

        /* Permission Grid */
        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .permission-icon {
            font-size: 16px;
        }

        .permission-name {
            flex: 1;
            color: #ffffff;
            font-size: 13px;
        }

        /* Buttons */
        .Neza-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .Neza-btn.primary {
            background: linear-gradient(135deg, #40e0d0, #00bcd4);
            color: #000;
        }

        .Neza-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(64, 224, 208, 0.3);
        }

        .Neza-btn.secondary {
            background: #444;
            color: #ffffff;
            border: 1px solid #555;
        }

        .Neza-btn.secondary:hover {
            background: #555;
            transform: translateY(-2px);
        }

        /* About Section */
        .about-content {
            text-align: center;
        }

        .about-logo {
            margin-bottom: 30px;
        }

        .Neza-logo-large {
            font-size: 64px;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 20px rgba(64, 224, 208, 0.5));
        }

        .Neza-logo-image {
            max-width: 200px;
            height: auto;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(64, 224, 208, 0.3));
            transition: all 0.3s ease;
        }

        .Neza-logo-image:hover {
            filter: drop-shadow(0 0 30px rgba(64, 224, 208, 0.6));
            transform: scale(1.05);
        }

        .about-logo h3 {
            color: #40e0d0;
            font-size: 32px;
            margin: 10px 0 5px 0;
        }

        .version {
            color: #888;
            font-size: 16px;
            font-style: italic;
        }

        .about-info {
            text-align: left;
            max-width: 400px;
            margin: 0 auto 30px auto;
        }

        .info-item {
            margin-bottom: 10px;
            color: #ffffff;
            font-size: 14px;
        }

        .info-item strong {
            color: #40e0d0;
        }

        .about-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .coming-soon {
            text-align: center;
            color: #888;
            font-size: 18px;
            margin-top: 50px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .address-bar {
            flex: 1;
            display: flex;
            align-items: center;
            background-color: #3a3a3a;
            border-radius: 8px;
            padding: 0 12px;
            height: 36px;
            position: relative;
        }

        .address-bar:focus-within {
            background-color: #4a4a4a;
            box-shadow: 0 0 0 2px var(--neza-primary-light);
        }

        .address-input {
            flex: 1;
            border: none;
            background: transparent;
            color: #ffffff;
            font-size: 14px;
            outline: none;
            padding: 0 8px;
        }

        .address-input::placeholder {
            color: #888;
            font-style: italic;
        }

        .copy-url-button {
            position: absolute;
            right: 8px;
            background: transparent;
            border: none;
            color: #888;
            font-size: 14px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 28px;
            height: 24px;
            opacity: 0.6;
        }
        
        .copy-url-button.has-url {
            opacity: 1;
            color: var(--neza-primary);
        }

        .copy-url-button:hover {
            background-color: var(--neza-primary);
            color: #ffffff;
            transform: scale(1.05);
        }

        .copy-url-button:active {
            transform: scale(0.95);
        }

        .copy-url-button.copied {
            background-color: #4CAF50;
            color: #ffffff;
        }

        /* ===============================================
           BROWSER MENU CONTEXTUAL - Neza DESIGN
           =============================================== */

        .browser-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            z-index: 15000;
            display: none;
            align-items: flex-start;
            justify-content: flex-end;
            padding: 80px 20px 20px 20px;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            pointer-events: none;
        }

        .browser-menu-overlay.show {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        .browser-menu {
            background: linear-gradient(135deg, #1e1e1e 0%, #252525 100%);
            border-radius: 12px;
            min-width: 280px;
            max-width: 350px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            overflow: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .browser-menu-overlay.show .browser-menu {
            transform: translateY(0) scale(1);
        }

        .browser-menu-header {
            background: linear-gradient(135deg, var(--neza-primary), var(--neza-secondary));
            padding: 15px 20px;
            color: #000;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .browser-menu-content {
            padding: 10px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            color: #ffffff;
            font-size: 14px;
            width: 100%;
            text-align: left;
        }

        .menu-item:hover {
            background: rgba(0, 212, 170, 0.1);
            color: var(--neza-primary);
            transform: translateX(5px);
        }

        .menu-item-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .menu-item-text {
            flex: 1;
        }

        .menu-item-shortcut {
            font-size: 12px;
            color: #888;
            opacity: 0.7;
        }

        .menu-separator {
            height: 1px;
            background: #333;
            margin: 5px 0;
        }

        /* ============ ZOOM CONTROLS STYLES ============ */
        
        .zoom-controls-section {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin: 4px 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .zoom-controls-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .zoom-header-icon {
            font-size: 14px;
            color: var(--neza-primary);
        }

        .zoom-header-text {
            font-size: 12px;
            color: #cccccc;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: space-between;
        }

        .zoom-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 32px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .zoom-button:hover {
            background: var(--neza-primary);
            border-color: var(--neza-primary);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 212, 170, 0.3);
        }

        .zoom-button:active {
            transform: translateY(0);
        }

        .zoom-level-container {
            flex: 1;
            margin: 0 4px;
        }

        .zoom-level-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            padding: 6px 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
            min-width: 45px;
        }

        .zoom-level-input:focus {
            outline: none;
            border-color: var(--neza-primary);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 2px rgba(0, 212, 170, 0.2);
        }

        .zoom-level-input:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .zoom-out span {
            font-size: 18px;
            line-height: 1;
        }

        .zoom-in span {
            font-size: 16px;
            line-height: 1;
        }

        .zoom-reset span {
            font-size: 14px;
        }

        .fullscreen-toggle span {
            font-size: 12px;
        }

        /* Responsive para controles de zoom */
        @media (max-width: 350px) {
            .zoom-controls {
                flex-wrap: wrap;
                gap: 2px;
            }
            
            .zoom-button {
                width: 28px;
                height: 26px;
                font-size: 12px;
            }
            
            .zoom-level-input {
                font-size: 11px;
                padding: 4px 2px;
                min-width: 40px;
            }
        }

        .stealth-menu-item {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.1));
            border-left: 3px solid #8A2BE2;
        }

        .stealth-menu-item .menu-item-icon {
            color: #8A2BE2;
            font-size: 18px;
        }

        .stealth-menu-item:hover {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2));
            color: #DA70D6;
            border-left-color: #DA70D6;
        }

        /* ===============================================
           Neza STEALTH MODE PANEL (Enhanced version)
           =============================================== */

        /* Ya definido arriba, esta es la versi\u00f3n mejorada que sobrescribe */

        .stealth-mode-panel {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 50%, #0a0a1a 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 30px 90px rgba(138, 43, 226, 0.4);
            border: 2px solid #8A2BE2;
            transform: translateY(30px) scale(0.9);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            animation: stealthGlow 3s ease-in-out infinite;
        }
        
        /* Scrollbar personalizada para el modal */
        .stealth-mode-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .stealth-mode-panel::-webkit-scrollbar-track {
            background: rgba(138, 43, 226, 0.1);
            border-radius: 4px;
        }
        
        .stealth-mode-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8A2BE2, #AA6BE2);
            border-radius: 4px;
        }
        
        .stealth-mode-panel::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #AA6BE2, #CA8BE2);
        }

        @keyframes stealthGlow {
            0%, 100% { 
                box-shadow: 0 30px 90px rgba(138, 43, 226, 0.4), 0 0 30px rgba(138, 43, 226, 0.2);
            }
            50% { 
                box-shadow: 0 30px 90px rgba(138, 43, 226, 0.6), 0 0 50px rgba(138, 43, 226, 0.4);
            }
        }

        .stealth-mode-overlay.show .stealth-mode-panel {
            transform: translateY(0) scale(1);
        }

        .stealth-mode-header {
            background: linear-gradient(135deg, #8A2BE2, #4B0082, #6A0DAD);
            padding: 25px;
            text-align: center;
            color: #ffffff;
            position: relative;
        }

        .stealth-mode-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: stealthShine 2s ease-in-out infinite;
        }

        @keyframes stealthShine {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
            100% { transform: translateX(100%); }
        }

        .stealth-icon {
            font-size: 48px;
            margin-bottom: 15px;
            animation: ghostFloat 3s ease-in-out infinite;
        }

        @keyframes ghostFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        .stealth-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(138, 43, 226, 0.8);
        }

        .stealth-subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-style: italic;
        }

        .stealth-mode-content {
            padding: 30px;
        }

        .stealth-description {
            text-align: center;
            color: #cccccc;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .stealth-layers {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .stealth-layer {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stealth-layer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(138, 43, 226, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .stealth-layer:hover::before {
            left: 100%;
        }

        .stealth-layer:hover {
            background: rgba(138, 43, 226, 0.1);
            border-color: #8A2BE2;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.3);
        }

        .stealth-layer.selected {
            background: rgba(138, 43, 226, 0.2);
            border-color: #DA70D6;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
        }

        .stealth-layer-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .stealth-layer-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8A2BE2, #4B0082);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stealth-layer-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }

        .stealth-layer-badge {
            background: linear-gradient(135deg, #8A2BE2, #DA70D6);
            color: #000;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 8px;
            text-transform: uppercase;
            margin-left: auto;
        }

        .stealth-layer-description {
            color: #cccccc;
            font-size: 14px;
            line-height: 1.5;
        }

        .stealth-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .stealth-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stealth-btn.primary {
            background: linear-gradient(135deg, #8A2BE2, #4B0082);
            color: #ffffff;
        }

        .stealth-btn.primary:hover {
            background: linear-gradient(135deg, #9932CC, #6A0DAD);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(138, 43, 226, 0.4);
        }

        .stealth-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #cccccc;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stealth-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .close-stealth-btn {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 10;
        }

        .close-stealth-btn:hover {
            background: #ff3742;
            transform: scale(1.05);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .homepage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #1a1a1a;
            padding: 40px 20px;
            /* Anti-zoom properties */
            overflow-y: auto;
            overflow-x: hidden;
            zoom: 1;
            transform: scale(1);
            transform-origin: center center;
            z-index: 1;
            pointer-events: auto;
        }

        .homepage:not(.active) {
            display: none;
            pointer-events: none;
        }

        .homepage-content {
            text-align: center;
            max-width: 1000px;
            width: 100%;
            /* Enhanced scaling for better visibility */
            transform: scale(1.15);
            transform-origin: center center;
            position: relative;
            z-index: 10;
        }

        .welcome-logo {
            margin-bottom: 60px;
            margin-top: 40px;
            text-align: center;
            padding: 20px 0;
        }

        .main-logo {
            max-width: 350px;
            max-height: 140px;
            object-fit: contain;
            filter: drop-shadow(0 4px 20px var(--neza-primary-light));
            width: auto;
            height: auto;
            margin: 20px 0;
        }

        .welcome-title {
            font-size: 42px;
            font-weight: 400;
            color: #ffffff;
            margin-bottom: 50px;
            margin-top: 30px;
            line-height: 1.3;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            max-width: 100%;
            padding: 0 20px;
        }



        /* Homepage Search Bar */
        .homepage-search-container {
            margin-bottom: 50px;
            margin-top: 30px;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        .homepage-search-bar {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 0 20px;
            height: 50px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.3);
            transition: all 0.3s ease;
        }

        .homepage-search-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 16px;
            color: #333;
            outline: none;
            margin: 0 15px;
        }

        .homepage-search-input::placeholder {
            color: #888;
        }

        .search-engine-indicator,
        .search-voice-btn {
            background: transparent;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .search-engine-indicator:hover,
        .search-voice-btn:hover {
            background: rgba(0, 212, 170, 0.1);
            color: var(--neza-primary);
        }

        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .quick-action-button {
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: none;
            border-radius: 16px;
            padding: 20px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #3a3a3a;
        }

        .quick-action-button:hover {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: var(--neza-primary);
        }

        .chat-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(42, 42, 42, 0.85);
            backdrop-filter: blur(10px);
            color: #888;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0.6;
        }

        .chat-fab:hover {
            opacity: 1;
            background: linear-gradient(135deg, var(--neza-primary), var(--neza-primary-hover));
            color: white;
            border-color: var(--neza-primary);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 212, 170, 0.3);
        }

        /* Chat FAB se oculta en homepage para no interferir */
        .homepage.active ~ .chat-fab {
            opacity: 0.3;
        }

        .homepage.active ~ .chat-fab:hover {
            opacity: 1;
        }

        /* WebView */
        .webview-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 2;
            pointer-events: none;
        }

        .webview-container.active {
            display: flex;
            flex-direction: column;
            pointer-events: auto;
        }

        .webview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            pointer-events: auto;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #3a3a3a;
            border-top: 3px solid var(--neza-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-bar {
            height: 24px;
            background-color: #2a2a2a;
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 12px;
            color: #888;
            border-top: 1px solid #3a3a3a;
        }

        .url-status {
            margin-left: auto;
            color: var(--neza-primary);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .homepage {
            animation: fadeIn 0.6s ease-out;
        }

        .webview-container {
            animation: fadeIn 0.4s ease-out;
        }

        /* Tabs */
        .tab-bar {
            height: 36px !important;
            background-color: #2a2a2a !important;
            display: flex !important;
            align-items: center;
            padding: 0 8px;
            border-bottom: none;
            overflow-x: auto;
            -webkit-app-region: no-drag;
            position: relative !important;
            z-index: 1000 !important;
            visibility: visible !important;
            opacity: 1 !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
        }

        .tab {
            height: 28px;
            width: 120px;
            min-width: 120px;
            max-width: 120px;
            flex-shrink: 0;
            background-color: #3a3a3a;
            border: none;
            border-radius: 8px 8px 0 0;
            color: #ffffff;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            margin-right: 2px;
            font-size: 11px;
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
            gap: 4px;
        }

        .tab.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .tab.drag-over {
            border-left: 3px solid var(--neza-primary);
        }

        /* Menú contextual de pestañas */
        .tab-context-menu {
            position: fixed;
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8), 0 0 20px rgba(0, 212, 170, 0.2);
            z-index: 10000;
            min-width: 220px;
            padding: 6px 0;
            display: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .tab-context-menu.show {
            display: block;
            animation: contextMenuShow 0.2s ease-out;
        }

        @keyframes contextMenuShow {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-5px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .tab-context-menu-item {
            padding: 10px 16px;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .tab-context-menu-item:hover {
            background: linear-gradient(90deg, rgba(0, 212, 170, 0.15), transparent);
            border-left-color: var(--neza-primary);
            padding-left: 20px;
        }

        .tab-context-menu-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .tab-context-menu-item.disabled:hover {
            background: transparent;
            border-left-color: transparent;
            padding-left: 16px;
        }

        .tab-context-menu-separator {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 170, 0.2), transparent);
            margin: 6px 0;
        }

        .tab-context-menu-item-icon {
            width: 18px;
            text-align: center;
            font-size: 14px;
        }

        .tab-context-menu-item-shortcut {
            margin-left: auto;
            font-size: 11px;
            opacity: 0.5;
            font-family: monospace;
        }

        .tab .tab-title {
            flex: 1;
            overflow: hidden;
            position: relative;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .tab .tab-title-text {
            display: inline-block;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .tab .tab-title-text.scrolling {
            animation: scrollText 4s linear infinite;
        }

        .tab:hover .tab-title-text.scrolling {
            animation-play-state: paused;
        }

        /* Botón de audio en pestañas */
        .tab-audio-button {
            display: none;
            width: 18px;
            height: 18px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            margin-left: 6px;
            margin-right: 2px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 12px;
            color: #ffffff;
            align-items: center;
            justify-content: center;
            opacity: 0;
            position: relative;
            z-index: 10;
            flex-shrink: 0;
        }

        /* El botón aparece cuando la pestaña tiene audio Y se hace hover */
        .tab.has-audio:hover .tab-audio-button {
            display: flex;
            opacity: 1;
        }

        /* El botón SIEMPRE visible cuando está silenciado */
        .tab.has-audio.audio-muted .tab-audio-button,
        .tab-audio-button.visible {
            display: flex !important;
            opacity: 1 !important;
            color: #ff4757;
            background: rgba(255, 71, 87, 0.3);
            border: 1px solid rgba(255, 71, 87, 0.5);
            animation: mutedPulse 2s ease-in-out infinite;
            box-shadow: 0 0 8px rgba(255, 71, 87, 0.4);
        }

        .tab-audio-button:hover {
            background-color: var(--neza-primary) !important;
            transform: scale(1.2);
            color: white !important;
        }

        /* Animación para botón silenciado */
        @keyframes mutedPulse {
            0% { 
                box-shadow: 0 0 8px rgba(255, 71, 87, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 15px rgba(255, 71, 87, 0.6);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 8px rgba(255, 71, 87, 0.4);
                transform: scale(1);
            }
        }

        /* Hover específico para botón silenciado */
        .tab.has-audio.audio-muted .tab-audio-button:hover {
            background: rgba(255, 71, 87, 0.5) !important;
            transform: scale(1.15) !important;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.7);
        }

        .tab.has-audio {
            padding-right: 6px;
        }

        /* Indicador visual adicional para pestañas silenciadas */
        .tab.audio-muted {
            border-bottom: 3px solid #ff4757 !important;
            background: linear-gradient(to bottom, 
                rgba(51, 51, 51, 1) 0%, 
                rgba(51, 51, 51, 1) 70%, 
                rgba(255, 71, 87, 0.1) 100%) !important;
        }

        .tab.audio-muted .tab-title {
            color: #ff6b6b !important;
        }

        /* Pequeño badge para indicar silencio */
        .tab.audio-muted::after {
            content: '🔇';
            position: absolute;
            top: -5px;
            right: 5px;
            font-size: 10px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: mutedBlink 3s ease-in-out infinite;
        }

        @keyframes mutedBlink {
            0%, 70%, 100% { opacity: 1; }
            35% { opacity: 0.5; }
        }

        /* Asegurar que el layout del tab sea correcto */
        .tab {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .tab .tab-title {
            flex: 1;
            min-width: 0;
            margin-right: 4px;
        }

        /* Overlay flotante sobre videos */
        .video-pip-overlay {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            z-index: 9999;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            border: 1px solid var(--neza-primary);
        }

        .video-pip-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .video-pip-overlay:hover {
            background: var(--neza-primary);
            transform: translateX(-50%) scale(1.05);
        }

        /* Video flotante (Picture-in-Picture) */
        .pip-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 320px;
            height: 200px;
            background: #000;
            border-radius: 12px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: none;
            overflow: hidden;
            border: 2px solid var(--neza-primary);
            resize: both;
            min-width: 200px;
            min-height: 120px;
            max-width: 800px;
            max-height: 600px;
        }

        .pip-container.active {
            display: block;
        }

        .pip-video {
            width: 100%;
            height: calc(100% - 35px);
            border: none;
            border-radius: 8px 8px 0 0;
        }

        .pip-video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0 8px;
        }

        .pip-video-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pip-video-btn:hover {
            background: var(--neza-primary);
            transform: scale(1.1);
        }

        .pip-time-display {
            color: #ccc;
            font-size: 11px;
            margin: 0 8px;
            font-family: monospace;
        }

        .pip-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
        }

        .pip-control-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .pip-control-btn:hover {
            background: var(--neza-primary);
        }

        .pip-container.dragging {
            transition: none;
        }

        .tab.active {
            background-color: #1a1a1a;
            box-shadow: 0 2px 8px var(--neza-primary-light);
            border-bottom: 2px solid var(--neza-primary);
        }

        .tab:hover {
            background-color: #4a4a4a;
            transform: translateY(-1px);
        }

        /* Stealth Mode Tabs */
        .tab.stealth-tab {
            position: relative;
            overflow: hidden;
        }

        .tab.stealth-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(138, 43, 226, 0.3), transparent);
            transition: left 0.8s ease;
            animation: stealthTabGlow 3s ease-in-out infinite;
        }

        @keyframes stealthTabGlow {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(138, 43, 226, 0.3);
            }
            50% { 
                box-shadow: 0 0 15px rgba(138, 43, 226, 0.6);
            }
        }

        .tab.stealth-tab:hover::before {
            left: 100%;
        }

        .tab.stealth-tab .tab-title-text {
            color: #DA70D6;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }

        .tab.stealth-tab.active {
            border-bottom-color: #8A2BE2;
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.5);
        }

        .tab-title {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            margin-right: 8px;
            position: relative;
        }

        .tab-title-text {
            display: inline-block;
            animation: none;
            transition: transform 0.3s ease;
        }

        .tab-title.scrolling .tab-title-text {
            animation: scrollText 8s linear infinite;
        }

        @keyframes scrollText {
            0% { 
                transform: translateX(0); 
            }
            20% { 
                transform: translateX(0); 
            }
            80% { 
                transform: translateX(calc(-100% + 120px)); 
            }
            100% { 
                transform: translateX(calc(-100% + 120px)); 
            }
        }

        .tab-title-text.scrolling {
            animation: scrollText 4s linear infinite;
        }

        .tab-title {
            position: relative;
        }

        .tab-title-text {
            display: inline-block;
            white-space: nowrap;
            transition: all 0.3s ease;
        }        .tab-title:hover .tab-title-text {
            animation-play-state: paused;
        }

        .tab-close {
            margin-left: 8px;
            font-size: 14px;
            opacity: 0.7;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
            background: transparent;
            border: none;
            color: #ffffff;
            cursor: pointer;
            min-width: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab-close:hover {
            opacity: 1;
            background-color: var(--neza-primary);
            transform: scale(1.1);
        }

        .new-tab-button {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: #ffffff;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
            margin-left: 4px;
        }

        .new-tab-button:hover {
            background-color: #3a3a3a;
        }

        /* ============ RESPONSIVE DESIGN ============ */
        
        /* Media Queries para diferentes tamaños de pantalla */
        @media (max-width: 1200px) {
            .title-bar {
                padding: 0 8px;
            }
            
            .brand-dropdown .brand-name {
                display: none; /* Ocultar texto en pantallas medianas */
            }
            
            .tabs-container {
                min-width: 200px; /* Asegurar ancho mínimo */
                max-width: 65%; /* Limitar ancho de pestañas */
            }
            
            .tab {
                min-width: 100px;
                max-width: 160px;
            }
            
            .navigation-bar {
                padding: 0 12px;
                gap: 8px;
            }
            
            .address-bar {
                min-width: 180px;
            }
        }

        @media (max-width: 900px) {
            .title-bar {
                padding: 0 6px;
            }
            
            .tabs-container {
                min-width: 180px; /* Asegurar ancho mínimo */
                max-width: 55%;
            }
            
            .tab {
                min-width: 80px;
                max-width: 130px;
            }
            
            .tab-title {
                font-size: 12px;
            }
            
            .navigation-bar {
                padding: 0 8px;
                gap: 6px;
            }
            
            .nav-button {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
            
            .address-bar {
                min-width: 140px;
            }
            
            .address-input {
                font-size: 14px;
            }
            
            .homepage-content {
                padding: 20px;
            }
            
            .welcome-title {
                font-size: 36px;
            }
            
            .main-logo {
                max-width: 250px;
                max-height: 100px;
            }
        }

        @media (max-width: 700px) {
            .title-bar {
                padding: 0 4px;
            }
            
            .brand-dropdown {
                position: relative;
                left: auto;
                transform: none;
            }
            
            .tabs-container {
                min-width: 160px; /* Asegurar ancho mínimo */
                max-width: 45%;
            }
            
            .tab {
                min-width: 70px;
                max-width: 110px;
            }
            
            .tab-title {
                font-size: 11px;
                max-width: 50px;
            }
            
            .navigation-bar {
                padding: 0 4px;
                gap: 4px;
            }
            
            .nav-button {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }
            
            .address-bar {
                min-width: 100px;
            }
            
            .homepage-search-container {
                margin: 0 20px 40px 20px;
            }
            
            .homepage-search-bar {
                height: 45px;
                padding: 0 15px;
            }
            
            .welcome-title {
                font-size: 28px;
            }
            
            .main-logo {
                max-width: 200px;
                max-height: 80px;
            }
        }

        @media (max-width: 500px) {
            .title-bar {
                height: 28px;
                padding: 0 2px;
            }
            
            .title-bar-controls {
                gap: 2px;
            }
            
            .control-button {
                width: 24px;
                height: 24px;
                font-size: 10px;
            }
            
            .navigation-bar {
                height: 40px;
                padding: 0 2px;
                gap: 2px;
            }
            
            .nav-button {
                width: 20px;
                height: 20px;
                font-size: 10px;
            }
            
            .tabs-container {
                min-width: 140px; /* Asegurar ancho mínimo */
                max-width: 40%; /* Aumentar un poco para que sean visibles */
                overflow-x: auto; /* Permitir scroll horizontal si es necesario */
            }
            
            .tab {
                min-width: 60px;
                max-width: 90px;
                height: 24px;
                padding: 2px 6px;
                flex-shrink: 0; /* Evitar que se compriman demasiado */
            }
            
            .tab-title {
                font-size: 10px;
                max-width: 35px;
            }
            
            .tab-close {
                font-size: 10px;
                width: 14px;
                height: 14px;
            }
            
            .new-tab-button {
                width: 20px;
                height: 20px;
                font-size: 12px;
                flex-shrink: 0;
            }
            
            .address-bar {
                min-width: 80px;
            }
            
            .address-input {
                font-size: 12px;
                padding: 4px 8px;
            }
            
            .copy-url-button {
                padding: 4px 6px;
                font-size: 10px;
            }
            
            .homepage-content {
                padding: 10px;
            }
            
            .welcome-title {
                font-size: 20px;
                margin-bottom: 20px;
            }
            
            .main-logo {
                max-width: 150px;
                max-height: 60px;
            }
            
            .homepage-search-container {
                margin: 0 10px 20px 10px;
            }
            
            .homepage-search-bar {
                height: 40px;
                padding: 0 10px;
            }
            
            .homepage-search-input {
                font-size: 14px;
            }
            
            /* Ocultar algunos elementos en pantallas muy pequeñas */
            .nav-button[title="Favoritos"],
            .music-control-btn {
                display: none;
            }
        }

        /* Límites mínimos absolutos */
        .app {
            min-width: 320px;
            min-height: 240px;
        }
        
        .title-bar {
            min-height: 24px;
        }
        
        .navigation-bar {
            min-height: 32px;
        }
        
        .tab {
            min-width: 50px;
        }
        
        .address-bar {
            min-width: 80px;
        }

        /* ============ RESPONSIVE ANIMATIONS ============ */
        
        /* Animación suave para tabs al redimensionar */
        .tabs-container {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab-title {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Efecto de "respiración" para elementos que se adaptan */
        @keyframes adaptiveBreath {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        /* Aplicar animación al cambiar tamaños */
        .tab:hover {
            animation: adaptiveBreath 1.5s ease-in-out;
        }
        
        /* Transiciones suaves para navegación */
        .navigation-bar,
        .address-bar,
        .nav-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Efecto de pulso en elementos críticos cuando se redimensiona */
        @keyframes resizePulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 212, 170, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 212, 170, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 212, 170, 0); }
        }
        
        /* Activar pulso en redimensionamiento extremo */
        @media (max-width: 500px) {
            .tab.active {
                animation: resizePulse 2s ease-out;
            }
        }
        
        /* Smooth scaling para logos y elementos gráficos */
        .main-logo,
        .brand-logo {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Efecto de "squeeze" para pestañas en espacios muy pequeños */
        @keyframes tabSqueeze {
            0% { transform: scaleX(1); opacity: 1; }
            50% { transform: scaleX(0.95); opacity: 0.8; }
            100% { transform: scaleX(1); opacity: 1; }
        }
        
        /* Aplicar squeeze en mobile cuando hay muchas pestañas */
        @media (max-width: 500px) {
            .tabs-container:hover .tab {
                animation: tabSqueeze 0.6s ease-in-out;
            }
        }

        /* Prevenir overflow en elementos críticos */
        .tab-title,
        .address-input {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .tabs-container {
            overflow: hidden;
        }
        
        /* Asegurar que los panels se mantengan responsivos */
        .stealth-mode-overlay,
        .settings-panel-overlay,
        .music-panel-overlay {
            padding: 10px;
            box-sizing: border-box;
        }
        
        @media (max-width: 700px) {
            .stealth-mode-panel,
            .settings-panel,
            .music-panel {
                width: 95%;
                max-width: none;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 500px) {
            .stealth-mode-panel,
            .settings-panel,
            .music-panel {
                width: 98%;
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        /* ============ CUSTOM SCROLLBAR STYLES ============ */
        
        /* Scrollbar personalizado para panels */
        .stealth-content::-webkit-scrollbar,
        .stealth-mode-panel::-webkit-scrollbar,
        .settings-panel::-webkit-scrollbar,
        .music-panel::-webkit-scrollbar {
            width: 8px;
        }

        .stealth-content::-webkit-scrollbar-track,
        .stealth-mode-panel::-webkit-scrollbar-track,
        .settings-panel::-webkit-scrollbar-track,
        .music-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .stealth-content::-webkit-scrollbar-thumb,
        .stealth-mode-panel::-webkit-scrollbar-thumb,
        .settings-panel::-webkit-scrollbar-thumb,
        .music-panel::-webkit-scrollbar-thumb {
            background: var(--neza-primary);
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .stealth-content::-webkit-scrollbar-thumb:hover,
        .stealth-mode-panel::-webkit-scrollbar-thumb:hover,
        .settings-panel::-webkit-scrollbar-thumb:hover,
        .music-panel::-webkit-scrollbar-thumb:hover {
            background: var(--neza-primary-light);
            box-shadow: 0 0 8px rgba(0, 212, 170, 0.4);
        }

        /* Scrollbar para pestañas en móvil */
        .tabs-container::-webkit-scrollbar {
            height: 4px;
        }

        .tabs-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .tabs-container::-webkit-scrollbar-thumb {
            background: var(--neza-primary);
            border-radius: 2px;
        }

        .tabs-container::-webkit-scrollbar-thumb:hover {
            background: var(--neza-primary-light);
        }

        /* ============ IMPROVED SCROLLING BEHAVIOR ============ */
        
        .stealth-content,
        .stealth-mode-panel,
        .settings-panel,
        .music-panel {
            scroll-behavior: smooth;
        }

        /* Indicador visual de scroll disponible */
        .stealth-content::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(transparent, rgba(26, 26, 26, 0.8));
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stealth-content.has-scroll::after {
            opacity: 1;
        }

        /* ============ STEALTH PANEL SCROLL ENHANCEMENTS ============ */
        
        .stealth-layers {
            position: relative;
        }

        /* Mejorar visibilidad de opciones en pantallas pequeñas */
        @media (max-height: 600px) {
            .stealth-mode-panel {
                max-height: 95vh;
            }
            
            .stealth-content {
                padding: 16px;
            }
            
            .stealth-layer {
                margin-bottom: 12px;
                padding: 12px;
            }
            
            .layer-title {
                font-size: 16px;
            }
            
            .layer-description {
                font-size: 12px;
            }
        }

        @media (max-height: 400px) {
            .stealth-mode-panel {
                max-height: 98vh;
            }
            
            .stealth-header {
                padding: 12px 16px;
            }
            
            .stealth-content {
                padding: 12px;
            }
            
            .stealth-layer {
                margin-bottom: 8px;
                padding: 8px 12px;
            }
        }

        /* ============ Neza SUPPORT PANEL STYLES ============ */
        
        .support-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .support-panel-overlay.show {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        .support-panel {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border-radius: 16px;
            border: 1px solid #3a3a3a;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            animation: supportPanelSlideIn 0.4s ease-out;
        }

        @keyframes supportPanelSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .support-header {
            background: linear-gradient(135deg, #00D4AA, #00A085);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3a3a3a;
            border-radius: 16px 16px 0 0;
        }

        .support-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .support-icon {
            font-size: 24px;
        }

        .support-logo h2 {
            color: white;
            font-size: 20px;
            margin: 0;
            font-weight: 600;
        }

        .close-support {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-support:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .support-content {
            padding: 24px;
        }

        .support-description {
            text-align: center;
            margin-bottom: 24px;
        }

        .support-description p {
            color: #cccccc;
            margin: 0;
            font-size: 16px;
            line-height: 1.5;
        }

        .support-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .support-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .support-option:hover {
            background: rgba(0, 212, 170, 0.1);
            border-color: var(--neza-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 170, 0.2);
        }

        .option-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .option-info h3 {
            color: white;
            font-size: 16px;
            margin: 0 0 8px 0;
            font-weight: 600;
        }

        .option-info p {
            color: #cccccc;
            font-size: 14px;
            margin: 0;
            line-height: 1.4;
        }

        /* ============ UPDATE PANEL STYLES ============ */
        
        .update-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 10002;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .update-panel-overlay.show {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        .update-panel {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border-radius: 20px;
            border: 1px solid rgba(0, 212, 170, 0.3);
            width: 90%;
            max-width: 650px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 212, 170, 0.2);
            animation: updatePanelSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes updatePanelSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .update-header {
            background: linear-gradient(135deg, var(--neza-primary), #00A8FF);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(0, 212, 170, 0.3);
        }

        .update-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .update-icon {
            font-size: 28px;
            animation: updateIconRotate 2s linear infinite;
        }

        @keyframes updateIconRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .update-logo h2 {
            color: white;
            font-size: 22px;
            margin: 0;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .close-update {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 28px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-update:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .update-content {
            padding: 40px 30px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .update-state {
            width: 100%;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .update-state h3 {
            font-size: 24px;
            margin: 20px 0 10px;
            color: white;
        }

        .update-state p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 15px;
            margin: 10px 0;
        }

        /* Spinner de carga */
        .update-spinner {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
        }

        .spinner-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 4px solid transparent;
            border-top-color: var(--neza-primary);
            border-radius: 50%;
            animation: spinnerRotate 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        .spinner-ring:nth-child(2) {
            border-top-color: #00A8FF;
            animation-delay: 0.2s;
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
        }

        .spinner-ring:nth-child(3) {
            border-top-color: rgba(0, 212, 170, 0.5);
            animation-delay: 0.4s;
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
        }

        @keyframes spinnerRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Iconos de estado */
        .update-success-icon,
        .update-available-icon,
        .update-error-icon {
            font-size: 80px;
            margin: 0 auto 20px;
            animation: iconBounce 0.6s ease;
        }

        @keyframes iconBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Barra de progreso */
        .update-progress {
            margin: 30px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neza-primary), #00A8FF);
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
            box-shadow: 0 0 10px rgba(0, 212, 170, 0.5);
        }

        .progress-fill.indeterminate {
            width: 40%;
            animation: progressIndeterminate 1.5s ease-in-out infinite;
        }

        @keyframes progressIndeterminate {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(350%); }
        }

        .progress-text {
            display: block;
            margin-top: 10px;
            color: var(--neza-primary);
            font-size: 14px;
            font-weight: 600;
        }

        /* Versión info */
        .version-info,
        .version-comparison {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .version-card {
            background: rgba(0, 212, 170, 0.1);
            border: 2px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-width: 150px;
        }

        .version-card.current {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .version-card.new {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.2), rgba(0, 168, 255, 0.2));
            border-color: var(--neza-primary);
            box-shadow: 0 0 20px rgba(0, 212, 170, 0.3);
        }

        .version-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .version-number {
            font-size: 28px;
            font-weight: 700;
            color: white;
        }

        .version-arrow {
            font-size: 32px;
            color: var(--neza-primary);
            animation: arrowPulse 1.5s ease-in-out infinite;
        }

        @keyframes arrowPulse {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }

        /* Changelog */
        .update-changelog {
            text-align: left;
            margin: 30px auto;
            max-width: 500px;
            background: rgba(0, 212, 170, 0.05);
            border: 1px solid rgba(0, 212, 170, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .update-changelog h4 {
            color: var(--neza-primary);
            font-size: 16px;
            margin: 0 0 15px 0;
        }

        .update-changelog ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .update-changelog li {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .update-changelog li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--neza-primary);
            font-weight: bold;
        }

        /* Download stats */
        .download-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 212, 170, 0.05);
            border-radius: 10px;
        }

        .download-stats span {
            color: var(--neza-primary);
            font-size: 14px;
            font-weight: 600;
        }

        /* Info box */
        .restart-info {
            margin: 30px 0;
        }

        .info-box {
            background: rgba(0, 168, 255, 0.1);
            border: 2px solid rgba(0, 168, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .info-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .info-box p {
            margin: 0;
            text-align: left;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Error details */
        .error-details {
            background: rgba(255, 95, 86, 0.1);
            border: 1px solid rgba(255, 95, 86, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-align: left;
            max-height: 150px;
            overflow-y: auto;
        }

        /* Botones de actualización */
        .update-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .update-btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .update-btn.primary {
            background: linear-gradient(135deg, var(--neza-primary), #00A8FF);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 212, 170, 0.4);
        }

        .update-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 212, 170, 0.6);
        }

        .update-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .update-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* ============ FEEDBACK CENTER STYLES ============ */
        
        .feedback-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .feedback-panel-overlay.show {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        .feedback-panel {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border-radius: 16px;
            border: 1px solid #3a3a3a;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            animation: feedbackPanelSlideIn 0.4s ease-out;
        }

        @keyframes feedbackPanelSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .feedback-header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3a3a3a;
            border-radius: 16px 16px 0 0;
        }

        .feedback-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .feedback-icon {
            font-size: 24px;
        }

        .feedback-logo h2 {
            color: white;
            font-size: 20px;
            margin: 0;
            font-weight: 600;
        }

        .close-feedback {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-feedback:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .feedback-content {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--neza-primary);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px rgba(0, 212, 170, 0.2);
        }

        .form-group select option {
            background: #2a2a2a;
            color: white;
        }

        .form-group small {
            color: #999;
            font-size: 12px;
            margin-top: 4px;
            display: block;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .btn-cancel,
        .btn-submit {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #cccccc;
        }

        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn-submit {
            background: linear-gradient(45deg, var(--neza-primary), var(--neza-primary-light));
            color: white;
        }

        .btn-submit:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.3);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Scrollbar personalizado para paneles de soporte */
        .support-panel::-webkit-scrollbar,
        .feedback-panel::-webkit-scrollbar {
            width: 8px;
        }

        .support-panel::-webkit-scrollbar-track,
        .feedback-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .support-panel::-webkit-scrollbar-thumb,
        .feedback-panel::-webkit-scrollbar-thumb {
            background: var(--neza-primary);
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .support-panel::-webkit-scrollbar-thumb:hover,
        .feedback-panel::-webkit-scrollbar-thumb:hover {
            background: var(--neza-primary-light);
            box-shadow: 0 0 8px rgba(0, 212, 170, 0.4);
        }

        /* Responsive design para paneles de soporte */
        @media (max-width: 700px) {
            .support-panel,
            .feedback-panel {
                width: 95%;
                max-width: none;
                margin: 0 auto;
            }
            
            .support-options {
                grid-template-columns: 1fr;
            }
            
            .support-option {
                padding: 16px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn-cancel,
            .btn-submit {
                width: 100%;
            }

            .support-header,
            .feedback-header {
                padding: 16px;
            }

            .support-content,
            .feedback-content {
                padding: 20px;
            }
        }

        @media (max-width: 500px) {
            .support-panel,
            .feedback-panel {
                width: 98%;
                max-height: 90vh;
            }
            
            .support-option {
                flex-direction: column;
                text-align: center;
                gap: 12px;
            }
            
            .option-icon {
                font-size: 28px;
            }
            
            .support-description p {
                font-size: 14px;
            }
        }

        /* ============ RESPONSIVE DESIGN IMPROVEMENTS ============ */
        
        /* Pantallas pequeñas (menos de 1024px) */
        @media (max-width: 1024px) {
            .homepage-content {
                padding: 20px;
                max-width: 90%;
            }
            
            .main-logo {
                width: 120px;
                height: auto;
            }
            
            .welcome-title {
                font-size: 28px;
                line-height: 1.3;
            }
            
            .quick-actions {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                max-width: 400px;
            }
            
            .stealth-mode-panel,
            .settings-panel,
            .music-panel {
                width: 95%;
                max-height: 85vh;
                margin: 20px auto;
            }
        }
        
        /* Pantallas medianas (menos de 800px) */
        @media (max-width: 800px) {
            .navigation-bar {
                padding: 8px;
                flex-wrap: wrap;
            }
            
            .address-bar {
                min-width: 200px;
                flex: 1;
            }
            
            .nav-button {
                padding: 8px;
                font-size: 14px;
            }
            
            .tab-bar {
                overflow-x: auto;
                scrollbar-width: thin;
            }
            
            .tab {
                min-width: 120px;
                flex-shrink: 0;
            }
            
            .homepage-search-bar {
                width: 100%;
                max-width: none;
                margin: 0 10px;
            }
            
            .welcome-title {
                font-size: 24px;
                padding: 0 20px;
            }
        }
        
        /* Pantallas pequeñas (menos de 600px) */
        @media (max-width: 600px) {
            .title-bar {
                padding: 0 4px;
            }
            
            .brand span {
                display: none; /* Ocultar texto, solo mostrar logo */
            }
            
            .navigation-bar {
                flex-direction: column;
                gap: 8px;
                padding: 8px 4px;
            }
            
            .address-bar {
                width: 100%;
                order: 2;
            }
            
            .nav-buttons-left,
            .nav-buttons-right {
                display: flex;
                justify-content: space-between;
                width: 100%;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .quick-action-button {
                padding: 12px;
                font-size: 14px;
            }
            
            .main-logo {
                width: 80px;
            }
            
            .welcome-title {
                font-size: 20px;
                line-height: 1.2;
            }
            
            .stealth-mode-panel,
            .settings-panel,
            .music-panel {
                width: 98%;
                max-height: 90vh;
                margin: 10px auto;
                padding: 15px;
            }
            
            .stealth-header,
            .settings-header,
            .music-header {
                padding: 12px 15px;
                font-size: 18px;
            }
            
            .stealth-layer {
                padding: 12px;
                margin-bottom: 8px;
            }
            
            .layer-title {
                font-size: 16px;
            }
            
            .layer-description {
                font-size: 13px;
            }
        }
        
        /* Altura reducida (menos de 600px de altura) */
        @media (max-height: 600px) {
            .homepage-content {
                padding: 15px;
            }
            
            .main-logo {
                width: 60px;
                margin-bottom: 15px;
            }
            
            .welcome-title {
                font-size: 18px;
                margin-bottom: 15px;
            }
            
            .homepage-search-container {
                margin: 15px 0;
            }
            
            .quick-actions {
                margin-top: 15px;
            }
            
            .quick-action-button {
                padding: 8px 16px;
                font-size: 13px;
            }
            
            .stealth-mode-panel,
            .settings-panel,
            .music-panel {
                max-height: 95vh;
            }
        }
        
        /* Ajustes para pantallas muy pequeñas */
        @media (max-width: 480px) {
            .homepage-search-input {
                font-size: 14px;
                padding: 10px 12px;
            }
            
            .search-engine-indicator,
            .search-voice-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            
            .control-button {
                width: 10px;
                height: 10px;
            }
            
            .tab {
                min-width: 100px;
                font-size: 12px;
                padding: 6px 8px;
            }
            
            .new-tab-button {
                width: 30px;
                height: 30px;
                font-size: 16px;
            }
        }
        
        /* Scroll personalizado para pestañas en móvil */
        .tab-bar::-webkit-scrollbar {
            height: 3px;
        }
        
        .tab-bar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-bar::-webkit-scrollbar-thumb {
            background: var(--neza-primary);
            border-radius: 3px;
        }
        
        .tab-bar::-webkit-scrollbar-thumb:hover {
            background: var(--neza-primary-hover);
        }

        /* ============ MODO PRIVADO STYLES ============ */
        
        /* Tema para modo normal - Azul elegante y moderno */
        .normal-mode {
            --Neza-bg-primary: #2a2d47;
            --Neza-bg-secondary: #363a5a;
            --Neza-bg-tertiary: #434770;
            --Neza-text-primary: #ffffff;
            --Neza-accent-primary: #00D4AA;
        }
        
        .normal-mode .app {
            background: linear-gradient(135deg, #2a2d47 0%, #363a5a 50%, #434770 100%);
            color: var(--neza-text-primary);
        }
        
        .normal-mode .title-bar {
            background: rgba(26, 26, 46, 0.95);
            border-bottom: 1px solid rgba(0, 212, 170, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .normal-mode .navigation-bar {
            background: rgba(26, 26, 46, 0.95);
            border-bottom: 1px solid rgba(0, 212, 170, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .normal-mode .tab-bar {
            background: rgba(22, 33, 62, 0.95);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 100;
            display: flex !important;
            visibility: visible !important;
            height: 40px;
            min-height: 40px;
        }
        
        .normal-mode .tab {
            background: rgba(255, 255, 255, 0.1);
            color: var(--neza-text-primary);
            border: 1px solid rgba(0, 212, 170, 0.2);
        }
        
        .normal-mode .tab.active {
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid #00D4AA;
            box-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }
        
        .normal-mode .homepage {
            background: linear-gradient(135deg, #1a1d2e 0%, #16213e 50%, #0f172a 100%);
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100vh - 120px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 0;
        }
        
        /* ===== NUEVO HOMEPAGE MODERNO Y RESPONSIVE ===== */
        
        /* Header compacto y elegante */
        .homepage-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 40px 20px 30px;
            width: 100%;
            max-width: 1200px;
            position: relative;
            z-index: 2;
        }

        .Neza-logo-container {
            flex-shrink: 0;
        }

        .Neza-logo-img {
            width: 48px !important;
            height: 48px !important;
            object-fit: contain !important;
            border-radius: 8px !important;
            border: none !important;
            background: transparent !important;
            transition: transform 0.3s ease;
        }

        .Neza-logo-img:hover {
            transform: scale(1.1);
        }

        .brand-text {
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
            margin: 0;
            letter-spacing: -0.5px;
        }

        /* Contenido principal moderno */
        .homepage-main-content {
            width: 100%;
            max-width: 900px;
            padding: 0 20px;
            display: flex;
            flex-direction: column;
            gap: 40px;
            z-index: 2;
            position: relative;
        }

        /* Buscador moderno y elegante */
        .homepage-search-section {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .homepage-search-box {
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        .homepage-search-input-new {
            width: 100%;
            padding: 18px 60px 18px 24px;
            font-size: 16px;
            font-weight: 400;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            color: white;
            outline: none;
            backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .homepage-search-input-new:focus {
            border-color: rgba(0, 212, 170, 0.6);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 32px rgba(0, 212, 170, 0.15);
            transform: translateY(-2px);
        }

        .homepage-search-input-new::placeholder {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 400;
        }

        .homepage-search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #00D4AA 0%, #00A8FF 100%);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .homepage-search-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.4);
        }

        /* Accesos rápidos modernos y responsive */
        .homepage-quick-access {
            width: 100%;
        }

        .homepage-section-title {
            font-size: 18px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .homepage-shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(clamp(120px, 15vw, 140px), 1fr));
            gap: clamp(12px, 2vw, 16px);
            width: 100%;
            max-width: min(600px, 90vw);
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .homepage-shortcut-card {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: clamp(12px, 2vw, 16px);
            padding: clamp(16px, 3vw, 20px) clamp(12px, 2vw, 16px);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .homepage-shortcut-card:hover {
            transform: translateY(-4px) scale(1.02);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 212, 170, 0.3);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 212, 170, 0.1);
        }

        .homepage-shortcut-icon {
            width: clamp(36px, 5vw, 44px);
            height: clamp(36px, 5vw, 44px);
            margin: 0 auto clamp(12px, 2vw, 16px);
            background: linear-gradient(135deg, #00D4AA 0%, #00A8FF 100%);
            border-radius: clamp(10px, 1.5vw, 12px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(16px, 2.5vw, 20px);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 212, 170, 0.2);
        }

        .homepage-shortcut-title {
            font-size: clamp(12px, 1.8vw, 14px);
            font-weight: 600;
            color: white;
            margin-bottom: clamp(4px, 0.8vw, 6px);
            line-height: 1.2;
        }

        .homepage-shortcut-desc {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
            line-height: 1.3;
        }

        /* Estadísticas hermosas */
        .homepage-stats-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(0, 212, 170, 0.1);
        }

        .homepage-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .homepage-stat-item {
            text-align: center;
        }

        .homepage-stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #00D4AA;
            margin-bottom: 8px;
        }

        .homepage-stat-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Footer hermoso */
        .homepage-footer {
            text-align: center;
            padding: 30px 0;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            position: relative;
            z-index: 2;
        }
        
        .normal-mode .welcome-title {
            background: linear-gradient(135deg, #00D4AA 0%, #00A8FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .normal-mode .main-logo {
            animation: logoGlow 2s infinite alternate;
            box-shadow: 0 0 30px rgba(0, 212, 170, 0.5);
        }
        
        @keyframes logoGlow {
            0% { box-shadow: 0 0 20px rgba(0, 212, 170, 0.5); }
            100% { box-shadow: 0 0 40px rgba(0, 212, 170, 0.8); }
        }
        
        /* Tema oscuro para modo privado (actual) */
        .private-mode {
            --Neza-bg-primary: #0a0a0a;
            --Neza-bg-secondary: #1a1a1a;
            --Neza-bg-tertiary: #2a2a2a;
            --Neza-text-primary: #ffffff;
            --Neza-accent-primary: #8A2BE2;
        }
        
        /* Badge de privacidad en título */
        .privacy-badge {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #8A2BE2, #9370DB);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3);
            animation: privatePulse 2s infinite;
        }
        
        @keyframes privatePulse {
            0%, 100% { box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3); }
            50% { box-shadow: 0 2px 12px rgba(138, 43, 226, 0.5); }
        }
        
        /* Indicador de modo privado */
        .privacy-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #8A2BE2, #9370DB);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
            z-index: 9999;
            cursor: default;
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .privacy-indicator .privacy-icon {
            font-size: 14px;
        }
        
        .privacy-indicator .privacy-close {
            margin-left: 8px;
            cursor: pointer;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: background 0.2s;
        }
        
        .privacy-indicator .privacy-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Pestañas privadas diferenciadas */
        .private-mode .tab {
            background: linear-gradient(135deg, #2d1b4e, #3d2b5e);
            border-left: 2px solid #8A2BE2;
        }
        
        .private-mode .tab.active {
            background: linear-gradient(135deg, #4d3b6e, #5d4b7e);
            border-bottom: 2px solid #9370DB;
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.2);
        }
        
        /* Homepage en modo privado */
        .private-mode .homepage {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
        }
        
        .private-mode .welcome-title {
            color: #9370DB;
            text-shadow: 0 0 10px rgba(147, 112, 219, 0.3);
        }
        
        .private-mode .quick-action-button {
            border: 1px solid #8A2BE2;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(147, 112, 219, 0.1));
        }
        
        .private-mode .quick-action-button:hover {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(147, 112, 219, 0.2));
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.2);
        }

        /* ===== RESPONSIVE DESIGN COMPLETAMENTE REDISEÑADO ===== */
        
        /* Tablets y pantallas medianas */
        @media (max-width: 1024px) {
            .homepage-main-content {
                max-width: 800px;
                gap: 32px;
            }
            
            .homepage-shortcuts-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 12px;
                max-width: 500px;
            }
            
            .homepage-search-box {
                max-width: 450px;
            }
        }

        /* Móviles en horizontal y tablets pequeñas */
        @media (max-width: 768px) {
            .homepage-header {
                padding: 30px 20px 20px;
                gap: 12px;
            }
            
            .Neza-logo-img {
                width: 40px !important;
                height: 40px !important;
            }
            
            .brand-text {
                font-size: 20px;
            }
            
            .homepage-main-content {
                gap: 28px;
                padding: 0 16px;
            }
            
            .homepage-search-input-new {
                padding: 16px 50px 16px 20px;
                font-size: 15px;
            }
            
            .homepage-shortcuts-grid {
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
                gap: 10px;
            }
            
            .homepage-shortcut-card {
                padding: 16px 12px;
            }
            
            .homepage-shortcut-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
                margin-bottom: 12px;
            }
        }

        /* Móviles verticales con scroll horizontal */
        @media (max-width: 480px) {
            .homepage-header {
                padding: 24px 16px 16px;
                flex-direction: column;
                gap: 8px;
            }
            
            .brand-text {
                font-size: 18px;
            }
            
            .homepage-main-content {
                gap: 24px;
                padding: 0 12px;
            }
            
            .homepage-search-input-new {
                padding: 14px 45px 14px 18px;
                font-size: 14px;
            }
            
            /* Contenedor para scroll horizontal */
            .homepage-quick-access {
                width: 100%;
                overflow: hidden;
            }
            
            .homepage-shortcuts-grid {
                display: flex;
                overflow-x: auto;
                overflow-y: hidden;
                scroll-behavior: smooth;
                gap: 12px;
                max-width: none;
                width: max-content;
                padding: 8px 0 16px 0;
                margin: 0;
                -webkit-overflow-scrolling: touch;
            }
            
            .homepage-shortcut-card {
                flex: 0 0 auto;
                width: 120px;
                padding: 14px 10px;
                min-width: 120px;
            }
            
            .homepage-shortcut-icon {
                width: 32px;
                height: 32px;
                font-size: 16px;
                margin-bottom: 10px;
            }
            
            .homepage-shortcut-title {
                font-size: 12px;
            }
            
            .homepage-shortcut-desc {
                font-size: 11px;
            }
            
            /* Scrollbar personalizada para móviles */
            .homepage-shortcuts-grid::-webkit-scrollbar {
                height: 4px;
            }
            
            .homepage-shortcuts-grid::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 2px;
            }
            
            .homepage-shortcuts-grid::-webkit-scrollbar-thumb {
                background: rgba(0, 212, 170, 0.6);
                border-radius: 2px;
                transition: background 0.3s ease;
            }
            
            .homepage-shortcuts-grid::-webkit-scrollbar-thumb:hover {
                background: rgba(0, 212, 170, 0.8);
            }
        }

        /* Pantallas muy pequeñas - scroll más compacto */
        @media (max-width: 360px) {
            .homepage-shortcuts-grid {
                gap: 10px;
                padding: 6px 0 14px 0;
            }
            
            .homepage-shortcut-card {
                width: 110px;
                min-width: 110px;
                padding: 12px 8px;
            }
            
            .homepage-shortcut-icon {
                width: 28px;
                height: 28px;
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .homepage-shortcut-title {
                font-size: 11px;
            }
            
            .homepage-shortcut-desc {
                font-size: 10px;
            }
        }

        /* Ajustes para altura limitada */
        @media (max-height: 600px) {
            .homepage-header {
                padding-top: 20px;
                padding-bottom: 16px;
            }
            
            .homepage-main-content {
                gap: 20px;
            }
        }

        /* ============ NEZA SIDEBAR (Opera GX Style) ============ */
        .neza-sidebar {
            position: fixed;
            left: 0;
            top: 32px;
            width: 60px;
            height: calc(100vh - 32px);
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-right: 1px solid rgba(0, 212, 170, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 9000;
            overflow: hidden;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .neza-sidebar.expanded {
            width: 240px;
        }

        /* Sidebar Header - Área fija */
        .sidebar-header {
            width: 100%;
            flex-shrink: 0;
            background: linear-gradient(180deg, #1a1a1a 0%, #141414 100%);
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 212, 170, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* Sidebar Logo */
        .sidebar-logo-container {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 0;
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .sidebar-logo-container:hover {
            background: rgba(0, 212, 170, 0.05);
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 2px 8px rgba(0, 212, 170, 0.3));
            animation: logoPulse 4s ease-in-out infinite;
        }

        @keyframes logoPulse {
            0%, 100% {
                filter: drop-shadow(0 2px 8px rgba(0, 212, 170, 0.3));
            }
            50% {
                filter: drop-shadow(0 2px 12px rgba(0, 212, 170, 0.5));
            }
        }

        .sidebar-logo:hover {
            transform: scale(1.15) rotate(5deg);
            filter: drop-shadow(0 4px 16px rgba(0, 212, 170, 0.6));
            animation: none;
        }

        .neza-sidebar.expanded .sidebar-logo {
            width: 50px;
            height: 50px;
        }

        .neza-sidebar.expanded .sidebar-logo:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .sidebar-toggle {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: #888;
            font-size: 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }

        .sidebar-toggle:hover {
            background: rgba(0, 212, 170, 0.1);
            color: var(--neza-primary);
        }

        /* Sidebar Content - Área con scroll */
        .sidebar-content {
            flex: 1;
            width: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 12px 0;
        }

        .sidebar-content::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 170, 0.2);
            border-radius: 2px;
        }

        .sidebar-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 170, 0.4);
        }

        .sidebar-section {
            width: 100%;
            margin-bottom: 4px;
        }

        .sidebar-section-title {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 12px;
            display: none;
            font-weight: 600;
        }

        .neza-sidebar.expanded .sidebar-section-title {
            display: block;
        }

        .sidebar-divider {
            width: 40px;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
        }

        .neza-sidebar.expanded .sidebar-divider {
            width: calc(100% - 20px);
            margin: 8px 10px;
        }

        .sidebar-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 12px;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            border-radius: 8px;
            margin: 2px auto;
            padding: 0;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }

        .neza-sidebar.expanded .sidebar-item {
            width: calc(100% - 16px);
            padding: 0 12px;
            justify-content: flex-start;
        }

        .sidebar-item-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .sidebar-item-text {
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            display: none;
        }

        .neza-sidebar.expanded .sidebar-item-text {
            opacity: 1;
            display: block;
        }

        .sidebar-item:hover {
            background: rgba(0, 212, 170, 0.15);
            color: var(--neza-primary);
            transform: translateX(2px);
        }

        .sidebar-item.active {
            background: rgba(0, 212, 170, 0.2);
            color: var(--neza-primary);
            font-weight: 600;
        }

        .sidebar-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 24px;
            background: var(--neza-primary);
            border-radius: 0 2px 2px 0;
        }

        .sidebar-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            background: #ff3742;
            color: white;
            font-size: 9px;
            font-weight: 700;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 16px;
            text-align: center;
        }

        .neza-sidebar.expanded .sidebar-badge {
            right: 12px;
        }

        .sidebar-spacer {
            flex: 1;
        }

        /* Ajustar contenido principal para dejar espacio a la sidebar */
        body {
            margin-left: 60px;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.sidebar-expanded {
            margin-left: 240px;
        }

        /* Messenger Panel */
        .messenger-panel {
            position: fixed;
            right: -400px;
            top: 32px;
            width: 380px;
            height: calc(100vh - 32px);
            background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
            border-left: 1px solid rgba(0, 212, 170, 0.2);
            z-index: 8000;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
        }

        .messenger-panel.active {
            right: 0;
        }

        .messenger-header {
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .messenger-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--neza-primary);
        }

        .messenger-close {
            background: transparent;
            border: none;
            color: #888;
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .messenger-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .messenger-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0 16px;
        }

        .messenger-tab {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .messenger-tab:hover {
            color: white;
        }

        .messenger-tab.active {
            color: var(--neza-primary);
            border-bottom-color: var(--neza-primary);
        }

        .messenger-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .messenger-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
            margin-bottom: 4px;
        }

        .messenger-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .messenger-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neza-primary), var(--neza-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .messenger-info {
            flex: 1;
            min-width: 0;
        }

        .messenger-name {
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }

        .messenger-message {
            font-size: 12px;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .messenger-time {
            font-size: 11px;
            color: #666;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="brand-dropdown">
                <div class="brand" onclick="toggleNezaDropdown()">
                    <img src="resourse/Neza_GX_Pro_Logo_PNG.png" alt="Neza GX Pro" class="brand-logo-full">
                </div>
                <div class="dropdown-content" id="NezaDropdown">
                    <div class="dropdown-item" onclick="createNewTab()">
                        <span class="icon">📄</span>
                        <span>Nueva Pestaña</span>
                    </div>
                    <div class="dropdown-item" onclick="openNewWindow()">
                        <span class="icon">🗔</span>
                        <span>Nueva Ventana</span>
                    </div>
                    <div class="dropdown-item stealth-mode" onclick="activateStealthMode()">
                        <span class="icon">🥷</span>
                        <span>Neza Stealth Mode</span>
                    </div>
                </div>
            </div>
            <div class="title-bar-controls-right">
                <button class="control-button minimize" onclick="minimizeApp()" title="Minimizar"></button>
                <button class="control-button maximize" onclick="maximizeApp()" title="Maximizar"></button>
                <button class="control-button close" onclick="closeApp()" title="Cerrar"></button>
            </div>
        </div>

        <!-- Neza Sidebar (Opera GX Style) -->
        <div class="neza-sidebar" id="nezaSidebar">
            <!-- Sidebar Header (Fija) -->
            <div class="sidebar-header">
                <!-- Sidebar Logo -->
                <div class="sidebar-logo-container" onclick="goToHome()" title="Neza GX Pro - Ir a inicio">
                    <img src="resourse/Neza_GX_Pro_Icono_PNG.png" alt="Neza GX Pro" class="sidebar-logo">
                </div>

                <!-- Toggle Button -->
                <button class="sidebar-toggle" onclick="toggleSidebar()" title="Expandir/Contraer">
                    <span class="sidebar-item-icon">☰</span>
                </button>
            </div>

            <!-- Sidebar Content (Con scroll) -->
            <div class="sidebar-content">
                <div class="sidebar-divider"></div>

                <!-- Main Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Principal</div>
                
                <button class="sidebar-item active" onclick="goToHome()" title="Inicio">
                    <span class="sidebar-item-icon">🏠</span>
                    <span class="sidebar-item-text">Inicio</span>
                </button>

                <button class="sidebar-item" onclick="openBookmarks()" title="Favoritos">
                    <span class="sidebar-item-icon">⭐</span>
                    <span class="sidebar-item-text">Favoritos</span>
                </button>

                <button class="sidebar-item" onclick="openHistory()" title="Historial">
                    <span class="sidebar-item-icon">🕐</span>
                    <span class="sidebar-item-text">Historial</span>
                </button>

                <button class="sidebar-item" onclick="openDownloads()" title="Descargas">
                    <span class="sidebar-item-icon">📥</span>
                    <span class="sidebar-item-text">Descargas</span>
                </button>
            </div>

            <div class="sidebar-divider"></div>

            <!-- Apps Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Apps</div>
                
                <button class="sidebar-item" onclick="openApp('whatsapp')" title="WhatsApp Web">
                    <span class="sidebar-item-icon">💬</span>
                    <span class="sidebar-item-text">WhatsApp</span>
                    <span class="sidebar-badge" style="display: none;">5</span>
                </button>

                <button class="sidebar-item" onclick="toggleMessengerPanel()" title="Messenger">
                    <span class="sidebar-item-icon">📨</span>
                    <span class="sidebar-item-text">Messenger</span>
                </button>

                <button class="sidebar-item" onclick="openApp('instagram')" title="Instagram">
                    <span class="sidebar-item-icon">📷</span>
                    <span class="sidebar-item-text">Instagram</span>
                </button>

                <button class="sidebar-item" onclick="openApp('twitter')" title="Twitter / X">
                    <span class="sidebar-item-icon">🐦</span>
                    <span class="sidebar-item-text">Twitter</span>
                </button>

                <button class="sidebar-item" onclick="openApp('discord')" title="Discord">
                    <span class="sidebar-item-icon">💬</span>
                    <span class="sidebar-item-text">Discord</span>
                </button>

                <button class="sidebar-item" onclick="openApp('twitch')" title="Twitch">
                    <span class="sidebar-item-icon">🎮</span>
                    <span class="sidebar-item-text">Twitch</span>
                </button>

                <button class="sidebar-item" onclick="openApp('spotify')" title="Spotify">
                    <span class="sidebar-item-icon">🎵</span>
                    <span class="sidebar-item-text">Spotify</span>
                </button>
            </div>

            <div class="sidebar-divider"></div>

            <!-- Gaming Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Gaming</div>
                
                <button class="sidebar-item" onclick="openApp('steam')" title="Steam">
                    <span class="sidebar-item-icon">🎮</span>
                    <span class="sidebar-item-text">Steam</span>
                </button>

                <button class="sidebar-item" onclick="openApp('epicgames')" title="Epic Games">
                    <span class="sidebar-item-icon">🎯</span>
                    <span class="sidebar-item-text">Epic Games</span>
                </button>
            </div>

            <div class="sidebar-spacer"></div>

                <!-- Bottom Section -->
                <div class="sidebar-section">
                    <button class="sidebar-item" onclick="toggleMusicPanel()" title="Control de Música">
                        <span class="sidebar-item-icon">🎵</span>
                        <span class="sidebar-item-text">Música</span>
                    </button>

                    <button class="sidebar-item" onclick="showMenu()" title="Configuración">
                        <span class="sidebar-item-icon">⚙️</span>
                        <span class="sidebar-item-text">Ajustes</span>
                    </button>
                </div>
            </div>
            <!-- Fin de sidebar-content -->
        </div>
        <!-- Fin de neza-sidebar -->

        <!-- Messenger Panel -->
        <div class="messenger-panel" id="messengerPanel">
            <div class="messenger-header">
                <div class="messenger-title">Mensajería</div>
                <button class="messenger-close" onclick="toggleMessengerPanel()">×</button>
            </div>

            <div class="messenger-tabs">
                <button class="messenger-tab active">Chats</button>
                <button class="messenger-tab">Notificaciones</button>
            </div>

            <div class="messenger-content">
                <div class="messenger-item">
                    <div class="messenger-avatar">💬</div>
                    <div class="messenger-info">
                        <div class="messenger-name">Facebook Messenger</div>
                        <div class="messenger-message">Conecta tu cuenta para ver mensajes</div>
                    </div>
                </div>

                <div class="messenger-item">
                    <div class="messenger-avatar">📱</div>
                    <div class="messenger-info">
                        <div class="messenger-name">WhatsApp Web</div>
                        <div class="messenger-message">Sincroniza tu teléfono para iniciar</div>
                    </div>
                </div>

                <div class="messenger-item">
                    <div class="messenger-avatar">✈️</div>
                    <div class="messenger-info">
                        <div class="messenger-name">Telegram</div>
                        <div class="messenger-message">Disponible próximamente</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar" id="tabBar">
            <div class="tab active" id="tab-1">
                <span>Nueva pestaña</span>
                <span class="tab-close" onclick="closeTab(1)">×</span>
            </div>
            <button class="new-tab-button" onclick="newTab()">+</button>
        </div>

        <!-- Navigation Bar -->
        <div class="navigation-bar">
            <button class="nav-button" onclick="goBack()" title="Atrás" id="backBtn" disabled>←</button>
            <button class="nav-button" onclick="goForward()" title="Adelante" id="forwardBtn" disabled>→</button>
            <button class="nav-button" onclick="refresh()" title="Actualizar">↻</button>
            <div class="address-bar">
                <input class="address-input" id="addressInput" placeholder="Busca o navega a un sitio web..." oninput="updateSuggestions()">
                <button class="copy-url-button" onclick="copyCurrentUrl()" title="Copiar URL actual" id="copyUrlBtn">
                    📋
                </button>
            </div>
            <button class="nav-button" onclick="search()" title="Buscar">🔍</button>
            <button class="nav-button" onclick="showBookmarks()" title="Favoritos">⭐</button>
            <button class="nav-button music-control-btn" onclick="toggleMusicPanel()" title="Control de Música" id="musicControlBtn">🎵</button>
            <button class="nav-button" onclick="showMenu()" title="Menú">☰</button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Homepage -->
            <div class="homepage" id="homepage">
                <!-- Efectos de fondo animados -->
                <div class="background-particles"></div>

                <!-- Header con logo hermoso -->
                <div class="homepage-header">
                    <div class="Neza-logo-container">
                        <img src="resourse/Neza_Logo_Completo_PNG.png" alt="Neza Browser" class="Neza-logo-img">
                    </div>
                    <div class="brand-text">Neza Browser</div>
                </div>

                <!-- Contenido principal -->
                <div class="homepage-main-content">
                    <!-- Buscador central elegante -->
                    <div class="homepage-search-section">
                        <div class="homepage-search-box">
                            <input type="text" class="homepage-search-input-new" placeholder="Buscar en la web o escribir URL..." id="homepageSearchInput">
                            <button class="homepage-search-btn" onclick="performHomepageSearch()">
                                🔍
                            </button>
                        </div>
                    </div>

                    <!-- Accesos rápidos hermosos -->
                    <div class="homepage-quick-access">
                        <h2 class="homepage-section-title">Accesos Rápidos</h2>
                        <div class="homepage-shortcuts-grid">
                            <div class="homepage-shortcut-card" onclick="navigate('https://www.google.com')">
                                <div class="homepage-shortcut-icon"><img src="https://www.google.com/favicon.ico" alt="Google" style="width: 32px; height: 32px; border-radius: 6px;"></div>
                                <div class="homepage-shortcut-title">Google</div>
                                <div class="homepage-shortcut-desc">Motor de búsqueda</div>
                            </div>
                            
                            <div class="homepage-shortcut-card" onclick="navigate('https://www.youtube.com')">
                                <div class="homepage-shortcut-icon"><img src="https://www.youtube.com/favicon.ico" alt="YouTube" style="width: 32px; height: 32px; border-radius: 6px;"></div>
                                <div class="homepage-shortcut-title">YouTube</div>
                                <div class="homepage-shortcut-desc">Videos y entretenimiento</div>
                            </div>
                            
                            <div class="homepage-shortcut-card" onclick="navigate('https://www.twitch.tv')">
                                <div class="homepage-shortcut-icon"><img src="https://www.twitch.tv/favicon.ico" alt="Twitch" style="width: 32px; height: 32px; border-radius: 6px;"></div>
                                <div class="homepage-shortcut-title">Twitch</div>
                                <div class="homepage-shortcut-desc">Streaming y gaming</div>
                            </div>
                            
                            <div class="homepage-shortcut-card" onclick="navigate('https://open.spotify.com')">
                                <div class="homepage-shortcut-icon"><img src="https://open.spotify.com/favicon.ico" alt="Spotify" style="width: 32px; height: 32px; border-radius: 6px;"></div>
                                <div class="homepage-shortcut-title">Spotify</div>
                                <div class="homepage-shortcut-desc">Música y podcasts</div>
                            </div>
                            
                            <div class="homepage-shortcut-card" onclick="navigate('https://www.netflix.com')">
                                <div class="homepage-shortcut-icon"><img src="https://assets.nflxext.com/us/ffe/siteui/common/icons/nficon2016.ico" alt="Netflix" style="width: 32px; height: 32px; border-radius: 6px;"></div>
                                <div class="homepage-shortcut-title">Netflix</div>
                                <div class="homepage-shortcut-desc">Streaming</div>
                            </div>
                            
                            <div class="homepage-shortcut-card" onclick="testBrowserNavigation()" style="border: 2px solid var(--neza-primary);">
                                <div class="homepage-shortcut-icon">🔧</div>
                                <div class="homepage-shortcut-title">Probar Navegación</div>
                                <div class="homepage-shortcut-desc">Test de funcionalidad</div>
                            </div>
                        </div>
                    </div>

                    <!-- Estadísticas hermosas -->
                    <div class="homepage-stats-section">
                        <h2 class="homepage-section-title">Estadísticas de Neza</h2>
                        <div class="homepage-stats-grid">
                            <div class="homepage-stat-item">
                                <div class="homepage-stat-number" id="homepageAdsBlocked">1,247</div>
                                <div class="homepage-stat-label">Anuncios Bloqueados</div>
                            </div>
                            
                            <div class="homepage-stat-item">
                                <div class="homepage-stat-number" id="homepageDataSaved">156 MB</div>
                                <div class="homepage-stat-label">Datos Ahorrados</div>
                            </div>
                            
                            <div class="homepage-stat-item">
                                <div class="homepage-stat-number" id="homepageTimeSaved">32 min</div>
                                <div class="homepage-stat-label">Tiempo Ahorrado</div>
                            </div>
                            
                            <div class="homepage-stat-item">
                                <div class="homepage-stat-number">100%</div>
                                <div class="homepage-stat-label">Sesiones Protegidas</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer elegante -->
                <div class="homepage-footer">
                    Neza Browser v2.1.0 | Experiencia el Futuro de la Navegación
                </div>
            </div>

            <!-- WebView Container -->
            <div class="webview-container" id="webviewContainer">
                <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Cargando página...</p>
                </div>
                <!-- Los webviews se crearán dinámicamente pero con mejor CSS -->
            </div>
        </div>

        <!-- Menú contextual de pestañas -->
        <div class="tab-context-menu" id="tabContextMenu">
            <div class="tab-context-menu-item" onclick="contextReloadTab()">
                <span class="tab-context-menu-item-icon">🔄</span>
                <span>Recargar</span>
                <span class="tab-context-menu-item-shortcut">Ctrl+R</span>
            </div>
            <div class="tab-context-menu-item" onclick="contextDuplicateTab()">
                <span class="tab-context-menu-item-icon">📑</span>
                <span>Duplicar pestaña</span>
            </div>
            <div class="tab-context-menu-separator"></div>
            <div class="tab-context-menu-item" onclick="contextPinTab()">
                <span class="tab-context-menu-item-icon">📌</span>
                <span>Fijar pestaña</span>
            </div>
            <div class="tab-context-menu-item" onclick="contextMuteTab()">
                <span class="tab-context-menu-item-icon">🔇</span>
                <span id="contextMuteText">Silenciar pestaña</span>
            </div>
            <div class="tab-context-menu-separator"></div>
            <div class="tab-context-menu-item" onclick="contextCloseTab()">
                <span class="tab-context-menu-item-icon">❌</span>
                <span>Cerrar</span>
                <span class="tab-context-menu-item-shortcut">Ctrl+W</span>
            </div>
            <div class="tab-context-menu-item" onclick="contextCloseOtherTabs()">
                <span class="tab-context-menu-item-icon">🗑️</span>
                <span>Cerrar las demás pestañas</span>
            </div>
            <div class="tab-context-menu-item" onclick="contextCloseTabsToRight()">
                <span class="tab-context-menu-item-icon">➡️</span>
                <span>Cerrar pestañas a la derecha</span>
            </div>
            <div class="tab-context-menu-separator"></div>
            <div class="tab-context-menu-item" onclick="contextCopyUrl()">
                <span class="tab-context-menu-item-icon">🔗</span>
                <span>Copiar dirección de la página</span>
            </div>
        </div>

        <!-- Music Control Panel -->
        <div class="music-panel-overlay" id="musicPanelOverlay" style="display: none;">
            <div class="music-panel" id="musicPanel">
                <div class="music-panel-header">
                    <div class="music-header-info">
                        <div class="music-icon-large">🎵</div>
                        <div class="music-header-text">
                            <h3>Control de Música</h3>
                            <p id="musicStatus">No hay reproducción activa</p>
                            <div class="remote-tab-indicator" id="remoteTabIndicator" style="display: none;">
                                🎯 Controlando otra pestaña
                            </div>
                        </div>
                    </div>
                    <div class="panel-controls">
                        <button class="refresh-btn" onclick="detectCurrentMedia()" title="Refrescar detección">🔄</button>
                        <button class="debug-btn" onclick="debugAudioDetection()" title="Debug detección">🐛</button>
                        <button class="close-panel-btn" onclick="closeMusicPanel()">✕</button>
                    </div>
                </div>
                
                <div class="music-panel-content">
                    <!-- Current Track Info -->
                    <div class="current-track-info">
                        <div class="track-artwork">🎶</div>
                        <div class="track-details">
                            <div class="track-title" id="panelTrackTitle">Sin título</div>
                            <div class="track-artist" id="panelTrackArtist">Desconocido</div>
                            <div class="track-source" id="panelTrackSource">-</div>
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="music-progress-container">
                        <div class="progress-time" id="panelCurrentTime">0:00</div>
                        <div class="progress-bar-container" onclick="seekToPosition(event)">
                            <div class="progress-track"></div>
                            <div class="progress-fill" id="panelProgressFill"></div>
                            <div class="progress-thumb" id="panelProgressThumb"></div>
                        </div>
                        <div class="progress-time" id="panelTotalTime">0:00</div>
                    </div>
                    
                    <!-- Main Controls -->
                    <div class="main-controls">
                        <button class="control-btn secondary" onclick="shuffleToggle()" id="shuffleBtn" title="Aleatorio">
                            🔀
                        </button>
                        <button class="control-btn primary" onclick="previousTrack()" title="Anterior">
                            ⏮️
                        </button>
                        <button class="control-btn play-pause-main" onclick="togglePlayPause()" id="panelPlayPauseBtn" title="Reproducir/Pausar">
                            ▶️
                        </button>
                        <button class="control-btn primary" onclick="nextTrack()" title="Siguiente">
                            ⏭️
                        </button>
                        <button class="control-btn secondary" onclick="repeatToggle()" id="repeatBtn" title="Repetir">
                            🔁
                        </button>
                    </div>
                    
                    <!-- Volume Control -->
                    <div class="volume-control">
                        <span class="volume-icon">🔊</span>
                        <div class="volume-slider-container">
                            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100" oninput="adjustVolume(this.value)">
                        </div>
                        <span class="volume-percent" id="volumePercent">100%</span>
                    </div>
                    
                    <!-- Additional Controls -->
                    <div class="additional-controls">
                        <button class="extra-btn" onclick="downloadAudio()" title="Descargar">
                            💾 Descargar
                        </button>
                        <button class="extra-btn" onclick="shareMusic()" title="Compartir">
                            📤 Compartir
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel-overlay" id="settingsPanelOverlay" style="display: none;">
            <div class="settings-panel" id="settingsPanel">
                <div class="settings-panel-header">
                    <div class="settings-header-info">
                        <div class="settings-icon-large">⚙️</div>
                        <div class="settings-header-text">
                            <h3>Neza Browser</h3>
                            <p>Configuraciones y preferencias</p>
                        </div>
                    </div>
                    <button class="close-panel-btn" onclick="closeSettingsPanel()">✕</button>
                </div>
                
                <div class="settings-panel-content">
                    <!-- Settings Sidebar -->
                    <div class="settings-sidebar">
                        <div class="settings-nav-item active" onclick="showSettingsSection('general')" id="nav-general">
                            <span class="settings-nav-icon">🏠</span>
                            <span class="settings-nav-text">General</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('privacy')" id="nav-privacy">
                            <span class="settings-nav-icon">🌐</span>
                            <span class="settings-nav-text">Navegación y Privacidad</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('downloads')" id="nav-downloads">
                            <span class="settings-nav-icon">📁</span>
                            <span class="settings-nav-text">Descargas y Archivos</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('appearance')" id="nav-appearance">
                            <span class="settings-nav-icon">🎨</span>
                            <span class="settings-nav-text">Personalización y Skins</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('multimedia')" id="nav-multimedia">
                            <span class="settings-nav-icon">🔊</span>
                            <span class="settings-nav-text">Multimedia y Overlays</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('extensions')" id="nav-extensions">
                            <span class="settings-nav-icon">🧩</span>
                            <span class="settings-nav-text">Extensiones y Herramientas</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('performance')" id="nav-performance">
                            <span class="settings-nav-icon">💾</span>
                            <span class="settings-nav-text">Sistema y Rendimiento</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('accounts')" id="nav-accounts">
                            <span class="settings-nav-icon">👥</span>
                            <span class="settings-nav-text">Cuentas y Sincronización</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('advanced')" id="nav-advanced">
                            <span class="settings-nav-icon">⚡</span>
                            <span class="settings-nav-text">Avanzado / Desarrollador</span>
                        </div>
                        <div class="settings-nav-item" onclick="showSettingsSection('about')" id="nav-about">
                            <span class="settings-nav-icon">🧠</span>
                            <span class="settings-nav-text">Sobre Neza</span>
                        </div>
                    </div>
                    
                    <!-- Settings Content -->
                    <div class="settings-content">
                        <!-- General Settings -->
                        <div class="settings-section active" id="section-general">
                            <h2>General</h2>
                            
                            <div class="settings-group">
                                <h3>Motor de búsqueda</h3>
                                <select class="Neza-select" id="searchEngine">
                                    <option value="Neza">Neza Search</option>
                                    <option value="google" selected>Google</option>
                                    <option value="bing">Bing</option>
                                    <option value="duckduckgo">DuckDuckGo</option>
                                    <option value="yahoo">Yahoo</option>
                                </select>
                            </div>
                            
                            <div class="settings-group">
                                <h3>Página de inicio</h3>
                                <input type="text" class="Neza-input" id="homepage" value="Neza.com" placeholder="URL de página de inicio">
                            </div>
                            
                            <div class="settings-group">
                                <h3>Idioma</h3>
                                <select class="Neza-select" id="language">
                                    <option value="es" selected>Español</option>
                                    <option value="en">English</option>
                                    <option value="fr">Français</option>
                                    <option value="de">Deutsch</option>
                                    <option value="it">Italiano</option>
                                    <option value="pt">Português</option>
                                </select>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Mostrar barra lateral</h4>
                                        <p>Mostrar panel lateral de navegación rápida</p>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="showSidebar" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Mostrar botón de inicio</h4>
                                        <p>Mostrar botón de página de inicio en la barra</p>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="showHomeButton">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Preguntar dónde guardar archivos</h4>
                                        <p>Solicitar ubicación antes de cada descarga</p>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="askWhereToSave" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Continuar donde lo dejaste</h4>
                                        <p>Restaurar pestañas al reiniciar Neza</p>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="continueWhereLeftOff" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Other sections will be added here -->
                        <div class="settings-section" id="section-privacy" style="display: none;">
                            <h2>Navegación y Privacidad</h2>
                            <p class="section-description">Configura tu privacidad y seguridad en línea</p>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Guardian Mode</h4>
                                        <p>Protección inteligente contra sitios maliciosos con IA</p>
                                        <span class="feature-badge">NUEVO</span>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="guardianMode" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Bloqueador de anuncios</h4>
                                        <p>Bloquear automáticamente anuncios intrusivos</p>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="adBlocker" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Protección anti-seguimiento</h4>
                                        <p>Prevenir el rastreo entre sitios web</p>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="antiTracking" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="settings-toggle-item">
                                    <div class="toggle-info">
                                        <h4>Borrado automático al salir</h4>
                                        <p>Limpiar cookies e historial al cerrar Neza</p>
                                    </div>
                                    <label class="Neza-toggle">
                                        <input type="checkbox" id="autoCleanOnExit">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <h3>Permisos de sitios web</h3>
                                <div class="permission-grid">
                                    <div class="permission-item">
                                        <span class="permission-icon">📍</span>
                                        <span class="permission-name">Ubicación</span>
                                        <select class="Neza-select-small">
                                            <option value="ask">Preguntar</option>
                                            <option value="allow">Permitir</option>
                                            <option value="block">Bloquear</option>
                                        </select>
                                    </div>
                                    <div class="permission-item">
                                        <span class="permission-icon">📷</span>
                                        <span class="permission-name">Cámara</span>
                                        <select class="Neza-select-small">
                                            <option value="ask" selected>Preguntar</option>
                                            <option value="allow">Permitir</option>
                                            <option value="block">Bloquear</option>
                                        </select>
                                    </div>
                                    <div class="permission-item">
                                        <span class="permission-icon">🎤</span>
                                        <span class="permission-name">Micrófono</span>
                                        <select class="Neza-select-small">
                                            <option value="ask" selected>Preguntar</option>
                                            <option value="allow">Permitir</option>
                                            <option value="block">Bloquear</option>
                                        </select>
                                    </div>
                                    <div class="permission-item">
                                        <span class="permission-icon">🔔</span>
                                        <span class="permission-name">Notificaciones</span>
                                        <select class="Neza-select-small">
                                            <option value="ask" selected>Preguntar</option>
                                            <option value="allow">Permitir</option>
                                            <option value="block">Bloquear</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Placeholder sections -->
                        <div class="settings-section" id="section-downloads" style="display: none;">
                            <h2>Descargas y Archivos</h2>
                            <p class="coming-soon">🚧 Próximamente - Gestión avanzada de descargas</p>
                        </div>
                        
                        <div class="settings-section" id="section-appearance" style="display: none;">
                            <h2>Personalización y Skins</h2>
                            <p class="coming-soon">🎨 Próximamente - Temas personalizados y Neza Skins Store</p>
                        </div>
                        
                        <div class="settings-section" id="section-multimedia" style="display: none;">
                            <h2>Multimedia y Overlays</h2>
                            <p class="coming-soon">🔊 Próximamente - Control avanzado multimedia</p>
                        </div>
                        
                        <div class="settings-section" id="section-extensions" style="display: none;">
                            <h2>Extensiones y Herramientas</h2>
                            <p class="coming-soon">🧩 Próximamente - Neza Store y extensiones</p>
                        </div>
                        
                        <div class="settings-section" id="section-performance" style="display: none;">
                            <h2>Sistema y Rendimiento</h2>
                            <p class="coming-soon">💾 Próximamente - Optimización del sistema</p>
                        </div>
                        
                        <div class="settings-section" id="section-accounts" style="display: none;">
                            <h2>Cuentas y Sincronización</h2>
                            <p class="coming-soon">👥 Próximamente - Cuenta Neza y sincronización</p>
                        </div>
                        
                        <div class="settings-section" id="section-advanced" style="display: none;">
                            <h2>Avanzado / Desarrollador</h2>
                            <p class="coming-soon">⚡ Próximamente - Herramientas para desarrolladores</p>
                        </div>
                        
                        <div class="settings-section" id="section-about" style="display: none;">
                            <h2>Sobre Neza</h2>
                            <div class="about-content">
                                <div class="about-logo">
                                    <img src="resourse/Neza_Logo_Completo_PNG.png" alt="Neza Browser Logo" class="Neza-logo-image">
                                    <h3>Neza Browser</h3>
                                    <p class="version">Versión 2.1.0</p>
                                </div>
                                
                                <div class="about-info">
                                    <div class="info-item">
                                        <strong>Desarrollado por:</strong> Hi Code Studio Tech
                                    </div>
                                    <div class="info-item">
                                        <strong>En colaboración con:</strong> GEISA
                                    </div>
                                    <div class="info-item">
                                        <strong>Motor:</strong> Electron + Chromium
                                    </div>
                                    <div class="info-item">
                                        <strong>Fecha de compilación:</strong> Octubre 2024
                                    </div>
                                </div>
                                
                                <div class="about-buttons">
                                    <button class="Neza-btn primary" onclick="checkForUpdates()">
                                        🔄 Buscar actualizaciones
                                    </button>
                                    <button class="Neza-btn secondary" onclick="showChangelog()">
                                        📋 Ver cambios
                                    </button>
                                    <button class="Neza-btn secondary" onclick="contactSupport()">
                                        📧 Soporte
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <span id="statusText">Neza Browser - Listo</span>
            <span class="url-status" id="urlStatus"></span>
        </div>

        <!-- Chat Button -->
        <button class="chat-fab" onclick="openChat()" title="Asistente AI">💬</button>
    </div>

    <!-- Neza Support Panel -->
    <div class="support-panel-overlay" id="supportPanelOverlay" style="display: none;">
        <div class="support-panel">
            <div class="support-header">
                <div class="support-logo">
                    <span class="support-icon">🆘</span>
                    <h2>Neza Support Center</h2>
                </div>
                <button class="close-support" onclick="closeSupportPanel()">×</button>
            </div>
            
            <div class="support-content">
                <div class="support-description">
                    <p>¿Necesitas ayuda o quieres reportar algo? Selecciona una opción:</p>
                </div>
                
                <div class="support-options">
                    <div class="support-option" onclick="showFeedbackCenter()">
                        <div class="option-icon">🐞</div>
                        <div class="option-info">
                            <h3>Reportes & Feedback</h3>
                            <p>Reportar bugs, sugerir mejoras o enviar ideas</p>
                        </div>
                    </div>
                    
                    <div class="support-option" onclick="showHelpCenter()">
                        <div class="option-icon">❓</div>
                        <div class="option-info">
                            <h3>Centro de Ayuda</h3>
                            <p>Consultas, soporte técnico y preguntas frecuentes</p>
                        </div>
                    </div>
                    
                    <div class="support-option" onclick="checkForUpdatesManually()">
                        <div class="option-icon">🔄</div>
                        <div class="option-info">
                            <h3>Buscar Actualizaciones</h3>
                            <p>Verificar y descargar las últimas actualizaciones</p>
                        </div>
                    </div>
                    
                    <div class="support-option" onclick="viewChangelog()">
                        <div class="option-icon">📋</div>
                        <div class="option-info">
                            <h3>Ver Cambios</h3>
                            <p>Historial de actualizaciones y nuevas características</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Checker Panel -->
    <div class="update-panel-overlay" id="updatePanelOverlay" style="display: none;">
        <div class="update-panel">
            <div class="update-header">
                <div class="update-logo">
                    <span class="update-icon">🔄</span>
                    <h2>Actualizaciones de Neza</h2>
                </div>
                <button class="close-update" onclick="closeUpdatePanel()">×</button>
            </div>
            
            <div class="update-content" id="updateContent">
                <!-- Estado: Checking -->
                <div class="update-state" id="updateStateChecking" style="display: none;">
                    <div class="update-spinner">
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                    </div>
                    <h3>🔍 Buscando actualizaciones...</h3>
                    <p>Conectando con GitHub para verificar la última versión disponible</p>
                    <div class="update-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="checkingProgress"></div>
                        </div>
                        <span class="progress-text" id="checkingText">Consultando repositorio...</span>
                    </div>
                </div>

                <!-- Estado: Up to Date -->
                <div class="update-state" id="updateStateUpToDate" style="display: none;">
                    <div class="update-success-icon">✅</div>
                    <h3>¡Todo al día!</h3>
                    <p>Estás usando la última versión de Neza Browser</p>
                    <div class="version-info">
                        <div class="version-card">
                            <span class="version-label">Versión actual</span>
                            <span class="version-number" id="currentVersion">2.1.0</span>
                        </div>
                    </div>
                    <button class="update-btn primary" onclick="closeUpdatePanel()">Cerrar</button>
                </div>

                <!-- Estado: Update Available -->
                <div class="update-state" id="updateStateAvailable" style="display: none;">
                    <div class="update-available-icon">🎉</div>
                    <h3>¡Nueva actualización disponible!</h3>
                    <p>Hay una nueva versión de Neza Browser lista para descargar</p>
                    <div class="version-comparison">
                        <div class="version-card current">
                            <span class="version-label">Versión actual</span>
                            <span class="version-number" id="currentVersionCompare">2.1.0</span>
                        </div>
                        <div class="version-arrow">→</div>
                        <div class="version-card new">
                            <span class="version-label">Nueva versión</span>
                            <span class="version-number" id="newVersion">2.2.0</span>
                        </div>
                    </div>
                    <div class="update-changelog" id="updateChangelog">
                        <h4>📋 Novedades:</h4>
                        <ul id="changelogList"></ul>
                    </div>
                    <div class="update-actions">
                        <button class="update-btn secondary" onclick="closeUpdatePanel()">Más tarde</button>
                        <button class="update-btn primary" onclick="startUpdateDownload()">📥 Descargar e instalar</button>
                    </div>
                </div>

                <!-- Estado: Downloading -->
                <div class="update-state" id="updateStateDownloading" style="display: none;">
                    <div class="update-spinner">
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                    </div>
                    <h3>📥 Descargando actualización...</h3>
                    <p id="downloadInfo">Preparando descarga...</p>
                    <div class="update-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="downloadProgress"></div>
                        </div>
                        <span class="progress-text" id="downloadText">0% completado</span>
                    </div>
                    <div class="download-stats">
                        <span id="downloadSpeed">-- MB/s</span>
                        <span id="downloadSize">-- / -- MB</span>
                    </div>
                </div>

                <!-- Estado: Installing -->
                <div class="update-state" id="updateStateInstalling" style="display: none;">
                    <div class="update-spinner">
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                    </div>
                    <h3>⚙️ Instalando actualización...</h3>
                    <p>Por favor espera mientras se instala la nueva versión</p>
                    <div class="update-progress">
                        <div class="progress-bar">
                            <div class="progress-fill indeterminate"></div>
                        </div>
                        <span class="progress-text">Aplicando cambios...</span>
                    </div>
                </div>

                <!-- Estado: Ready to Restart -->
                <div class="update-state" id="updateStateRestart" style="display: none;">
                    <div class="update-success-icon">🎊</div>
                    <h3>¡Actualización lista!</h3>
                    <p>La actualización se ha instalado correctamente</p>
                    <div class="restart-info">
                        <div class="info-box">
                            <span class="info-icon">ℹ️</span>
                            <p>Para aplicar los cambios, necesitas reiniciar Neza Browser</p>
                        </div>
                    </div>
                    <div class="update-actions">
                        <button class="update-btn secondary" onclick="restartLater()">Reiniciar después</button>
                        <button class="update-btn primary" onclick="restartNow()">🔄 Reiniciar ahora</button>
                    </div>
                </div>

                <!-- Estado: Error -->
                <div class="update-state" id="updateStateError" style="display: none;">
                    <div class="update-error-icon">❌</div>
                    <h3>Error al actualizar</h3>
                    <p id="errorMessage">Ha ocurrido un error durante el proceso de actualización</p>
                    <div class="error-details" id="errorDetails"></div>
                    <div class="update-actions">
                        <button class="update-btn secondary" onclick="closeUpdatePanel()">Cerrar</button>
                        <button class="update-btn primary" onclick="retryUpdate()">🔄 Reintentar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Center Panel -->
    <div class="feedback-panel-overlay" id="feedbackPanelOverlay" style="display: none;">
        <div class="feedback-panel">
            <div class="feedback-header">
                <div class="feedback-logo">
                    <span class="feedback-icon">🐞</span>
                    <h2>Neza Feedback Center</h2>
                </div>
                <button class="close-feedback" onclick="closeFeedbackPanel()">×</button>
            </div>
            
            <div class="feedback-content">
                <form id="feedbackForm" onsubmit="submitFeedback(event)">
                    <div class="form-group">
                        <label for="feedbackType">Tipo de reporte:</label>
                        <select id="feedbackType" name="type" required>
                            <option value="">Selecciona una opción...</option>
                            <option value="bug">🐞 Bug / Error</option>
                            <option value="improvement">💡 Mejora / Sugerencia</option>
                            <option value="feature">⭐ Nueva Característica</option>
                            <option value="plugin">🔌 Idea de Plugin</option>
                            <option value="performance">⚡ Rendimiento</option>
                            <option value="ui">🎨 Interfaz / Diseño</option>
                            <option value="other">📝 Otro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackDescription">Descripción:</label>
                        <textarea 
                            id="feedbackDescription" 
                            name="description" 
                            placeholder="Describe detalladamente tu reporte, sugerencia o problema..."
                            rows="6"
                            required
                        ></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="userEmail">Tu correo (opcional):</label>
                        <input 
                            type="email" 
                            id="userEmail" 
                            name="email" 
                            placeholder="tu@email.com"
                        >
                        <small>Solo para contactarte si necesitamos más información</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" onclick="closeFeedbackPanel()" class="btn-cancel">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-submit">
                            🚀 Enviar Reporte
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Browser Menu Contextual -->
    <div class="browser-menu-overlay" id="browserMenuOverlay">
        <div class="browser-menu">
            <div class="browser-menu-header">
                <span>🚀</span>
                Neza Browser
            </div>
            <div class="browser-menu-content">
                <button class="menu-item" onclick="createNewTab()">
                    <span class="menu-item-icon">📄</span>
                    <span class="menu-item-text">Nueva Pestaña</span>
                    <span class="menu-item-shortcut">Ctrl+T</span>
                </button>
                
                <button class="menu-item" onclick="createNewWindow()">
                    <span class="menu-item-icon">🗔</span>
                    <span class="menu-item-text">Nueva Ventana</span>
                    <span class="menu-item-shortcut">Ctrl+N</span>
                </button>
                
                <div class="menu-separator"></div>
                
                <button class="menu-item stealth-menu-item" onclick="openStealthMode()">
                    <span class="menu-item-icon">👻</span>
                    <span class="menu-item-text">Neza Stealth Mode</span>
                    <span class="menu-item-shortcut">Ctrl+Shift+N</span>
                </button>
                
                <div class="menu-separator"></div>
                
                <!-- Controles de Zoom -->
                <div class="zoom-controls-section">
                    <div class="zoom-controls-header">
                        <span class="zoom-header-icon">🔍</span>
                        <span class="zoom-header-text">Zoom</span>
                    </div>
                    
                    <div class="zoom-controls">
                        <button class="zoom-button zoom-out" onclick="zoomOut()" title="Reducir zoom (Ctrl + -)">
                            <span>−</span>
                        </button>
                        
                        <div class="zoom-level-container">
                            <input type="text" 
                                   id="zoomLevelInput" 
                                   class="zoom-level-input" 
                                   value="100%" 
                                   title="Nivel de zoom personalizado (25% - 500%)"
                                   onkeydown="handleZoomInput(event)"
                                   onblur="applyCustomZoom()">
                        </div>
                        
                        <button class="zoom-button zoom-in" onclick="zoomIn()" title="Aumentar zoom (Ctrl + +)">
                            <span>+</span>
                        </button>
                        
                        <button class="zoom-button zoom-reset" onclick="resetZoom()" title="Restablecer zoom (Ctrl + 0)">
                            <span>⌂</span>
                        </button>
                        
                        <button class="zoom-button fullscreen-toggle" onclick="toggleFullscreen()" title="Pantalla completa (F11)">
                            <span id="fullscreenIcon">⛶</span>
                        </button>
                    </div>
                </div>
                
                <div class="menu-separator"></div>
                
                <button class="menu-item" onclick="showSettingsPanel()">
                    <span class="menu-item-icon">⚙️</span>
                    <span class="menu-item-text">Configuraciones</span>
                    <span class="menu-item-shortcut">Ctrl+,</span>
                </button>
                
                <div class="menu-separator"></div>
                
                <button class="menu-item" onclick="showNezaSupportPanel()">
                    <span class="menu-item-icon">🆘</span>
                    <span class="menu-item-text">Neza Support</span>
                    <span class="menu-item-shortcut">F1</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Neza Stealth Mode Panel -->
    <div class="stealth-mode-overlay" id="stealthModeOverlay">
        <div class="stealth-mode-panel">
            <button class="close-stealth-btn" onclick="closeStealthMode()">✕</button>
            
            <div class="stealth-mode-header">
                <div class="stealth-icon">👻</div>
                <div class="stealth-title">Neza Stealth Mode</div>
                <div class="stealth-subtitle">"Browse freely. Leave no trace — online or offline."</div>
            </div>
            
            <div class="stealth-mode-content">
                <div class="stealth-description">
                    Elige tu nivel de privacidad. Cada capa ofrece mayor protección y anonimato mientras navegas.
                </div>
                
                <div class="stealth-layers">
                    <div class="stealth-layer" id="layer1" onclick="selectStealthLayer(1)">
                        <div class="stealth-layer-header">
                            <div class="stealth-layer-icon">🕶️</div>
                            <div class="stealth-layer-title">Layer 1 - Basic</div>
                            <div class="stealth-layer-badge">Básico</div>
                        </div>
                        <div class="stealth-layer-description">
                            Privacidad estándar: Sin historial, cookies ni caché. Perfecto para navegación casual privada.
                        </div>
                    </div>
                    
                    <div class="stealth-layer" id="layer2" onclick="selectStealthLayer(2)">
                        <div class="stealth-layer-header">
                            <div class="stealth-layer-icon">🛡️</div>
                            <div class="stealth-layer-title">Layer 2 - Shield</div>
                            <div class="stealth-layer-badge">Avanzado</div>
                        </div>
                        <div class="stealth-layer-description">
                            Protección avanzada: Bloqueo de rastreadores, huellas digitales y scripts maliciosos. DNS seguro activado.
                        </div>
                    </div>
                    
                    <div class="stealth-layer selected" id="layer3" onclick="selectStealthLayer(3)">
                        <div class="stealth-layer-header">
                            <div class="stealth-layer-icon">👻</div>
                            <div class="stealth-layer-title">Ghost Mode</div>
                            <div class="stealth-layer-badge">Máximo</div>
                        </div>
                        <div class="stealth-layer-description">
                            Privacidad total: Sandbox temporal, bóveda cifrada, modo paranoico. Desaparición completa al cerrar.
                        </div>
                    </div>
                </div>
                
                <div class="stealth-controls">
                    <button class="stealth-btn secondary" onclick="closeStealthMode()">
                        <span>❌</span>
                        Cancelar
                    </button>
                    
                    <button class="stealth-btn primary" onclick="startStealthSession()" id="startStealthBtn">
                        <span>🚀</span>
                        Iniciar Ghost Mode
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Flotante (Picture-in-Picture) -->
    <div class="pip-container" id="pipContainer">
        <div class="pip-controls">
            <button class="pip-control-btn" onclick="togglePipSize()" title="Redimensionar" id="pipResizeBtn">⇱</button>
            <button class="pip-control-btn" onclick="closePip()" title="Cerrar">×</button>
        </div>
        <webview class="pip-video" id="pipVideo" src="about:blank"></webview>
        
        <!-- Controles de video flotante -->
        <div class="pip-video-controls">
            <button class="pip-video-btn" onclick="pipVideoControl('previous')" title="Anterior">⏮️</button>
            <button class="pip-video-btn" onclick="pipVideoControl('playpause')" title="Play/Pausa" id="pipPlayBtn">▶️</button>
            <button class="pip-video-btn" onclick="pipVideoControl('next')" title="Siguiente">⏭️</button>
            <span class="pip-time-display" id="pipTimeDisplay">00:00 / 00:00</span>
            <button class="pip-video-btn" onclick="pipVideoControl('mute')" title="Silenciar" id="pipMuteBtn">🔊</button>
        </div>
    </div>

    <script>
        // Estado del navegador
        let currentUrl = '';
        let isHomePage = true;
        let history = [];
        let historyIndex = -1;
        let tabs = [{ 
            id: 1, 
            title: 'Nueva pestaña', 
            url: '', 
            isActive: true, 
            webview: null,
            history: [],
            historyIndex: -1
        }];
        let activeTabId = 1;
        let tabCounter = 1;

        // Variables de modo privado
        let isPrivateMode = false;
        let currentPrivacyLayer = 0;
        let privateSessionId = null;

        // Estado de control de música
        let currentMediaInfo = {
            isPlaying: false,
            title: '',
            artist: '',
            source: '',
            currentTime: 0,
            totalTime: 0,
            volume: 100,
            shuffle: false,
            repeat: false,
            activeWebview: null,
            mediaTab: null
        };
        
        // ===================================================================
        // FUNCIONES DE SEGURIDAD - Validación de URLs
        // ===================================================================
        
        /**
         * Valida que una URL sea segura para navegar
         * @param {string} url - URL a validar
         * @returns {boolean} - true si la URL es segura
         */
        function isUrlSafe(url) {
            if (!url || typeof url !== 'string') return false;
            
            // Eliminar espacios
            url = url.trim();
            
            // Permitir URLs vacías (para about:blank)
            if (url === '' || url === 'about:blank') return true;
            
            try {
                const urlObj = new URL(url);
                
                // Protocolos permitidos
                const allowedProtocols = ['http:', 'https:', 'file:', 'about:'];
                if (!allowedProtocols.includes(urlObj.protocol)) {
                    console.warn('⚠️ Protocolo no permitido:', urlObj.protocol);
                    return false;
                }
                
                // Bloquear URLs potencialmente peligrosas
                const dangerousPatterns = [
                    'javascript:',
                    'data:text/html',
                    'vbscript:',
                    'file:///etc',
                    'file:///windows',
                    'file:///system'
                ];
                
                const urlLower = url.toLowerCase();
                for (const pattern of dangerousPatterns) {
                    if (urlLower.includes(pattern)) {
                        console.error('🚫 URL peligrosa bloqueada:', url);
                        return false;
                    }
                }
                
                return true;
            } catch (e) {
                // Si no es una URL válida, verificar si es un término de búsqueda válido
                if (!url.includes('<') && !url.includes('>') && !url.includes('script')) {
                    return true; // Permitir términos de búsqueda
                }
                console.error('❌ URL inválida:', url, e);
                return false;
            }
        }
        
        /**
         * Sanitiza una URL antes de usarla
         * @param {string} url - URL a sanitizar
         * @returns {string} - URL sanitizada
         */
        function sanitizeUrl(url) {
            if (!url) return 'about:blank';
            
            // Eliminar caracteres peligrosos
            url = url.trim()
                .replace(/<script[^>]*>.*?<\/script>/gi, '')
                .replace(/javascript:/gi, '')
                .replace(/vbscript:/gi, '')
                .replace(/on\w+\s*=/gi, '');
            
            return url;
        }
        
        // ===================================================================
        // FIN DE FUNCIONES DE SEGURIDAD
        // ===================================================================
        
        // Función para ocultar homepage
        function hideHomepage() {
            const homepage = document.getElementById('homepage');
            if (homepage) {
                homepage.style.display = 'none';
            }
        }
        
        // Función para mostrar homepage
        function showHomepage() {
            const homepage = document.getElementById('homepage');
            if (homepage) {
                homepage.style.display = 'flex';
            }
        }
        
        // Función para forzar visibilidad de controles
        function forceControlsVisibility() {
            const titleBar = document.querySelector('.title-bar');
            const tabBar = document.querySelector('.tab-bar');
            const navigationBar = document.querySelector('.navigation-bar');
            const controls = document.querySelectorAll('.control-button');
            const allClickables = document.querySelectorAll('button, [onclick], .homepage-shortcut-card, .dropdown-item');
            
            // Forzar elementos principales
            if (titleBar) {
                titleBar.style.display = 'flex';
                titleBar.style.visibility = 'visible';
                titleBar.style.zIndex = '2000';
                titleBar.style.opacity = '1';
                titleBar.style.pointerEvents = 'auto';
            }
            
            if (tabBar) {
                tabBar.style.display = 'flex';
                tabBar.style.visibility = 'visible';
                tabBar.style.zIndex = '1000';
                tabBar.style.opacity = '1';
                tabBar.style.pointerEvents = 'auto';
            }
            
            if (navigationBar) {
                navigationBar.style.display = 'flex';
                navigationBar.style.visibility = 'visible';
                navigationBar.style.zIndex = '1500';
                navigationBar.style.opacity = '1';
                navigationBar.style.pointerEvents = 'auto';
            }
            
            // Forzar controles
            controls.forEach(btn => {
                btn.style.pointerEvents = 'auto';
                btn.style.zIndex = '3000';
                btn.style.visibility = 'visible';
                btn.style.cursor = 'pointer';
            });
            
            // Forzar todos los elementos clicables
            allClickables.forEach(element => {
                element.style.pointerEvents = 'auto';
                element.style.cursor = 'pointer';
            });
            
            // Forzar body y app
            document.body.style.pointerEvents = 'auto';
            const app = document.querySelector('.app');
            if (app) {
                app.style.pointerEvents = 'auto';
            }
            
            console.log('🔧 Controles de interfaz forzados a ser clicables');
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('Neza Browser iniciado correctamente');
            updateCopyButtonState(); // Inicializar estado del botón de copia
            console.log('🚀 Neza Browser - Aplicación funcional completa');
            
            // RENDERIZAR PESTAÑAS PRIMERO
            renderTabs();
            console.log('✅ Pestañas renderizadas al inicio');
            
            // CONFIGURAR EVENTOS DE CLICK ADICIONALES
            setupClickEvents();
            
            // FORZAR CONTROLES CLICKEABLES
            forceControlsClickable();
            
            // FORZAR VISIBILIDAD DE CONTROLES
            forceControlsVisibility();
            
            // Inicializar modo normal por defecto
            applyNormalTheme();
            document.body.classList.add('normal-mode');
            
            // Crear webview para la primera pestaña
            const firstTab = tabs.find(tab => tab.id === 1);
            if (firstTab && !firstTab.webview) {
                firstTab.webview = createWebviewForTab(1);
                // Asegurar que esté visible si es la pestaña activa
                if (firstTab.isActive) {
                    firstTab.webview.style.display = 'flex';
                }
            }
            
            console.log('✅ Sistema de navegación inicializado');
            
            // ✅ AGREGAR EVENT LISTENERS CORRECTOS PARA TECLADO
            const addressInput = document.getElementById('addressInput');
            if (addressInput) {
                addressInput.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        console.log('🔍 ENTER en barra TRADICIONAL detectado!');
                        const query = addressInput.value.trim();
                        if (query) {
                            console.log('🌐 Query obtenida:', query);
                            
                            // Mejorar detección: si es una palabra simple como "youtube", buscar
                            let finalUrl;
                            if (query.includes('.') || query.startsWith('http')) {
                                // Es una URL
                                finalUrl = query.startsWith('http') ? query : 'https://' + query;
                            } else {
                                // Es una búsqueda - ir a Google
                                finalUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                            }
                            
                            console.log('📍 URL final:', finalUrl);
                            navigate(finalUrl);
                        } else {
                            console.log('❌ Query vacía en addressInput');
                        }
                    }
                });
                console.log('✅ Event listener añadido a addressInput');
            } else {
                console.log('❌ addressInput no encontrado!');
            }
            
            const homepageInput = document.getElementById('homepageSearchInput');
            if (homepageInput) {
                homepageInput.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        console.log('🔍 Enter detectado en búsqueda homepage');
                        const query = homepageInput.value.trim();
                        if (query) {
                            console.log('🚀 Buscando:', query);
                            if (isURL(query)) {
                                navigate(query);
                            } else {
                                const searchUrl = 'https://www.google.com/search?q=' + encodeURIComponent(query);
                                navigate(searchUrl);
                            }
                        }
                    }
                });
            }
            
            console.log('✅ Event listeners de teclado agregados correctamente');
            
            // ✅ INICIALIZAR SISTEMA DE DETECCIÓN DE MÚSICA
            setTimeout(() => {
                initializeMusicDetection();
            }, 2000);
        });

        // Funciones de navegación
        function goHome() {
            isHomePage = true;
            
            // Actualizar la pestaña activa
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab) {
                // Si la pestaña tiene historial y no está en inicio, y no es ya la página de inicio
                if (activeTab.url !== '' && activeTab.history.length > 0 && 
                    activeTab.history[activeTab.historyIndex] !== '') {
                    activeTab.history = activeTab.history.slice(0, activeTab.historyIndex + 1);
                    activeTab.history.push(''); // Página de inicio
                    activeTab.historyIndex = activeTab.history.length - 1;
                }
                
                activeTab.url = '';
                activeTab.title = 'Nueva pestaña';
                
                // Ocultar webview de esta pestaña si existe
                if (activeTab.webview) {
                    activeTab.webview.style.display = 'none';
                }
            }
            
            document.getElementById('homepage').style.display = 'flex';
            document.getElementById('webviewContainer').classList.remove('active');
            document.getElementById('addressInput').value = '';
            currentUrl = '';
            updateStatus('Página de inicio');
            updateNavigationButtons();
            updateCopyButtonState();
            renderTabs();
            console.log('🏠 Página de inicio');
        }

        // Funciones para el dropdown del logo de Neza
        function toggleNezaDropdown() {
            const dropdown = document.getElementById('NezaDropdown');
            const isVisible = dropdown.classList.contains('show');
            
            // Cerrar cualquier otro dropdown abierto
            closeAllDropdowns();
            
            if (!isVisible) {
                dropdown.classList.add('show');
                // Cerrar dropdown si se hace clic fuera
                setTimeout(() => {
                    document.addEventListener('click', closeDropdownOnClickOutside);
                }, 0);
            }
        }

        function closeAllDropdowns() {
            const dropdowns = document.querySelectorAll('.dropdown-content');
            dropdowns.forEach(dropdown => {
                dropdown.classList.remove('show');
            });
            document.removeEventListener('click', closeDropdownOnClickOutside);
        }

        function closeDropdownOnClickOutside(event) {
            const dropdown = document.getElementById('NezaDropdown');
            const brand = document.querySelector('.brand-dropdown');
            
            if (!brand.contains(event.target)) {
                closeAllDropdowns();
            }
        }

        // Funciones para las opciones del dropdown
        function openNewWindow() {
            console.log('🗔 Abriendo nueva ventana desde dropdown...');
            closeAllDropdowns();
            
            // Llamar a la función principal de crear nueva ventana
            createNewWindow();
        }

        // Función para activar Stealth Mode
        function activateStealthMode() {
            console.log('Activando Neza Stealth Mode...');
            closeAllDropdowns();
            showStealthModePanel();
        }

        // Panel de Stealth Mode
        function showStealthModePanel() {
            // Crear overlay si no existe
            let overlay = document.getElementById('stealthModeOverlay');
            if (!overlay) {
                overlay = createStealthModeOverlay();
                document.body.appendChild(overlay);
            }
            
            overlay.style.display = 'flex';
            overlay.style.opacity = '0';
            
            // Animación de entrada
            requestAnimationFrame(() => {
                overlay.style.opacity = '1';
            });
        }

        function createStealthModeOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'stealthModeOverlay';
            overlay.className = 'stealth-mode-overlay';
            
            overlay.innerHTML = `
                <div class="stealth-mode-panel" id="stealthModePanel">
                    <div class="stealth-header">
                        <div class="stealth-logo">
                            <span class="stealth-icon">🥷</span>
                            <h2>Neza Stealth Mode</h2>
                        </div>
                        <button class="close-stealth" onclick="closeStealthMode()">×</button>
                    </div>
                    
                    <div class="stealth-content" id="stealthContent">
                        <div class="stealth-description">
                            <p>Activa la navegación privada avanzada con múltiples capas de protección</p>
                        </div>
                        
                        <div class="stealth-layers">
                            <div class="stealth-layer" onclick="activateStealthLayer(1)">
                                <div class="layer-icon">🛡️</div>
                                <div class="layer-info">
                                    <h3>Capa 1: Básica</h3>
                                    <p>Navegación privada estándar, no guarda historial ni cookies</p>
                                </div>
                            </div>
                            
                            <div class="stealth-layer" onclick="activateStealthLayer(2)">
                                <div class="layer-icon">🔒</div>
                                <div class="layer-info">
                                    <h3>Capa 2: Shield</h3>
                                    <p>Bloqueo de rastreadores, protección anti-fingerprinting y DNS seguro</p>
                                </div>
                            </div>
                            
                            <div class="stealth-layer" onclick="activateStealthLayer(3)">
                                <div class="layer-icon">👻</div>
                                <div class="layer-info">
                                    <h3>Capa 3: Ghost Mode</h3>
                                    <p>Máxima privacidad con vault encriptado, modo paranoid y bloqueo de capturas</p>
                                </div>
                            </div>
                            
                            <div class="stealth-layer-extra">
                                <h4>🔧 Configuraciones Adicionales:</h4>
                                <ul style="color: #cccccc; font-size: 12px; line-height: 1.4;">
                                    <li>• Limpieza automática al cerrar</li>
                                    <li>• Bloqueo de WebRTC y geolocalización</li>
                                    <li>• User-Agent aleatorio por sesión</li>
                                    <li>• Encriptación de datos temporales</li>
                                    <li>• Protección contra análisis de tráfico</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="stealth-actions">
                            <button class="stealth-start-btn" onclick="startStealthSession()" style="
                                background: linear-gradient(45deg, var(--neza-primary), var(--neza-primary-light));
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: bold;
                                width: 100%;
                                margin-top: 20px;
                                transition: all 0.3s ease;
                            ">🚀 Iniciar Modo Stealth</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Configurar eventos de scroll después de crear el elemento
            setTimeout(() => {
                setupStealthPanelScroll();
            }, 100);
            
            return overlay;
        }
        
        function setupStealthPanelScroll() {
            const stealthContent = document.getElementById('stealthContent');
            const stealthPanel = document.getElementById('stealthModePanel');
            
            if (stealthContent) {
                // Detectar si hay contenido scrolleable
                function checkScroll() {
                    const hasScroll = stealthContent.scrollHeight > stealthContent.clientHeight;
                    if (hasScroll) {
                        stealthContent.classList.add('has-scroll');
                    } else {
                        stealthContent.classList.remove('has-scroll');
                    }
                }
                
                // Verificar scroll al cargar
                checkScroll();
                
                // Verificar scroll al redimensionar
                window.addEventListener('resize', checkScroll);
                
                // Bloqueo robusto de zoom
                function preventZoom() {
                    // Prevenir zoom con teclado
                    document.addEventListener('keydown', function(e) {
                        if ((e.ctrlKey || e.metaKey) && 
                            (e.key === '+' || e.key === '-' || e.key === '0' || 
                             e.keyCode === 187 || e.keyCode === 189 || e.keyCode === 48)) {
                            e.preventDefault();
                            return false;
                        }
                    });
                    
                    // Prevenir zoom con rueda del ratón
                    document.addEventListener('wheel', function(e) {
                        if (e.ctrlKey || e.metaKey) {
                            e.preventDefault();
                            return false;
                        }
                    }, { passive: false });
                    
                    // Mantener zoom fijo
                    document.body.style.zoom = '1';
                    document.documentElement.style.zoom = '1';
                }
                
                // Aplicar bloqueo de zoom
                preventZoom();
                window.addEventListener('load', preventZoom);
                
                // Smooth scroll para navegación por teclado
                stealthContent.addEventListener('keydown', function(e) {
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        stealthContent.scrollBy({ top: 50, behavior: 'smooth' });
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        stealthContent.scrollBy({ top: -50, behavior: 'smooth' });
                    }
                });
                
                // Permitir scroll nativo (remover preventDefault)
                stealthContent.addEventListener('wheel', function(e) {
                    // No prevenir el comportamiento nativo para permitir scroll normal
                    console.log('🖱️ Scroll detectado en panel Stealth');
                });
            }
        }

        function closeStealthMode() {
            const overlay = document.getElementById('stealthModeOverlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 300);
            }
        }

        function activateStealthLayer(layer) {
            console.log(`Activando Stealth Layer ${layer}`);
            closeStealthMode();
            
            // Aquí implementaremos cada capa de stealth mode
            switch(layer) {
                case 1:
                    activateBasicStealth();
                    break;
                case 2:
                    activateShieldStealth();
                    break;
                case 3:
                    activateGhostStealth();
                    break;
            }
        }

        function activateBasicStealth() {
            console.log('Activando Stealth Básico...');
            // Crear nueva pestaña en modo incógnito
            createNewTab();
            updateStatus('🛡️ Modo Stealth Básico Activado');
        }

        function activateShieldStealth() {
            console.log('Activando Stealth Shield...');
            createNewTab();
            updateStatus('🔒 Modo Stealth Shield Activado');
        }

        function activateGhostStealth() {
            console.log('Activando Ghost Mode...');
            createNewTab();
            updateStatus('👻 Ghost Mode Activado - Máxima Privacidad');
        }

        function navigate(url) {
            console.log('🌐 Navigate ejecutada con URL:', url);
            if (!url) {
                console.log('❌ Navigate: URL vacía');
                return;
            }
            
            // Sanitizar URL primero
            url = sanitizeUrl(url);
            
            // Validar seguridad de la URL
            if (!isUrlSafe(url)) {
                console.error('🚫 URL bloqueada por seguridad:', url);
                updateStatus('⚠️ URL bloqueada por razones de seguridad');
                hideLoading();
                return;
            }
            
            console.log('🔄 Mostrando loading...');
            showLoading();
            
            // Limpiar y validar URL
            url = url.trim();
            
            if (!url.match(/^https?:\/\//)) {
                if (url.includes('.') && !url.includes(' ') && url.length > 3) {
                    url = 'https://' + url;
                } else {
                    url = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
                }
            }
            
            // Obtener la pestaña activa primero
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (!activeTab) return;
            
            // Si es la primera navegación desde la página de inicio, agregar el estado de inicio al historial
            if (activeTab.history.length === 0 && isHomePage) {
                activeTab.history.push(''); // Página de inicio
                activeTab.historyIndex = 0;
            }
            
            // Agregar a historial de la pestaña activa
            if (activeTab.url !== url) {
                activeTab.history = activeTab.history.slice(0, activeTab.historyIndex + 1);
                activeTab.history.push(url);
                activeTab.historyIndex = activeTab.history.length - 1;
            }
            
            currentUrl = url;
            isHomePage = false;
            
            // Actualizar interfaz
            const homepage = document.getElementById('homepage');
            const webviewContainer = document.getElementById('webviewContainer');
            
            homepage.style.display = 'none';
            homepage.style.pointerEvents = 'none';
            
            webviewContainer.classList.add('active');
            webviewContainer.style.display = 'flex';
            webviewContainer.style.pointerEvents = 'auto';
            
            console.log('📱 Contenedor webview activado:', {
                active: webviewContainer.classList.contains('active'),
                display: webviewContainer.style.display,
                children: webviewContainer.children.length
            });
            

            
            // Si la pestaña no tiene webview, crear uno
            if (!activeTab.webview) {
                activeTab.webview = createWebviewForTab(activeTab.id);
            }
            
            // Actualizar datos de la pestaña
            activeTab.url = url;
            activeTab.title = getDomainFromUrl(url);
            
            // Ocultar todos los webviews primero
            tabs.forEach(tab => {
                if (tab.webview) {
                    tab.webview.style.display = 'none';
                }
            });
            
            // Mostrar el webview específico de esta pestaña
            console.log('🔗 Navegando a:', url);
            
            // Intentar método directo primero
            try {
                activeTab.webview.style.display = 'block';
                activeTab.webview.style.position = 'absolute';
                activeTab.webview.style.top = '0';
                activeTab.webview.style.left = '0';
                activeTab.webview.style.width = '100%';
                activeTab.webview.style.height = '100%';
                activeTab.webview.style.pointerEvents = 'auto';
                activeTab.webview.style.zIndex = '100';
                
                // Método 1: Usar loadURL si está disponible (método preferido)
                if (activeTab.webview.loadURL && typeof activeTab.webview.loadURL === 'function') {
                    console.log('✅ Usando loadURL (método preferido)');
                    activeTab.webview.loadURL(url);
                } else {
                    // Método 2: Asignación directa
                    console.log('✅ Usando src assignment');
                    activeTab.webview.src = url;
                }
                
                // Método de respaldo después de 3 segundos
                setTimeout(() => {
                    if (activeTab.webview.src === 'about:blank' || activeTab.webview.src === '') {
                        console.log('⚠️ Webview no navegó, usando método de respaldo...');
                        activeTab.webview.setAttribute('src', url);
                        // Forzar recarga si es necesario
                        if (activeTab.webview.reload && typeof activeTab.webview.reload === 'function') {
                            setTimeout(() => activeTab.webview.reload(), 1000);
                        }
                    }
                }, 3000);
                
            } catch (error) {
                console.error('❌ Error en navegación:', error);
                // Método de emergencia
                activeTab.webview.setAttribute('src', url);
            }
            
            // Mostrar solo el dominio en lugar de la URL completa
            document.getElementById('addressInput').value = getDomainFromUrl(url);
            
            updateStatus(`Navegando a ${url}`);
            updateNavigationButtons();
            updateActiveTab(getDomainFromUrl(url), url);
            updateCopyButtonState();
            
            // Actualizar status bar
            document.getElementById('urlStatus').textContent = url;
            
            console.log('🌐 Navegación completa a:', url);
            
            // Diagnóstico completo después de 3 segundos
            setTimeout(() => {
                diagnosticarNavegacion(activeTab, url);
            }, 3000);
        }
        
        // Función de diagnóstico completo
        function diagnosticarNavegacion(tab, expectedUrl) {
            console.log('🔍 DIAGNÓSTICO COMPLETO:');
            console.log('  📋 Pestaña:', tab.id, tab.title);
            console.log('  🎯 URL esperada:', expectedUrl);
            console.log('  🌐 Webview src:', tab.webview ? tab.webview.src : 'NO WEBVIEW');
            console.log('  👀 Webview visible:', tab.webview ? tab.webview.style.display : 'N/A');
            console.log('  📦 Contenedor activo:', document.getElementById('webviewContainer').classList.contains('active'));
            
            if (tab.webview) {
                console.log('  🔧 Atributos webview:', {
                    allowpopups: tab.webview.allowpopups,
                    disablewebsecurity: tab.webview.disablewebsecurity,
                    nodeintegration: tab.webview.nodeintegration,
                    partition: tab.webview.getAttribute('partition')
                });
                
                // Intentar obtener el contenido
                try {
                    console.log('  📄 Intentando acceder al contenido...');
                    tab.webview.executeJavaScript('document.title').then(title => {
                        console.log('  📝 Título de página:', title);
                    }).catch(e => {
                        console.log('  ❌ No se puede acceder al contenido:', e.message);
                    });
                } catch (e) {
                    console.log('  ❌ Error ejecutando JS:', e.message);
                }
            }
        }

        function handleEnter(event) {
            console.log('🔍 handleEnter activada, tecla:', event.key);
            if (event.key === 'Enter') {
                const url = document.getElementById('addressInput').value.trim();
                console.log('🔍 URL a navegar:', url);
                if (url) {
                    console.log('🔍 Llamando a navigate...');
                    navigate(url);
                } else {
                    console.log('❌ URL vacía');
                }
            }
        }

        function search() {
            const query = document.getElementById('addressInput').value.trim();
            if (query) {
                navigate(query);
            }
        }

        function goBack() {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab && activeTab.historyIndex > 0) {
                activeTab.historyIndex--;
                const url = activeTab.history[activeTab.historyIndex];
                
                // Si la URL es vacía, significa que regresamos a la página de inicio
                if (url === '' || url === 'about:blank') {
                    activeTab.url = '';
                    activeTab.title = 'Nueva pestaña';
                    currentUrl = '';
                    isHomePage = true;
                    
                    // Ocultar webview y mostrar página de inicio
                    if (activeTab.webview) {
                        activeTab.webview.style.display = 'none';
                    }
                    document.getElementById('homepage').style.display = 'flex';
                    document.getElementById('webviewContainer').classList.remove('active');
                    document.getElementById('addressInput').value = '';
                    
                    updateNavigationButtons();
                    updateCopyButtonState();
                    updateStatus('Página de inicio');
                    renderTabs();
                } else {
                    // Navegación normal a una página web
                    if (activeTab.webview) {
                        activeTab.webview.src = url;
                        activeTab.url = url;
                        currentUrl = url;
                        isHomePage = false;
                        
                        // Mostrar webview y ocultar página de inicio
                        document.getElementById('homepage').style.display = 'none';
                        document.getElementById('webviewContainer').classList.add('active');
                        activeTab.webview.style.display = 'flex';
                        
                        document.getElementById('addressInput').value = getDomainFromUrl(url);
                        updateNavigationButtons();
                        updateCopyButtonState();
                        updateStatus(`Atrás: ${getDomainFromUrl(url)}`);
                        
                        // Actualizar título de pestaña
                        renderTabs();
                    }
                }
            }
        }

        function goForward() {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab && activeTab.historyIndex < activeTab.history.length - 1) {
                activeTab.historyIndex++;
                const url = activeTab.history[activeTab.historyIndex];
                
                // Si la URL es vacía, significa que vamos a la página de inicio
                if (url === '' || url === 'about:blank') {
                    activeTab.url = '';
                    activeTab.title = 'Nueva pestaña';
                    currentUrl = '';
                    isHomePage = true;
                    
                    // Ocultar webview y mostrar página de inicio
                    if (activeTab.webview) {
                        activeTab.webview.style.display = 'none';
                    }
                    document.getElementById('homepage').style.display = 'flex';
                    document.getElementById('webviewContainer').classList.remove('active');
                    document.getElementById('addressInput').value = '';
                    
                    updateNavigationButtons();
                    updateCopyButtonState();
                    updateStatus('Página de inicio');
                    renderTabs();
                } else {
                    // Navegación normal a una página web
                    if (activeTab.webview) {
                        activeTab.webview.src = url;
                        activeTab.url = url;
                        currentUrl = url;
                        isHomePage = false;
                        
                        // Mostrar webview y ocultar página de inicio
                        document.getElementById('homepage').style.display = 'none';
                        document.getElementById('webviewContainer').classList.add('active');
                        activeTab.webview.style.display = 'flex';
                        
                        document.getElementById('addressInput').value = getDomainFromUrl(url);
                        updateNavigationButtons();
                        updateCopyButtonState();
                        updateStatus(`Adelante: ${getDomainFromUrl(url)}`);
                        
                        // Actualizar título de pestaña
                        renderTabs();
                    }
                }
            }
        }

        function refresh() {
            if (!isHomePage) {
                const activeTab = tabs.find(tab => tab.id === activeTabId);
                if (activeTab && activeTab.webview && activeTab.url) {
                    showLoading();
                    activeTab.webview.src = activeTab.url;
                    updateStatus('Actualizando página...');
                }
            } else {
                updateStatus('Página de inicio actualizada');
            }
        }

        // Funciones de pestañas
        function newTab() {
            console.log('🆕 newTab() EJECUTADA');
            console.log('📊 Pestañas antes:', tabs.length);
            console.log('🔢 tabCounter antes:', tabCounter);
            
            tabCounter++;
            const newTabObj = {
                id: tabCounter,
                title: isPrivateMode ? 'Pestaña privada' : 'Nueva pestaña',
                url: '',
                isActive: true,
                webview: null,
                history: [],
                historyIndex: -1,
                hasAudio: false,
                isMuted: false,
                isPrivate: isPrivateMode,
                privacyLayer: isPrivateMode ? currentPrivacyLayer : 0
            };
            
            console.log('✅ Nueva pestaña creada con ID:', newTabObj.id);
            
            // Desactivar todas las pestañas existentes
            tabs.forEach(tab => {
                tab.isActive = false;
                console.log('📝 Desactivando pestaña:', tab.id);
            });
            
            tabs.push(newTabObj);
            activeTabId = newTabObj.id;
            
            console.log('📊 Pestañas después:', tabs.length);
            console.log('🎯 ID activo:', activeTabId);
            
            // Crear webview inmediatamente para esta pestaña
            newTabObj.webview = createWebviewForTab(newTabObj.id);
            console.log('🌐 Webview creado para pestaña:', newTabObj.id);
            
            // Renderizar las pestañas primero
            renderTabs();
            
            // Luego cambiar a la nueva pestaña y forzar actualización
            switchToTab(newTabObj.id);
            
            // Mostrar homepage inmediatamente para nueva pestaña
            isHomePage = true;
            document.getElementById('homepage').style.display = 'flex';
            document.getElementById('webviewContainer').classList.remove('active');
            document.getElementById('addressInput').value = '';
            
            updateStatus(`Nueva pestaña ${newTabObj.id} creada (Total: ${tabs.length})`);
            console.log('✅ newTab() COMPLETADA');
        }

        function closeTab(tabId) {
            if (tabs.length === 1) {
                closeApp();
                return;
            }
            
            const tabIndex = tabs.findIndex(tab => tab.id === tabId);
            if (tabIndex !== -1) {
                const tabToClose = tabs[tabIndex];
                
                // Limpiar el webview de la pestaña que se cierra
                if (tabToClose.webview) {
                    tabToClose.webview.remove();
                }
                
                tabs.splice(tabIndex, 1);
                
                if (activeTabId === tabId) {
                    const newActiveTab = tabs[Math.max(0, tabIndex - 1)];
                    switchToTab(newActiveTab.id);
                }
                
                renderTabs();
                updateStatus('Pestaña cerrada');
            }
        }

        function switchToTab(tabId) {
            console.log('🔄 switchToTab llamada:', tabId);
            
            // Desactivar todas las pestañas y ocultar webviews
            tabs.forEach(tab => {
                tab.isActive = false;
                if (tab.webview) {
                    tab.webview.style.display = 'none';
                }
            });
            
            // Activar la pestaña seleccionada
            const tab = tabs.find(t => t.id === tabId);
            if (tab) {
                tab.isActive = true;
                activeTabId = tabId;
                console.log('✅ Pestaña activada:', tab.id, 'URL:', tab.url, 'Stealth:', tab.isStealthMode);
                
                // Si la pestaña no tiene webview y tiene URL, crear uno
                if (!tab.webview && tab.url) {
                    console.log('🔧 Creando webview para pestaña con URL');
                    tab.webview = createWebviewForTab(tab.id);
                    
                    // Cargar la URL después de crear el webview
                    setTimeout(() => {
                        if (tab.webview) {
                            console.log('🚀 Cargando URL en nuevo webview:', tab.url);
                            tab.webview.src = tab.url;
                        }
                    }, 100);
                }
                
                if (tab.url && tab.webview) {
                    // Mostrar webview con absolute positioning
                    tab.webview.style.display = 'block';
                    tab.webview.style.visibility = 'visible';
                    tab.webview.style.opacity = '1';
                    tab.webview.style.position = 'absolute';
                    tab.webview.style.top = '0';
                    tab.webview.style.left = '0';
                    tab.webview.style.width = '100%';
                    tab.webview.style.height = '100%';
                    tab.webview.style.background = 'white';
                    tab.webview.style.pointerEvents = 'auto';
                    tab.webview.style.zIndex = '100';
                    
                    // Mostrar contenedor y ocultar homepage
                    const homepage = document.getElementById('homepage');
                    const container = document.getElementById('webviewContainer');
                    
                    homepage.style.display = 'none';
                    homepage.style.pointerEvents = 'none';
                    container.classList.add('active');
                    container.style.display = 'flex';
                    container.style.visibility = 'visible';
                    container.style.pointerEvents = 'auto';
                    
                    document.getElementById('addressInput').value = getDomainFromUrl(tab.url);
                    isHomePage = false;
                    currentUrl = tab.url;
                    
                    // Asegurar que el webview tiene la URL correcta
                    if (tab.webview.src !== tab.url) {
                        console.log('🔄 RECARGANDO webview con URL correcta');
                        tab.webview.src = tab.url;
                    }
                } else {
                    // Mostrar homepage para pestañas vacías
                    console.log('🏠 Mostrando homepage para pestaña vacía');
                    const homepage = document.getElementById('homepage');
                    const container = document.getElementById('webviewContainer');
                    
                    homepage.style.display = 'flex';
                    homepage.style.pointerEvents = 'auto';
                    homepage.style.zIndex = '1';
                    
                    container.classList.remove('active');
                    container.style.display = 'none';
                    container.style.pointerEvents = 'none';
                    
                    // Aplicar zoom actual a la homepage si no es 100%
                    if (currentZoomLevel !== 100) {
                        const zoomFactor = currentZoomLevel / 100;
                        homepage.style.transform = `scale(${zoomFactor})`;
                        homepage.style.transformOrigin = 'top center';
                    } else {
                        homepage.style.transform = 'scale(1)';
                        homepage.style.transformOrigin = 'top center';
                    }
                    
                    document.getElementById('addressInput').value = '';
                    isHomePage = true;
                    currentUrl = '';
                    
                    // Si es una pestaña stealth, mostrar homepage especial
                    if (tab.isStealthMode) {
                        showStealthHomepage(tab.stealthLayer);
                    } else {
                        // Restaurar homepage normal si venimos de stealth
                        restoreNormalHomepage();
                    }
                }
                
                // Aplicar el zoom actual a la webview activa
                if (tab.webview) {
                    applyZoomToWebview(tab.webview, currentZoomLevel);
                }
                
                updateNavigationButtons();
                updateCopyButtonState();
                renderTabs();
                updateStatus(`Pestaña activa: ${tab.title}`);
                console.log('✅ switchToTab completado');
            } else {
                console.error('❌ Pestaña no encontrada:', tabId);
            }
        }

        function restoreNormalHomepage() {
            const homepage = document.getElementById('homepage');
            const welcomeTitle = homepage.querySelector('.welcome-title');
            const searchInput = document.getElementById('homepageSearchInput');
            
            if (welcomeTitle) {
                welcomeTitle.innerHTML = `
                    What do you want<br>
                    to explore today?
                `;
            }
            
            if (searchInput) {
                searchInput.placeholder = 'Search with Neza...';
                searchInput.style.background = '';
                searchInput.style.borderColor = '';
            }
        }
            
            // Forzar mantenimiento del estado visual después del render
            setTimeout(() => {
                forceVisualStateUpdate();
                setupWebviewEventListeners();
                // Video overlay solo se activa manualmente con Ctrl+Shift+V
            }, 1000);

        function renderTabs() {
            const tabBar = document.getElementById('tabBar');
            const tabsHtml = tabs.map(tab => {
                // Determinar clases CSS basadas en el estado de audio y modo privado
                let tabClasses = 'tab';
                if (tab.isActive) tabClasses += ' active';
                if (tab.hasAudio) tabClasses += ' has-audio';
                if (tab.isMuted) tabClasses += ' audio-muted';
                if (tab.isStealthMode || tab.isPrivate) tabClasses += ' stealth-tab';
                if (tab.isPrivate && isPrivateMode) tabClasses += ' private-tab';
                
                // Agregar estilos especiales para pestañas stealth
                let tabStyle = '';
                if (tab.isStealthMode) {
                    const stealthColors = {
                        1: 'linear-gradient(135deg, rgba(58, 58, 58, 0.9), rgba(78, 78, 78, 0.9))',
                        2: 'linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(75, 0, 130, 0.3))',
                        3: 'linear-gradient(135deg, rgba(138, 43, 226, 0.5), rgba(75, 0, 130, 0.5))'
                    };
                    tabStyle = `background: ${stealthColors[tab.stealthLayer] || stealthColors[1]}; border: 1px solid #8A2BE2;`;
                }
                
                // Mostrar botón de audio solo si está silenciado (permanente) o si tiene audio (hover)
                let audioButtonHtml = '';
                if (tab.hasAudio) {
                    const audioIcon = tab.isMuted ? '🔇' : '🔊';
                    const audioTitle = tab.isMuted ? 
                        'Audio silenciado - Clic para activar' : 
                        'Audio activo - Clic para silenciar';
                    
                    // Si está silenciado, mostrar permanente (visible). Si no, solo en hover (hidden)
                    const buttonClass = tab.isMuted ? 'tab-audio-button visible' : 'tab-audio-button';
                    
                    audioButtonHtml = `<button class="${buttonClass}" onclick="event.stopPropagation(); toggleTabAudioSimple(${tab.id}, event)" title="${audioTitle}">${audioIcon}</button>`;
                }
                
                // Título e icono especial para pestañas privadas
                let tabTitle = tab.title;
                let tabIcon = '';
                if (tab.isPrivate && isPrivateMode) {
                    tabIcon = '🕶️ ';
                    tabTitle = `${tab.title} - Modo Privado ${getLayerName(tab.privacyLayer || currentPrivacyLayer)}`;
                } else if (tab.isStealthMode) {
                    tabIcon = '👻 ';
                    tabTitle = `${tab.title} - ${getStealthTooltip(tab.stealthLayer)}`;
                }
                
                return `
                    <div class="${tabClasses}" id="tab-${tab.id}" onclick="switchToTab(${tab.id})" data-tab-id="${tab.id}" style="${tabStyle}" title="${tabTitle}">
                        <div class="tab-title">
                            <span class="tab-icon">${tabIcon}</span>
                            <span class="tab-title-text">${tab.title}</span>
                        </div>
                        ${audioButtonHtml}
                        <span class="tab-close" onclick="event.stopPropagation(); closeTab(${tab.id})">×</span>
                    </div>
                `;
            }).join('');
            
            tabBar.innerHTML = tabsHtml + '<button class="new-tab-button" onclick="newTab()" title="Nueva pestaña (Ctrl+T)">+</button>';
            
            // Forzar reflow del DOM para asegurar que las pestañas se muestren
            tabBar.offsetHeight;
            
            // Aplicar animación de scrolling después de renderizar
            setTimeout(() => {
                document.querySelectorAll('.tab').forEach(tabElement => {
                    checkTabTextScrolling(tabElement);
                });
                // Asegurar que la pestaña activa esté visible
                forceTabVisibility();
                // Configurar drag & drop y menú contextual
                setupTabDragAndDrop();
                setupTabContextMenu();
            }, 100);
        }

        // ============ DRAG & DROP DE PESTAÑAS ============
        let draggedTab = null;
        let draggedTabId = null;

        function setupTabDragAndDrop() {
            const tabElements = document.querySelectorAll('.tab');
            
            tabElements.forEach(tabEl => {
                tabEl.setAttribute('draggable', 'true');
                
                tabEl.addEventListener('dragstart', (e) => {
                    draggedTab = tabEl;
                    draggedTabId = parseInt(tabEl.dataset.tabId);
                    tabEl.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', tabEl.innerHTML);
                });
                
                tabEl.addEventListener('dragend', (e) => {
                    tabEl.classList.remove('dragging');
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('drag-over'));
                    draggedTab = null;
                    draggedTabId = null;
                });
                
                tabEl.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    if (draggedTab && draggedTab !== tabEl) {
                        tabEl.classList.add('drag-over');
                    }
                });
                
                tabEl.addEventListener('dragleave', (e) => {
                    tabEl.classList.remove('drag-over');
                });
                
                tabEl.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    tabEl.classList.remove('drag-over');
                    
                    if (draggedTabId && draggedTab !== tabEl) {
                        const targetTabId = parseInt(tabEl.dataset.tabId);
                        reorderTabs(draggedTabId, targetTabId);
                    }
                });
            });
        }

        function reorderTabs(sourceId, targetId) {
            const sourceIndex = tabs.findIndex(t => t.id === sourceId);
            const targetIndex = tabs.findIndex(t => t.id === targetId);
            
            if (sourceIndex !== -1 && targetIndex !== -1) {
                // Remover pestaña de posición original
                const [movedTab] = tabs.splice(sourceIndex, 1);
                
                // Insertar en nueva posición
                tabs.splice(targetIndex, 0, movedTab);
                
                renderTabs();
                updateStatus(`Pestaña reordenada: ${movedTab.title}`);
            }
        }

        // ============ MENÚ CONTEXTUAL DE PESTAÑAS ============
        let contextMenuTabId = null;

        function setupTabContextMenu() {
            const tabElements = document.querySelectorAll('.tab');
            const contextMenu = document.getElementById('tabContextMenu');
            
            tabElements.forEach(tabEl => {
                tabEl.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    contextMenuTabId = parseInt(tabEl.dataset.tabId);
                    showTabContextMenu(e.clientX, e.clientY);
                });
            });
            
            // Cerrar menú al hacer clic fuera
            document.addEventListener('click', () => {
                hideTabContextMenu();
            });
        }

        function showTabContextMenu(x, y) {
            const contextMenu = document.getElementById('tabContextMenu');
            const tab = tabs.find(t => t.id === contextMenuTabId);
            
            if (!tab) return;
            
            // Actualizar texto de silenciar
            const muteText = document.getElementById('contextMuteText');
            if (tab.isMuted) {
                muteText.textContent = 'Activar sonido de pestaña';
            } else {
                muteText.textContent = 'Silenciar pestaña';
            }
            
            // Posicionar menú
            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            contextMenu.classList.add('show');
            
            // Ajustar si se sale de la pantalla
            setTimeout(() => {
                const rect = contextMenu.getBoundingClientRect();
                if (rect.right > window.innerWidth) {
                    contextMenu.style.left = (x - rect.width) + 'px';
                }
                if (rect.bottom > window.innerHeight) {
                    contextMenu.style.top = (y - rect.height) + 'px';
                }
            }, 10);
        }

        function hideTabContextMenu() {
            const contextMenu = document.getElementById('tabContextMenu');
            contextMenu.classList.remove('show');
        }

        // Funciones del menú contextual
        function contextReloadTab() {
            hideTabContextMenu();
            const tab = tabs.find(t => t.id === contextMenuTabId);
            if (tab && tab.webview) {
                tab.webview.reload();
                updateStatus('Pestaña recargada');
            }
        }

        function contextDuplicateTab() {
            hideTabContextMenu();
            const tab = tabs.find(t => t.id === contextMenuTabId);
            if (tab) {
                tabCounter++;
                const duplicatedTab = {
                    id: tabCounter,
                    title: tab.title,
                    url: tab.url,
                    isActive: false,
                    webview: null,
                    history: [...tab.history],
                    historyIndex: tab.historyIndex,
                    hasAudio: false,
                    isMuted: tab.isMuted,
                    isPrivate: tab.isPrivate,
                    isStealthMode: tab.isStealthMode,
                    stealthLayer: tab.stealthLayer,
                    privacyLayer: tab.privacyLayer
                };
                
                // Insertar después de la pestaña original
                const originalIndex = tabs.findIndex(t => t.id === contextMenuTabId);
                tabs.splice(originalIndex + 1, 0, duplicatedTab);
                
                // Crear webview si tiene URL
                if (duplicatedTab.url) {
                    duplicatedTab.webview = createWebviewForTab(duplicatedTab.id);
                    setTimeout(() => {
                        if (duplicatedTab.webview) {
                            duplicatedTab.webview.src = duplicatedTab.url;
                        }
                    }, 100);
                }
                
                renderTabs();
                updateStatus(`Pestaña duplicada: ${tab.title}`);
            }
        }

        function contextPinTab() {
            hideTabContextMenu();
            const tab = tabs.find(t => t.id === contextMenuTabId);
            if (tab) {
                tab.isPinned = !tab.isPinned;
                renderTabs();
                updateStatus(tab.isPinned ? 'Pestaña fijada' : 'Pestaña desfijada');
            }
        }

        function contextMuteTab() {
            hideTabContextMenu();
            toggleTabAudioSimple(contextMenuTabId);
        }

        function contextCloseTab() {
            hideTabContextMenu();
            closeTab(contextMenuTabId);
        }

        function contextCloseOtherTabs() {
            hideTabContextMenu();
            const tab = tabs.find(t => t.id === contextMenuTabId);
            if (!tab) return;
            
            const otherTabs = tabs.filter(t => t.id !== contextMenuTabId);
            otherTabs.forEach(t => {
                if (t.webview) {
                    t.webview.remove();
                }
            });
            
            tabs = [tab];
            activeTabId = tab.id;
            tab.isActive = true;
            
            renderTabs();
            updateStatus('Otras pestañas cerradas');
        }

        function contextCloseTabsToRight() {
            hideTabContextMenu();
            const tabIndex = tabs.findIndex(t => t.id === contextMenuTabId);
            if (tabIndex === -1) return;
            
            const tabsToClose = tabs.slice(tabIndex + 1);
            tabsToClose.forEach(t => {
                if (t.webview) {
                    t.webview.remove();
                }
            });
            
            tabs = tabs.slice(0, tabIndex + 1);
            
            // Si cerramos la pestaña activa, activar la del menú
            if (!tabs.find(t => t.id === activeTabId)) {
                switchToTab(contextMenuTabId);
            }
            
            renderTabs();
            updateStatus('Pestañas a la derecha cerradas');
        }

        function contextCopyUrl() {
            hideTabContextMenu();
            const tab = tabs.find(t => t.id === contextMenuTabId);
            if (tab && tab.url) {
                navigator.clipboard.writeText(tab.url).then(() => {
                    updateStatus('URL copiada al portapapeles');
                }).catch(err => {
                    console.error('Error al copiar URL:', err);
                    updateStatus('❌ Error al copiar URL');
                });
            }
        }

        function getStealthTooltip(layer) {
            const tooltips = {
                1: 'Navegación privada básica activa',
                2: 'Protección avanzada contra rastreadores',
                3: 'Modo fantasma - Máxima privacidad'
            };
            return tooltips[layer] || 'Modo stealth activo';
        }

        // Función para forzar la visibilidad de la pestaña activa
        function forceTabVisibility() {
            const activeTab = tabs.find(tab => tab.isActive);
            if (activeTab && activeTab.webview) {
                activeTab.webview.style.display = 'flex';
                
                // También actualizar el DOM de las pestañas
                document.querySelectorAll('.tab').forEach(tabElement => {
                    const tabId = parseInt(tabElement.dataset.tabId);
                    if (tabId === activeTab.id) {
                        tabElement.classList.add('active');
                    } else {
                        tabElement.classList.remove('active');
                    }
                });
            }
        }

        // Función simplificada eliminada para estabilidad

        function checkTabTextScrolling(tabElement) {
            const titleContainer = tabElement.querySelector('.tab-title');
            const textElement = tabElement.querySelector('.tab-title-text');
            
            if (textElement && titleContainer) {
                const containerWidth = titleContainer.offsetWidth - 20; // Margen para el botón de cerrar
                const textWidth = textElement.scrollWidth;
                
                if (textWidth > containerWidth) {
                    textElement.classList.add('scrolling');
                } else {
                    textElement.classList.remove('scrolling');
                }
            }
        }

        function updateActiveTab(title, url) {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab) {
                activeTab.title = title || 'Nueva pestaña';
                activeTab.url = url || '';
                renderTabs();
            }
        }

        // Funciones de utilidad
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function updateNavigationButtons() {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab) {
                document.getElementById('backBtn').disabled = activeTab.historyIndex <= 0;
                document.getElementById('forwardBtn').disabled = activeTab.historyIndex >= activeTab.history.length - 1;
            } else {
                document.getElementById('backBtn').disabled = true;
                document.getElementById('forwardBtn').disabled = true;
            }
        }

        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
            console.log('📊 Status:', text);
        }

        function getDomainFromUrl(url) {
            try {
                return new URL(url).hostname || url;
            } catch {
                return url.substring(0, 30) + (url.length > 30 ? '...' : '');
            }
        }

        // Función para crear webview por pestaña con CSS mejorado
        function createWebviewForTab(tabId) {
            const container = document.getElementById('webviewContainer');
            
            // Crear nuevo webview con configuración CORREGIDA
            const webview = document.createElement('webview');
            webview.id = `webview-${tabId}`;
            webview.className = 'webview';
            webview.src = 'about:blank';
            
            // CONFIGURACIÓN SEGURA MEJORADA
            webview.setAttribute('allowpopups', 'true');
            // Removidas configuraciones inseguras: disablewebsecurity, nodeintegration
            webview.setAttribute('plugins', 'true');
            webview.setAttribute('webpreferences', 'javascript=yes,images=yes,contextIsolation=yes,sandbox=yes');
            webview.setAttribute('partition', `persist:webview-${tabId}`);
            webview.setAttribute('useragent', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Neza/2.1.0');
            
            console.log(`🌐 Creando webview CORREGIDO para pestaña ${tabId}`);
            
            // Estilos mejorados - usar absolute positioning dentro del contenedor
            webview.style.display = 'none';
            webview.style.position = 'absolute';
            webview.style.top = '0';
            webview.style.left = '0';
            webview.style.border = 'none';
            webview.style.background = '#ffffff';
            webview.style.width = '100%';
            webview.style.height = '100%';
            webview.style.pointerEvents = 'auto';
            
            container.appendChild(webview);
            
            // Configurar eventos para este webview
            setupWebviewEvents(webview, tabId);
            
            // Configurar listeners específicos para funcionalidades de audio y video
            webview.addEventListener('dom-ready', () => {
                console.log(`Webview ${tabId} DOM ready - configurando listeners`);
                
                // Aplicar el zoom actual al nuevo webview
                applyZoomToWebview(webview, currentZoomLevel);
                
                // Inyectar overlay si es sitio de video
                setTimeout(() => {
                    injectVideoOverlay();
                    checkTabAudio();
                }, 2000);
            });
            
            webview.addEventListener('did-stop-loading', () => {
                console.log(`Webview ${tabId} terminó de cargar`);
                
                // Re-aplicar zoom después de cargar la página
                applyZoomToWebview(webview, currentZoomLevel);
                
                // Re-inyectar overlay después de que termine de cargar
                setTimeout(() => {
                    injectVideoOverlay();
                    checkTabAudio();
                }, 1500);
            });
            
            return webview;
        }

        // Configurar eventos específicos para cada webview
        function setupWebviewEvents(webview, tabId) {
            webview.addEventListener('dom-ready', () => {
                if (activeTabId === tabId) {
                    hideLoading();
                    updateStatus('Página cargada correctamente');
                    updateNavigationButtons();
                }
                console.log(`✅ Webview ${tabId} DOM ready`);
            });
            
            webview.addEventListener('did-start-loading', () => {
                if (activeTabId === tabId) {
                    showLoading();
                    updateStatus('Cargando página...');
                }
                console.log(`🔄 Webview ${tabId} iniciando carga...`);
            });
            
            webview.addEventListener('did-stop-loading', () => {
                if (activeTabId === tabId) {
                    hideLoading();
                    updateStatus('Página cargada');
                }
                console.log(`✅ Webview ${tabId} carga completada`);
            });
            
            // Timeout de emergencia para detectar páginas que no cargan
            webview.addEventListener('did-start-loading', () => {
                setTimeout(() => {
                    if (activeTabId === tabId && webview.src && webview.src !== 'about:blank') {
                        console.log('⚠️ Timeout de carga detectado, forzando fin de loading');
                        hideLoading();
                        updateStatus('Página cargada (timeout)');
                    }
                }, 10000); // 10 segundos timeout
            });
            
            webview.addEventListener('did-fail-load', (event) => {
                console.error(`❌ Webview ${tabId} error de carga:`, {
                    errorCode: event.errorCode,
                    errorDescription: event.errorDescription,
                    validatedURL: event.validatedURL,
                    isMainFrame: event.isMainFrame
                });
                
                if (activeTabId === tabId && event.isMainFrame) {
                    hideLoading();
                    updateStatus(`Error al cargar: ${event.errorDescription}`);
                    
                    // Si es un error de red, intentar con HTTP en lugar de HTTPS
                    if (event.errorCode === -106 || event.errorCode === -501) {
                        console.log('Intentando cargar con HTTP...');
                        const httpUrl = event.validatedURL.replace('https://', 'http://');
                        setTimeout(() => {
                            webview.src = httpUrl;
                        }, 1000);
                    }
                }
            });
            
            // Detectar cambios de URL para esta pestaña
            webview.addEventListener('did-navigate', (event) => {
                const newUrl = event.url;
                const tab = tabs.find(t => t.id === tabId);
                if (tab) {
                    // Actualizar URL de la pestaña
                    tab.url = newUrl;
                    
                    // Actualizar historial si es necesario (para navegación interna)
                    if (tab.history.length === 0 || tab.history[tab.historyIndex] !== newUrl) {
                        // Solo agregar si no es la misma URL
                        if (tab.history[tab.historyIndex] !== newUrl) {
                            tab.history = tab.history.slice(0, tab.historyIndex + 1);
                            tab.history.push(newUrl);
                            tab.historyIndex = tab.history.length - 1;
                        }
                    }
                    
                    if (activeTabId === tabId) {
                        currentUrl = newUrl;
                        const domain = getDomainFromUrl(newUrl);
                        document.getElementById('addressInput').value = domain;
                        updateNavigationButtons();
                        updateStatus(`Navegando: ${domain}`);
                    }
                }
                console.log(`🔄 Webview ${tabId} URL cambió a:`, newUrl);
            });
            
            webview.addEventListener('did-navigate-in-page', (event) => {
                const newUrl = event.url;
                const tab = tabs.find(t => t.id === tabId);
                if (tab) {
                    // Actualizar URL de la pestaña
                    tab.url = newUrl;
                    
                    // Para navegación interna (como videos de YouTube), también actualizar historial
                    if (tab.history[tab.historyIndex] !== newUrl) {
                        tab.history = tab.history.slice(0, tab.historyIndex + 1);
                        tab.history.push(newUrl);
                        tab.historyIndex = tab.history.length - 1;
                    }
                    
                    if (activeTabId === tabId) {
                        currentUrl = newUrl;
                        const domain = getDomainFromUrl(newUrl);
                        document.getElementById('addressInput').value = domain;
                        updateNavigationButtons();
                    }
                }
                console.log(`📱 Webview ${tabId} navegación interna a:`, newUrl);
            });
            
            // Actualizar título de pestaña cuando cambie
            webview.addEventListener('page-title-updated', (event) => {
                const title = event.title;
                const tab = tabs.find(t => t.id === tabId);
                if (tab) {
                    tab.title = title;
                    renderTabs();
                }
                console.log(`📝 Webview ${tabId} título actualizado:`, title);
            });
        }



        // Función para copiar la URL actual
        function copyCurrentUrl() {
            const copyButton = document.getElementById('copyUrlBtn');
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            
            let urlToCopy = currentUrl;
            
            // Si estamos viendo una página web, obtener la URL del webview activo
            if (!isHomePage && activeTab && activeTab.webview) {
                try {
                    // Intentar obtener la URL del webview activo
                    urlToCopy = activeTab.webview.src || activeTab.url || currentUrl;
                } catch (e) {
                    // Si no se puede obtener, usar la URL de la pestaña
                    urlToCopy = activeTab.url || currentUrl;
                }
            }
            
            if (!urlToCopy || urlToCopy === '' || isHomePage) {
                updateStatus('No hay URL para copiar');
                return;
            }
            
            // Copiar al portapapeles usando la API moderna
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(urlToCopy).then(() => {
                    showCopyFeedback(copyButton, urlToCopy);
                }).catch(() => {
                    // Fallback para navegadores más antiguos
                    fallbackCopyToClipboard(urlToCopy, copyButton);
                });
            } else {
                // Fallback para navegadores más antiguos
                fallbackCopyToClipboard(urlToCopy, copyButton);
            }
        }
        
        // Función para actualizar la visibilidad del botón de copiar
        function updateCopyButtonState() {
            const copyButton = document.getElementById('copyUrlBtn');
            
            if (isHomePage || !currentUrl || currentUrl === '') {
                copyButton.classList.remove('has-url');
                copyButton.title = 'Navega a una página para copiar URL';
            } else {
                copyButton.classList.add('has-url');
                copyButton.title = 'Copiar URL actual';
            }
        }
        
        function fallbackCopyToClipboard(text, button) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopyFeedback(button, text);
            } catch (err) {
                updateStatus('Error al copiar URL');
                console.error('Error copiando al portapapeles:', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        function showCopyFeedback(button, url) {
            // Cambiar el ícono temporalmente
            const originalText = button.innerHTML;
            button.innerHTML = '✓';
            button.classList.add('copied');
            
            // Mostrar mensaje en el status
            const domain = getDomainFromUrl(url);
            updateStatus(`URL copiada: ${domain}`);
            
            // Restaurar el botón después de 2 segundos
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('copied');
            }, 2000);
        }

        // Controles de ventana
        function closeApp() {
            if (confirm('¿Cerrar Neza Browser?')) {
                console.log('🚫 Cerrando aplicación...');
                try {
                    // Limpiar datos antes de cerrar
                    tabs.forEach(tab => {
                        if (tab.webview) {
                            try {
                                tab.webview.executeJavaScript(`
                                    document.querySelectorAll('audio, video').forEach(media => {
                                        media.pause();
                                        media.currentTime = 0;
                                    });
                                `);
                            } catch (e) {}
                        }
                    });
                    
                    // Limpiar timers
                    if (window.musicTimer) clearInterval(window.musicTimer);
                    if (window.statusTimer) clearInterval(window.statusTimer);
                    
                    // Cerrar ventana usando IPC directo
                    const { ipcRenderer } = require('electron');
                    ipcRenderer.invoke('window-close');
                } catch (error) {
                    console.error('Error cerrando:', error);
                    window.close();
                }
            }
        }

        function minimizeApp() {
            console.log('🔽 Intentando minimizar ventana...');
            try {
                if (window.electronAPI && window.electronAPI.minimizeWindow) {
                    window.electronAPI.minimizeWindow().then(() => {
                        console.log('✅ Ventana minimizada');
                    }).catch(error => {
                        console.error('❌ Error minimizando:', error);
                    });
                } else {
                    console.error('❌ electronAPI no disponible');
                }
            } catch (error) {
                console.error('❌ Error en minimizeApp:', error);
            }
        }

        function maximizeApp() {
            console.log('🔳 Maximizando/Restaurando ventana...');
            try {
                if (window.electronAPI && window.electronAPI.maximizeWindow) {
                    window.electronAPI.maximizeWindow().then(() => {
                        console.log('✅ Ventana maximizada/restaurada');
                    }).catch(error => {
                        console.error('❌ Error maximizando:', error);
                    });
                } else {
                    console.error('❌ electronAPI no disponible');
                }
            } catch (error) {
                console.error('❌ Error en maximizeApp:', error);
            }
        }

        // Función de búsqueda de la homepage hermosa
        function performHomepageSearch() {
            const query = document.getElementById('homepageSearchInput').value.trim();
            if (query) {
                // Si parece una URL
                if (query.includes('.') && !query.includes(' ')) {
                    let url = query;
                    if (!url.startsWith('http://') && !url.startsWith('https://')) {
                        url = 'https://' + url;
                    }
                    navigate(url);
                } else {
                    // Buscar en Google
                    navigate('https://www.google.com/search?q=' + encodeURIComponent(query));
                }
            }
        }

        // Crear partículas animadas para la homepage
        function createHomepageParticles() {
            const container = document.querySelector('.background-particles');
            if (!container) return;
            
            // Limpiar partículas existentes
            container.innerHTML = '';
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                container.appendChild(particle);
            }
        }

        // Generar estadísticas animadas para la homepage
        function animateHomepageStats() {
            const adsBlocked = Math.floor(Math.random() * 5000) + 1000;
            const dataSaved = Math.floor(Math.random() * 500) + 50;
            const timeSaved = Math.floor(Math.random() * 60) + 15;
            
            // Animar contadores
            animateCounter('homepageAdsBlocked', adsBlocked);
            animateCounter('homepageDataSaved', dataSaved, ' MB');
            animateCounter('homepageTimeSaved', timeSaved, ' min');
        }

        function animateCounter(elementId, target, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            let current = 0;
            const increment = target / 50;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current).toLocaleString() + suffix;
            }, 50);
        }

        // Acciones rápidas
        function openFavorites() {
            updateStatus('Abriendo Favoritos...');
            alert('⭐ Favoritos\n\n¡Funcionalidad en desarrollo!\n\n• Gestión de marcadores\n• Sincronización en la nube\n• Organización por carpetas\n• Acceso rápido');
        }

        function openBitNote() {
            updateStatus('Iniciando BitNote...');
            navigate('data:text/html,<html><head><title>BitNote</title><style>body{font-family:Arial;padding:20px;background:#1a1a1a;color:white;}textarea{width:100%;height:400px;background:#2a2a2a;color:white;border:1px solid #00D4AA;border-radius:8px;padding:15px;font-size:14px;}</style></head><body><h1>📝 BitNote - Editor de Notas</h1><textarea placeholder="Escribe tus notas aquí..."></textarea><br><br><button style="background:#00D4AA;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;">Guardar</button></body></html>');
        }

        function openApps() {
            updateStatus('Abriendo Apps...');
            const appsHtml = `
            <html>
                <head>
                    <title>Neza Apps</title>
                    <style>
                        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: white; }
                        .app-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
                        .app-card { background: #2a2a2a; padding: 20px; border-radius: 12px; text-align: center; cursor: pointer; transition: transform 0.2s; }
                        .app-card:hover { transform: translateY(-5px); background: #3a3a3a; }
                        .app-icon { font-size: 48px; margin-bottom: 10px; }
                        .quick-links { margin-top: 30px; }
                        .link-button { background: #00D4AA; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
                    </style>
                </head>
                <body>
                    <h1>📱 Neza Apps Ecosystem</h1>
                    <div class="app-grid">
                        <div class="app-card" onclick="window.open('data:text/html,<h1 style=color:white;background:%231a1a1a;padding:20px;>📝 BitNote - Editor funcionando!</h1>')">
                            <div class="app-icon">📝</div><h3>BitNote</h3><p>Editor de notas</p>
                        </div>
                        <div class="app-card" onclick="window.open('https://www.google.com')">
                            <div class="app-icon">🔍</div><h3>Google</h3><p>Búsqueda web</p>
                        </div>
                        <div class="app-card" onclick="window.open('https://www.youtube.com')">
                            <div class="app-icon">�</div><h3>YouTube</h3><p>Videos</p>
                        </div>
                        <div class="app-card" onclick="window.open('https://github.com')">
                            <div class="app-icon">�</div><h3>GitHub</h3><p>Desarrollo</p>
                        </div>
                    </div>
                    
                    <div class="quick-links">
                        <h3>🌐 Enlaces de prueba:</h3>
                        <button class="link-button" onclick="window.location='https://www.google.com'">Google</button>
                        <button class="link-button" onclick="window.location='https://www.youtube.com'">YouTube</button>
                        <button class="link-button" onclick="window.location='https://www.github.com'">GitHub</button>
                        <button class="link-button" onclick="window.location='https://www.wikipedia.org'">Wikipedia</button>
                    </div>
                </body>
            </html>`;
            navigate('data:text/html,' + encodeURIComponent(appsHtml));
        }

        function openWeather() {
            updateStatus('Cargando Weather...');
            const weatherHtml = `
            <html>
                <head>
                    <title>Neza Weather</title>
                    <style>
                        body { font-family: Arial; padding: 20px; background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; text-align: center; }
                        .weather-card { background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; backdrop-filter: blur(10px); margin: 20px auto; max-width: 400px; }
                        .temp { font-size: 64px; font-weight: bold; margin: 20px 0; }
                        .icon { font-size: 80px; margin: 20px 0; }
                    </style>
                </head>
                <body>
                    <h1>🌤️ Neza Weather</h1>
                    <div class="weather-card">
                        <div class="icon">☀️</div>
                        <h2>Ciudad de México</h2>
                        <div class="temp">23°C</div>
                        <p>Parcialmente nublado</p>
                        <p>Humedad: 65% | Viento: 12 km/h</p>
                    </div>
                    <p><em>Funcionalidad completa próximamente con API meteorológica real</em></p>
                </body>
            </html>`;
            navigate('data:text/html,' + encodeURIComponent(weatherHtml));
        }

        function openChat() {
            updateStatus('Activando AI Chat...');
            alert('💬 AI Assistant\n\n¡Asistente inteligente próximamente!\n\n• Chat conversacional\n• Búsqueda inteligente\n• Asistente de navegación\n• Respuestas contextuales');
        }

        function showBookmarks() {
            updateStatus('Mostrando favoritos...');
            openFavorites();
        }

        function showMenu() {
            showBrowserMenu();
        }

        // ============ NEZA SIDEBAR FUNCTIONS ============
        
        function toggleSidebar() {
            const sidebar = document.getElementById('nezaSidebar');
            const body = document.body;
            
            sidebar.classList.toggle('expanded');
            body.classList.toggle('sidebar-expanded');
            
            // Guardar preferencia
            const isExpanded = sidebar.classList.contains('expanded');
            localStorage.setItem('nezaSidebarExpanded', isExpanded);
        }

        function goToHome() {
            // Activar la primera pestaña o crear nueva
            const firstTab = tabs[0];
            if (firstTab) {
                switchToTab(firstTab.id);
                // Si la pestaña tiene URL, mostrar homepage
                if (firstTab.url) {
                    firstTab.url = '';
                    const homepage = document.getElementById('homepage');
                    const webviewContainer = document.getElementById('webviewContainer');
                    homepage.style.display = 'flex';
                    homepage.style.pointerEvents = 'auto';
                    webviewContainer.style.display = 'none';
                    webviewContainer.classList.remove('active');
                    document.getElementById('addressInput').value = '';
                    isHomePage = true;
                }
            }
            updateStatus('Página de inicio');
        }

        function openBookmarks() {
            updateStatus('Abriendo favoritos...');
            // Mostrar panel de favoritos (próximamente)
            alert('⭐ Favoritos\n\nGestión de marcadores en desarrollo');
        }

        function openHistory() {
            updateStatus('Abriendo historial...');
            // Mostrar panel de historial (próximamente)
            alert('🕐 Historial\n\nHistorial de navegación en desarrollo');
        }

        function openDownloads() {
            updateStatus('Abriendo descargas...');
            // Mostrar panel de descargas (próximamente)
            alert('📥 Descargas\n\nGestor de descargas en desarrollo');
        }

        function openApp(appName) {
            const appUrls = {
                'whatsapp': 'https://web.whatsapp.com',
                'instagram': 'https://www.instagram.com',
                'twitter': 'https://twitter.com',
                'discord': 'https://discord.com/app',
                'twitch': 'https://www.twitch.tv',
                'spotify': 'https://open.spotify.com',
                'steam': 'https://store.steampowered.com',
                'epicgames': 'https://www.epicgames.com/store'
            };

            if (appUrls[appName]) {
                navigate(appUrls[appName]);
                updateStatus(`Abriendo ${appName}...`);
            }
        }

        function toggleMessengerPanel() {
            const panel = document.getElementById('messengerPanel');
            panel.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                updateStatus('Panel de mensajería abierto');
            } else {
                updateStatus('Panel de mensajería cerrado');
            }
        }

        // Restaurar estado de la sidebar al cargar
        window.addEventListener('load', () => {
            const sidebarExpanded = localStorage.getItem('nezaSidebarExpanded');
            if (sidebarExpanded === 'true') {
                const sidebar = document.getElementById('nezaSidebar');
                const body = document.body;
                sidebar.classList.add('expanded');
                body.classList.add('sidebar-expanded');
            }
        });

        // ============ SETTINGS PANEL FUNCTIONS ============
        
        function showSettingsPanel() {
            // Cerrar menú contextual del navegador si está abierto
            closeBrowserMenu();
            
            const overlay = document.getElementById('settingsPanelOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                // Delay para asegurar que el display se aplique antes de la animación
                setTimeout(() => {
                    overlay.classList.add('show');
                }, 10);
                updateStatus('Panel de configuraciones abierto');
            }
        }

        function closeSettingsPanel() {
            const overlay = document.getElementById('settingsPanelOverlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 400); // Tiempo de la animación
                updateStatus('Panel de configuraciones cerrado');
            }
        }

        function showSettingsSection(sectionId) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.settings-section');
            sections.forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Desactivar todos los elementos de navegación
            const navItems = document.querySelectorAll('.settings-nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // Mostrar la sección seleccionada
            const targetSection = document.getElementById('section-' + sectionId);
            const targetNav = document.getElementById('nav-' + sectionId);
            
            if (targetSection && targetNav) {
                targetSection.style.display = 'block';
                targetSection.classList.add('active');
                targetNav.classList.add('active');
                
                console.log('📋 Cambiando a sección:', sectionId);
                updateStatus('Configuración: ' + targetNav.querySelector('.settings-nav-text').textContent);
            }
        }

        // ============ SISTEMA DE ACTUALIZACIONES GITHUB ============
        
        const CURRENT_VERSION = '2.1.0';
        const GITHUB_REPO = 'H1C0d3/Neza-GX-Pro';
        const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_REPO}/releases/latest`;
        
        let updateData = null;
        let downloadPath = null;

        // Funciones para la sección "Sobre Neza"
        function checkForUpdates() {
            // Abrir el panel de actualizaciones
            openUpdatePanel();
            
            // Mostrar estado de verificación
            showUpdateState('checking');
            
            // Simular progreso de verificación
            let progress = 0;
            const checkingInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                document.getElementById('checkingProgress').style.width = progress + '%';
            }, 200);
            
            // Consultar GitHub API
            fetch(GITHUB_API_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`GitHub API error: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    clearInterval(checkingInterval);
                    document.getElementById('checkingProgress').style.width = '100%';
                    
                    setTimeout(() => {
                        processUpdateData(data);
                    }, 500);
                })
                .catch(error => {
                    clearInterval(checkingInterval);
                    console.error('Error checking for updates:', error);
                    showUpdateState('error');
                    document.getElementById('errorMessage').textContent = 
                        'No se pudo conectar con GitHub. Verifica tu conexión a internet.';
                    document.getElementById('errorDetails').textContent = error.message;
                });
        }

        function processUpdateData(data) {
            updateData = data;
            const latestVersion = data.tag_name.replace('v', '');
            
            console.log('Current version:', CURRENT_VERSION);
            console.log('Latest version:', latestVersion);
            
            // Comparar versiones
            if (compareVersions(latestVersion, CURRENT_VERSION) > 0) {
                // Hay actualización disponible
                showUpdateAvailable(latestVersion, data);
            } else {
                // Ya está actualizado
                showUpdateState('upToDate');
                document.getElementById('currentVersion').textContent = CURRENT_VERSION;
            }
        }

        function compareVersions(v1, v2) {
            const parts1 = v1.split('.').map(Number);
            const parts2 = v2.split('.').map(Number);
            
            for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
                const part1 = parts1[i] || 0;
                const part2 = parts2[i] || 0;
                
                if (part1 > part2) return 1;
                if (part1 < part2) return -1;
            }
            
            return 0;
        }

        function showUpdateAvailable(newVersion, data) {
            showUpdateState('available');
            
            document.getElementById('currentVersionCompare').textContent = CURRENT_VERSION;
            document.getElementById('newVersion').textContent = newVersion;
            
            // Mostrar changelog
            const changelogList = document.getElementById('changelogList');
            changelogList.innerHTML = '';
            
            if (data.body) {
                // Parsear el body del release (markdown)
                const lines = data.body.split('\n').filter(line => {
                    line = line.trim();
                    return line && !line.startsWith('#') && line.length > 3;
                });
                
                // Tomar las primeras 8 líneas relevantes
                lines.slice(0, 8).forEach(line => {
                    const li = document.createElement('li');
                    li.textContent = line.replace(/^[*\-•]\s*/, '').trim();
                    changelogList.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'Ver notas completas de la versión en GitHub';
                changelogList.appendChild(li);
            }
        }

        function startUpdateDownload() {
            showUpdateState('downloading');
            
            if (!updateData || !updateData.assets || updateData.assets.length === 0) {
                showUpdateState('error');
                document.getElementById('errorMessage').textContent = 
                    'No se encontraron archivos de instalación en el release.';
                return;
            }
            
            // Buscar el instalador adecuado (.exe para Windows)
            const installerAsset = updateData.assets.find(asset => 
                asset.name.endsWith('.exe') || 
                asset.name.includes('Setup') || 
                asset.name.includes('Installer')
            );
            
            if (!installerAsset) {
                showUpdateState('error');
                document.getElementById('errorMessage').textContent = 
                    'No se encontró un instalador compatible (.exe) en el release.';
                return;
            }
            
            const downloadUrl = installerAsset.browser_download_url;
            const fileName = installerAsset.name;
            const fileSize = (installerAsset.size / (1024 * 1024)).toFixed(2);
            
            document.getElementById('downloadInfo').textContent = 
                `Descargando ${fileName} (${fileSize} MB)`;
            
            // Simular progreso de descarga
            let progress = 0;
            const downloadInterval = setInterval(() => {
                progress += Math.random() * 8;
                if (progress > 95) progress = 95;
                
                document.getElementById('downloadProgress').style.width = progress + '%';
                document.getElementById('downloadText').textContent = 
                    Math.floor(progress) + '% completado';
                document.getElementById('downloadSpeed').textContent = 
                    (Math.random() * 3 + 1).toFixed(1) + ' MB/s';
                document.getElementById('downloadSize').textContent = 
                    ((progress / 100) * fileSize).toFixed(2) + ' / ' + fileSize + ' MB';
            }, 300);
            
            // Usar Electron para descargar
            if (typeof window.electronAPI !== 'undefined' && window.electronAPI.downloadUpdate) {
                window.electronAPI.downloadUpdate(downloadUrl, fileName)
                    .then(filePath => {
                        clearInterval(downloadInterval);
                        document.getElementById('downloadProgress').style.width = '100%';
                        document.getElementById('downloadText').textContent = '100% completado';
                        
                        downloadPath = filePath;
                        
                        setTimeout(() => {
                            startInstallation();
                        }, 1000);
                    })
                    .catch(error => {
                        clearInterval(downloadInterval);
                        console.error('Download error:', error);
                        showUpdateState('error');
                        document.getElementById('errorMessage').textContent = 
                            'Error al descargar la actualización.';
                        document.getElementById('errorDetails').textContent = error.message;
                    });
            } else {
                // Fallback: abrir el link de descarga en el navegador
                setTimeout(() => {
                    clearInterval(downloadInterval);
                    document.getElementById('downloadProgress').style.width = '100%';
                    
                    // Abrir link de descarga
                    window.open(downloadUrl, '_blank');
                    
                    showUpdateState('error');
                    document.getElementById('errorMessage').textContent = 
                        'Descarga manual requerida';
                    document.getElementById('errorDetails').innerHTML = 
                        `Se ha abierto el enlace de descarga en tu navegador.<br>` +
                        `Por favor, descarga e instala manualmente el archivo:<br>` +
                        `<strong>${fileName}</strong>`;
                }, 3000);
            }
        }

        function startInstallation() {
            showUpdateState('installing');
            
            if (!downloadPath) {
                showUpdateState('error');
                document.getElementById('errorMessage').textContent = 
                    'No se pudo localizar el archivo de instalación descargado.';
                return;
            }
            
            // Ejecutar el instalador
            if (typeof window.electronAPI !== 'undefined' && window.electronAPI.installUpdate) {
                window.electronAPI.installUpdate(downloadPath)
                    .then(() => {
                        setTimeout(() => {
                            showUpdateState('restart');
                        }, 2000);
                    })
                    .catch(error => {
                        console.error('Installation error:', error);
                        showUpdateState('error');
                        document.getElementById('errorMessage').textContent = 
                            'Error al iniciar la instalación.';
                        document.getElementById('errorDetails').textContent = error.message;
                    });
            } else {
                // Simulación para desarrollo
                setTimeout(() => {
                    showUpdateState('restart');
                }, 3000);
            }
        }

        function restartNow() {
            if (typeof window.electronAPI !== 'undefined' && window.electronAPI.restartApp) {
                window.electronAPI.restartApp();
            } else {
                // Cerrar el panel
                closeUpdatePanel();
                showUpdateNotification('✅ Reinicia Neza Browser manualmente para aplicar cambios', 'success', 8000);
            }
        }

        function restartLater() {
            closeUpdatePanel();
            showUpdateNotification('ℹ️ La actualización se aplicará en el próximo arranque', 'info', 6000);
        }

        function retryUpdate() {
            checkForUpdates();
        }

        // Control del panel de actualizaciones
        function openUpdatePanel() {
            const overlay = document.getElementById('updatePanelOverlay');
            overlay.style.display = 'flex';
            setTimeout(() => {
                overlay.classList.add('show');
            }, 10);
        }

        function closeUpdatePanel() {
            const overlay = document.getElementById('updatePanelOverlay');
            overlay.classList.remove('show');
            setTimeout(() => {
                overlay.style.display = 'none';
                // Reset estados
                document.querySelectorAll('.update-state').forEach(state => {
                    state.style.display = 'none';
                });
            }, 300);
        }

        function showUpdateState(state) {
            // Ocultar todos los estados
            document.querySelectorAll('.update-state').forEach(el => {
                el.style.display = 'none';
            });
            
            // Mostrar el estado solicitado
            const stateMap = {
                'checking': 'updateStateChecking',
                'upToDate': 'updateStateUpToDate',
                'available': 'updateStateAvailable',
                'downloading': 'updateStateDownloading',
                'installing': 'updateStateInstalling',
                'restart': 'updateStateRestart',
                'error': 'updateStateError'
            };
            
            const stateId = stateMap[state];
            if (stateId) {
                document.getElementById(stateId).style.display = 'block';
            }
        }

        // Cerrar panel al hacer clic fuera
        document.addEventListener('click', (e) => {
            const overlay = document.getElementById('updatePanelOverlay');
            if (e.target === overlay) {
                closeUpdatePanel();
            }
        });

        function checkForUpdatesManually() {
            checkForUpdates();
        }

        // Sistema de notificaciones de actualización profesional
        function showUpdateNotification(message, type = 'info', duration = 5000) {
            // Crear o actualizar el contenedor de notificaciones
            let container = document.getElementById('updateNotificationContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'updateNotificationContainer';
                container.style.cssText = `
                    position: fixed;
                    top: 60px;
                    right: 20px;
                    z-index: 10000;
                    pointer-events: none;
                `;
                document.body.appendChild(container);
            }

            // Crear la notificación
            const notification = document.createElement('div');
            notification.className = `update-notification ${type}`;
            notification.style.cssText = `
                background: ${type === 'success' ? 'linear-gradient(135deg, #00D4AA 0%, #00A8FF 100%)' :
                             type === 'error' ? 'linear-gradient(135deg, #FF5F56 0%, #FF9500 100%)' :
                             'linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%)'};
                color: white;
                padding: 15px 20px;
                border-radius: 12px;
                margin-bottom: 10px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                font-weight: 500;
                font-size: 14px;
                min-width: 300px;
                max-width: 400px;
                pointer-events: auto;
                cursor: pointer;
                animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out ${duration - 300}ms forwards;
                transform: translateX(100%);
                opacity: 0;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 16px;">
                        ${type === 'success' ? '✅' : type === 'error' ? '❌' : '🔄'}
                    </div>
                    <div style="flex: 1;">${message}</div>
                    <div style="font-size: 12px; opacity: 0.7; cursor: pointer;" onclick="this.parentElement.parentElement.remove()">×</div>
                </div>
            `;

            // Agregar estilos de animación si no existen
            if (!document.getElementById('updateNotificationStyles')) {
                const style = document.createElement('style');
                style.id = 'updateNotificationStyles';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; transform: translateX(0); }
                        to { opacity: 0; transform: translateX(100%); }
                    }
                `;
                document.head.appendChild(style);
            }

            container.appendChild(notification);

            // Auto-remover después del duration
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, duration);

            // Remover al hacer clic
            notification.addEventListener('click', () => {
                notification.remove();
            });
        }

        function showChangelog() {
            updateStatus('📋 Mostrando registro de cambios...');
            
            // Verificar si estamos en Electron
            if (typeof window.electronAPI !== 'undefined') {
                // Obtener changelog desde GitHub releases
                window.electronAPI.getChangelog()
                    .then(changelog => {
                        if (changelog && changelog.length > 0) {
                            let changelogText = '📋 Historial de Versiones de Neza Browser\n\n';
                            changelog.forEach((release, index) => {
                                if (index < 5) { // Mostrar solo las últimas 5 versiones
                                    changelogText += `🆕 ${release.name || release.tag_name}\n`;
                                    changelogText += `📅 ${new Date(release.published_at).toLocaleDateString()}\n\n`;
                                    
                                    if (release.body) {
                                        // Limpiar el texto del changelog
                                        const cleanBody = release.body
                                            .replace(/#{1,6}\s/g, '• ')
                                            .replace(/\*\s/g, '• ')
                                            .replace(/\r\n/g, '\n')
                                            .substring(0, 300);
                                        changelogText += cleanBody + (release.body.length > 300 ? '...' : '') + '\n\n';
                                    } else {
                                        changelogText += '• Mejoras de rendimiento y corrección de errores\n\n';
                                    }
                                    changelogText += '─'.repeat(50) + '\n\n';
                                }
                            });
                            
                            alert(changelogText);
                        } else {
                            // Fallback si no hay releases
                            showDefaultChangelog();
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching changelog:', error);
                        showDefaultChangelog();
                    });
            } else {
                // Fallback para desarrollo
                showDefaultChangelog();
            }
        }

        function showDefaultChangelog() {
            const changelog = `
📋 Neza Browser v1.0.0 Beta - Octubre 2024

✨ Nuevas características:
• Panel de configuraciones avanzadas
• Control de música integrado  
• Detección inteligente de medios
• Sistema de pestañas mejorado
• Interfaz moderna con animaciones
• Neza Support Center integrado
• Sistema de feedback y soporte
• Auto-actualizador automático
• Neza Stealth Mode mejorado

🔧 Mejoras:
• Mejor rendimiento de webviews
• Control de audio sin pausar videos
• Navegación más rápida y fluida
• Búsqueda inteligente en barra de direcciones
• Diseño responsive optimizado
• Sistema de ventanas independientes

🛠️ Correcciones:
• Problemas de visualización de pestañas
• Sincronización de audio
• Carga de páginas web
• Estabilidad general del sistema
• Errores de JavaScript en interacciones

💡 Próximamente:
• Neza Store (extensiones)
• Temas personalizados  
• Sincronización en la nube
• Modo desarrollador avanzado
• Integración con servicios web
            `;
            alert(changelog);
        }

        function contactSupport() {
            // Abrir el panel de Neza Support en lugar del alert
            showNezaSupportPanel();
        }

        // Funciones de configuración (para futuras implementaciones)
        function saveSettings() {
            console.log('💾 Guardando configuraciones...');
            updateStatus('⚙️ Configuraciones guardadas');
        }

        function resetSettings() {
            if (confirm('¿Estás seguro de que quieres restablecer todas las configuraciones a los valores predeterminados?')) {
                console.log('🔄 Restableciendo configuraciones...');
                updateStatus('🔄 Configuraciones restablecidas');
                
                // Aquí iría la lógica para restablecer configuraciones
                setTimeout(() => {
                    alert('✅ Configuraciones restablecidas correctamente');
                }, 1000);
            }
        }

        // ============ Neza SUPPORT PANEL FUNCTIONS ============
        
        function showNezaSupportPanel() {
            // Cerrar menú contextual del navegador si está abierto
            closeBrowserMenu();
            
            const overlay = document.getElementById('supportPanelOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                // Delay para asegurar que el display se aplique antes de la animación
                setTimeout(() => {
                    overlay.classList.add('show');
                }, 10);
                updateStatus('Panel de Neza Support abierto');
            }
        }

        function closeSupportPanel() {
            const overlay = document.getElementById('supportPanelOverlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 300); // Tiempo de la animación
                updateStatus('Panel de Neza Support cerrado');
            }
        }

        function showFeedbackCenter() {
            // Cerrar panel de soporte primero
            closeSupportPanel();
            
            // Mostrar panel de feedback después de un breve delay
            setTimeout(() => {
                const overlay = document.getElementById('feedbackPanelOverlay');
                if (overlay) {
                    overlay.style.display = 'flex';
                    setTimeout(() => {
                        overlay.classList.add('show');
                    }, 10);
                    updateStatus('Centro de Feedback abierto');
                }
            }, 350);
        }

        function closeFeedbackPanel() {
            const overlay = document.getElementById('feedbackPanelOverlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 300); // Tiempo de la animación
                updateStatus('Centro de Feedback cerrado');
            }
        }

        function submitFeedback() {
            const form = {
                type: document.getElementById('feedbackType').value,
                description: document.getElementById('feedbackDescription').value.trim(),
                email: document.getElementById('feedbackEmail').value.trim()
            };

            // Validar campos requeridos
            if (!form.type || !form.description) {
                alert('⚠️ Por favor, completa todos los campos requeridos:\n- Tipo de feedback\n- Descripción');
                return;
            }

            // Validar email si se proporciona
            if (form.email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(form.email)) {
                    alert('⚠️ Por favor, ingresa un email válido o deja el campo vacío.');
                    return;
                }
            }

            // Deshabilitar botón de envío
            const submitBtn = document.querySelector('.btn-submit');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            // Simular envío de feedback
            updateStatus('📧 Enviando feedback...');
            
            setTimeout(() => {
                // Aquí iría la integración real con el sistema de email
                console.log('📧 Feedback enviado:', form);
                
                // Mostrar confirmación
                alert(`✅ ¡Feedback enviado exitosamente!

Tipo: ${form.type}
Descripción: ${form.description.substring(0, 100)}${form.description.length > 100 ? '...' : ''}
${form.email ? `Email de contacto: ${form.email}` : ''}

Gracias por ayudarnos a mejorar Neza Browser. 
Revisaremos tu feedback y te contactaremos si es necesario.`);

                // Limpiar formulario
                document.getElementById('feedbackType').value = '';
                document.getElementById('feedbackDescription').value = '';
                document.getElementById('feedbackEmail').value = '';

                // Cerrar panel
                closeFeedbackPanel();

                // Restaurar botón
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                
                updateStatus('Feedback enviado correctamente');
            }, 2000);
        }

        function openDocumentation() {
            updateStatus('📚 Abriendo documentación...');
            // Aquí se abriría la documentación en una nueva pestaña
            setTimeout(() => {
                alert('📚 Documentación de Neza Browser\n\n🔗 https://docs.hicode.tech/Neza\n\nEn esta documentación encontrarás:\n• Guías de uso\n• Características avanzadas\n• Solución de problemas\n• API para desarrolladores');
            }, 500);
        }

        function openCommunity() {
            updateStatus('👥 Abriendo comunidad...');
            setTimeout(() => {
                alert('👥 Comunidad de Neza Browser\n\n💬 Discord: Hi Code Community\n🐦 Twitter: @HiCodeTech\n📘 Facebook: Hi Code\n🔗 GitHub: github.com/hicode\n\n¡Únete a nuestra comunidad!');
            }, 500);
        }

        function contactTechnicalSupport() {
            updateStatus('🛠️ Contactando soporte técnico...');
            setTimeout(() => {
                alert('🛠️ Soporte Técnico Especializado\n\n📧 Email: support@hicode.tech\n🕒 Horarios: Lun-Vie 9:00-18:00 (GMT-5)\n⚡ Respuesta promedio: 2-4 horas\n\n🔧 Para problemas técnicos avanzados\n🐛 Reportar bugs críticos\n⚙️ Configuraciones empresariales');
            }, 500);
        }

        // ============ ZOOM CONTROL FUNCTIONS ============
        
        let currentZoomLevel = 100; // Porcentaje de zoom actual
        
        function updateZoomDisplay() {
            const zoomInput = document.getElementById('zoomLevelInput');
            if (zoomInput) {
                zoomInput.value = currentZoomLevel + '%';
            }
            
            // Actualizar el zoom en la webview activa
            const activeTab = tabs.find(tab => tab.isActive);
            if (activeTab && activeTab.webview) {
                const zoomFactor = currentZoomLevel / 100;
                try {
                    activeTab.webview.setZoomFactor(zoomFactor);
                    console.log(`🔍 Zoom actualizado a ${currentZoomLevel}% (factor: ${zoomFactor})`);
                } catch (error) {
                    console.error('Error aplicando zoom:', error);
                }
            } else {
                // Si no hay webview activa, aplicar zoom al contenido principal
                const homepage = document.getElementById('homepage');
                const contentArea = document.querySelector('.content-area');
                if (homepage && homepage.style.display !== 'none') {
                    const zoomFactor = currentZoomLevel / 100;
                    homepage.style.transform = `scale(${zoomFactor})`;
                    homepage.style.transformOrigin = 'top center';
                    console.log(`🔍 Zoom aplicado a homepage: ${currentZoomLevel}%`);
                }
            }
            
            updateStatus(`🔍 Zoom: ${currentZoomLevel}%`);
        }
        
        function zoomIn() {
            if (currentZoomLevel < 500) { // Máximo 500%
                currentZoomLevel = Math.min(500, currentZoomLevel + 25);
                updateZoomDisplay();
            }
        }
        
        function zoomOut() {
            if (currentZoomLevel > 25) { // Mínimo 25%
                currentZoomLevel = Math.max(25, currentZoomLevel - 25);
                updateZoomDisplay();
            }
        }
        
        function resetZoom() {
            currentZoomLevel = 100;
            
            // Restaurar transform de homepage si está visible
            const homepage = document.getElementById('homepage');
            if (homepage) {
                homepage.style.transform = 'scale(1)';
                homepage.style.transformOrigin = 'top center';
            }
            
            updateZoomDisplay();
        }
        
        function handleZoomInput(event) {
            if (event.key === 'Enter') {
                applyCustomZoom();
            } else if (event.key === 'Escape') {
                // Restaurar valor anterior
                const zoomInput = document.getElementById('zoomLevelInput');
                if (zoomInput) {
                    zoomInput.value = currentZoomLevel + '%';
                    zoomInput.blur();
                }
            }
        }
        
        function applyCustomZoom() {
            const zoomInput = document.getElementById('zoomLevelInput');
            if (!zoomInput) return;
            
            let inputValue = zoomInput.value.replace('%', '').trim();
            let newZoomLevel = parseInt(inputValue);
            
            // Validar el valor
            if (isNaN(newZoomLevel) || newZoomLevel < 25) {
                newZoomLevel = 25;
            } else if (newZoomLevel > 500) {
                newZoomLevel = 500;
            }
            
            currentZoomLevel = newZoomLevel;
            updateZoomDisplay();
        }
        
        function toggleFullscreen() {
            const fullscreenIcon = document.getElementById('fullscreenIcon');
            
            if (!document.fullscreenElement) {
                // Entrar en pantalla completa
                document.documentElement.requestFullscreen().then(() => {
                    if (fullscreenIcon) {
                        fullscreenIcon.textContent = '⌷'; // Icono para salir de pantalla completa
                    }
                    updateStatus('🖥️ Pantalla completa activada');
                }).catch(err => {
                    console.error('Error entrando en pantalla completa:', err);
                    updateStatus('❌ Error al activar pantalla completa');
                });
            } else {
                // Salir de pantalla completa
                document.exitFullscreen().then(() => {
                    if (fullscreenIcon) {
                        fullscreenIcon.textContent = '⛶'; // Icono para entrar en pantalla completa
                    }
                    updateStatus('🖥️ Pantalla completa desactivada');
                }).catch(err => {
                    console.error('Error saliendo de pantalla completa:', err);
                });
            }
        }
        
        // Función para aplicar zoom a una webview específica
        function applyZoomToWebview(webview, zoomLevel = currentZoomLevel) {
            if (webview) {
                const zoomFactor = zoomLevel / 100;
                try {
                    webview.setZoomFactor(zoomFactor);
                } catch (error) {
                    console.error('Error aplicando zoom a webview:', error);
                }
            }
        }
        
        // Event listener para Ctrl + rueda del ratón
        function setupZoomWheelControl() {
            document.addEventListener('wheel', function(event) {
                // Solo actuar si Ctrl está presionado
                if (event.ctrlKey) {
                    event.preventDefault(); // Prevenir el zoom del navegador por defecto
                    
                    if (event.deltaY < 0) {
                        // Rueda hacia arriba = zoom in
                        zoomIn();
                        updateStatus('🔍 Zoom aumentado con Ctrl + rueda');
                    } else {
                        // Rueda hacia abajo = zoom out
                        zoomOut();
                        updateStatus('🔍 Zoom reducido con Ctrl + rueda');
                    }
                }
            }, { passive: false });
            
            // Prevenir el zoom por defecto del navegador con Ctrl + / Ctrl -
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey) {
                    if (event.key === '+' || event.key === '=') {
                        event.preventDefault();
                        zoomIn();
                        updateStatus('🔍 Zoom aumentado con Ctrl + +');
                    } else if (event.key === '-') {
                        event.preventDefault();
                        zoomOut();
                        updateStatus('🔍 Zoom reducido con Ctrl + -');
                    } else if (event.key === '0') {
                        event.preventDefault();
                        resetZoom();
                        updateStatus('🔍 Zoom restablecido con Ctrl + 0');
                    }
                }
                
                // F11 para pantalla completa
                if (event.key === 'F11') {
                    event.preventDefault();
                    toggleFullscreen();
                }
            });
        }
        
        // Event listener para cambios de pantalla completa
        function setupFullscreenListeners() {
            document.addEventListener('fullscreenchange', function() {
                const fullscreenIcon = document.getElementById('fullscreenIcon');
                if (fullscreenIcon) {
                    if (document.fullscreenElement) {
                        fullscreenIcon.textContent = '⌷';
                    } else {
                        fullscreenIcon.textContent = '⛶';
                    }
                }
            });
        }

        // ============ BROWSER MENU CONTEXTUAL FUNCTIONS ============
        
        function showBrowserMenu() {
            // Cerrar dropdown de Neza si está abierto
            closeAllDropdowns();
            
            const overlay = document.getElementById('browserMenuOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                setTimeout(() => {
                    overlay.classList.add('show');
                }, 10);
                updateStatus('Menú del navegador abierto');
            }
        }

        function closeBrowserMenu() {
            const overlay = document.getElementById('browserMenuOverlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 300);
                updateStatus('Menú del navegador cerrado');
            }
        }

        function createNewTab() {
            // Cerrar cualquier menú abierto
            closeBrowserMenu();
            closeAllDropdowns();
            
            newTab();
            updateStatus('Nueva pestaña creada desde menú');
        }

        function createNewWindow() {
            // Cerrar cualquier menú abierto
            closeBrowserMenu();
            closeAllDropdowns();
            
            updateStatus('🗔 Abriendo nueva ventana...');
            
            // Intentar diferentes métodos para crear ventana
            
            // Método 1: API moderna de Electron (contextBridge)
            if (window.electronAPI && window.electronAPI.createNewWindow) {
                try {
                    window.electronAPI.createNewWindow();
                    updateStatus('✅ Nueva ventana abierta (API moderna)');
                    return;
                } catch (error) {
                    console.log('❌ Error con API moderna:', error);
                }
            }
            
            // Método 2: Electron clásico con require
            if (typeof require !== 'undefined') {
                try {
                    const { ipcRenderer } = require('electron');
                    ipcRenderer.send('create-new-window');
                    updateStatus('✅ Nueva ventana solicitada (IPC)');
                    return;
                } catch (error) {
                    console.log('❌ Error con IPC:', error);
                }
            }
            
            // Método 3: Remote API (Electron antiguo)
            if (window.require) {
                try {
                    const { remote } = window.require('electron');
                    const BrowserWindow = remote.BrowserWindow;
                    
                    // Crear nueva ventana de Neza Browser
                    const newWindow = new BrowserWindow({
                        width: 1280,
                        height: 800,
                        minWidth: 800,
                        minHeight: 600,
                        frame: false,
                        titleBarStyle: 'hidden',
                        backgroundColor: '#1a1a1a',
                        webPreferences: {
                            nodeIntegration: true,
                            contextIsolation: false,
                            webSecurity: false
                        },
                        show: false
                    });
                    
                    // Cargar la misma aplicación en la nueva ventana
                    const currentURL = window.location.href;
                    newWindow.loadURL(currentURL);
                    
                    // Mostrar cuando esté listo
                    newWindow.once('ready-to-show', () => {
                        newWindow.show();
                        newWindow.focus();
                        updateStatus('✅ Nueva ventana abierta (Remote API)');
                    });
                    
                    return;
                    
                } catch (error) {
                    console.error('Error con Remote API:', error);
                }
            }
            
            // Método 4: Fallback para desarrollo web
            updateStatus('🌐 Intentando abrir en navegador...');
            const newWindow = window.open(window.location.href, '_blank', 
                'width=1280,height=800,scrollbars=yes,resizable=yes,toolbar=no,location=no,directories=no,status=no,menubar=no');
            
            if (newWindow) {
                updateStatus('✅ Nueva ventana abierta en navegador');
                
                // Dar enfoque a la nueva ventana
                setTimeout(() => {
                    newWindow.focus();
                }, 100);
            } else {
                // Último recurso: nueva pestaña
                updateStatus('⚠️ Creando nueva pestaña como alternativa...');
                newTab();
                setTimeout(() => {
                    alert('⚠️ Nueva Ventana\n\n❌ No fue posible crear ventana separada\n✅ Se creó nueva pestaña como alternativa\n\n💡 Para ventanas reales, ejecuta como aplicación Electron');
                }, 500);
            }
        }

        // ============ Neza STEALTH MODE FUNCTIONS ============
        
        let stealthPreferences = {
            defaultLayer: 3, // Ghost Mode por defecto
            isFirstTime: true
        };

        function openStealthMode() {
            closeBrowserMenu();
            
            if (stealthPreferences.isFirstTime) {
                showStealthModePanel();
            } else {
                // Si ya se configuró antes, usar la preferencia guardada
                startStealthSession(stealthPreferences.defaultLayer);
            }
        }

        function showStealthModePanel() {
            const overlay = document.getElementById('stealthModeOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                setTimeout(() => {
                    overlay.classList.add('show');
                }, 10);
                updateStatus('🕶️ Seleccionador de Stealth Mode abierto');
                
                // Preseleccionar la capa guardada
                selectStealthLayer(stealthPreferences.defaultLayer);
            }
        }

        function closeStealthMode() {
            const overlay = document.getElementById('stealthModeOverlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 400);
                updateStatus('🕶️ Stealth Mode cerrado');
            }
        }

        function selectStealthLayer(layer) {
            // Remover selección anterior
            document.querySelectorAll('.stealth-layer').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Seleccionar nueva capa
            const selectedLayer = document.getElementById('layer' + layer);
            if (selectedLayer) {
                selectedLayer.classList.add('selected');
                
                // Actualizar botón
                const startBtn = document.getElementById('startStealthBtn');
                const layerNames = {
                    1: 'Layer 1 - Basic',
                    2: 'Layer 2 - Shield', 
                    3: 'Ghost Mode'
                };
                
                if (startBtn) {
                    startBtn.innerHTML = `<span>🚀</span>Iniciar ${layerNames[layer]}`;
                }
                
                // Guardar preferencia temporalmente
                stealthPreferences.defaultLayer = layer;
                
                console.log('👻 Capa seleccionada:', layer);
            }
        }

        function startStealthSession() {
            const selectedLayer = stealthPreferences.defaultLayer;
            closeStealthMode();
            
            // Marcar que ya no es la primera vez
            stealthPreferences.isFirstTime = false;
            
            updateStatus(`🕶️ Iniciando ${getLayerName(selectedLayer)}...`);
            
            // Abrir Stealth Mode en nueva ventana
            openStealthWindow(selectedLayer);
        }
        
        function openNewPrivateWindow(layer) {
            updateStatus(`🕶️ Abriendo nueva ventana privada ${getLayerName(layer)}...`);
            
            // Método 1: IPC directo para Electron
            if (typeof require !== 'undefined') {
                try {
                    const { ipcRenderer } = require('electron');
                    ipcRenderer.invoke('create-private-window', {
                        layer: layer,
                        partition: `private-${layer}-${Date.now()}`,
                        clearCache: true,
                        clearStorage: true,
                        width: 1200,
                        height: 800
                    }).then(result => {
                        if (result.success) {
                            updateStatus(`✅ Ventana privada ${getLayerName(layer)} abierta`);
                        } else {
                            throw new Error('No se pudo crear la ventana privada');
                        }
                    }).catch(error => {
                        console.error('Error creando ventana privada IPC:', error);
                        // Fallback al método window.open
                        fallbackPrivateWindow(layer);
                    });
                    return;
                } catch (error) {
                    console.error('Error con IPC:', error);
                }
            }
            
            // Método 2: Fallback con window.open (menos seguro pero funcional)
            const privateUrl = window.location.href + `?private=${layer}&session=${Date.now()}`;
            const privateWindow = window.open(
                privateUrl,
                `private-${layer}-${Date.now()}`,
                'width=1200,height=800,scrollbars=yes,resizable=yes,toolbar=no,location=no,directories=no,status=no,menubar=no,privacy=true'
            );
            
            if (privateWindow) {
                // Inyectar configuraciones de privacidad
                setTimeout(() => {
                    try {
                        privateWindow.postMessage({
                            type: 'ACTIVATE_PRIVACY',
                            layer: layer,
                            features: getPrivacyFeatures(layer)
                        }, '*');
                    } catch (e) {
                        console.log('Configuración de privacidad aplicada localmente');
                    }
                }, 1000);
                
                updateStatus(`✅ Nueva ventana privada ${getLayerName(layer)} abierta`);
            } else {
                updateStatus(`❌ No se pudo abrir ventana privada. Verifica permisos de popup.`);
                alert('🚫 Ventana Privada Bloqueada\n\nPor favor permite popups para esta aplicación y vuelve a intentarlo.\n\nEsto es necesario para garantizar tu seguridad y privacidad.');
            }
        }
        
        function fallbackPrivateWindow(layer) {
            console.log('🔄 Usando fallback para ventana privada...');
            updateStatus(`🌐 Abriendo ventana privada ${getLayerName(layer)} (fallback)...`);
            
            // Método alternativo con window.open
            const privateUrl = window.location.href + `?private=${layer}&session=${Date.now()}`;
            const privateWindow = window.open(
                privateUrl,
                `private-${layer}-${Date.now()}`,
                'width=1200,height=800,scrollbars=yes,resizable=yes,toolbar=no,location=no,directories=no,status=no,menubar=no'
            );
            
            if (privateWindow) {
                updateStatus(`✅ Ventana privada ${getLayerName(layer)} abierta (fallback)`);
            } else {
                updateStatus(`❌ No se pudo abrir ventana privada. Verifica permisos de popup.`);
            }
        }
        
        function openStealthWindow(layer) {
            updateStatus(`🕶️ Iniciando modo privado ${getLayerName(layer)}...`);
            
            // Cerrar panel de selección
            closeStealthMode();
            
            // Abrir nueva ventana privada
            openNewPrivateWindow(layer);
        }

        function getLayerName(layer) {
            const names = {
                1: 'Layer 1 - Basic',
                2: 'Layer 2 - Shield',
                3: 'Ghost Mode'
            };
            return names[layer] || 'Stealth Mode';
        }
        
        function getPrivacyFeatures(layer) {
            const features = {
                1: { // Basic Privacy
                    clearHistory: true,
                    clearCookies: true,
                    clearCache: false,
                    blockTrackers: false,
                    blockAds: false,
                    blockFingerprinting: false,
                    secureDNS: false,
                    vpnMode: false
                },
                2: { // Advanced Shield
                    clearHistory: true,
                    clearCookies: true,
                    clearCache: true,
                    blockTrackers: true,
                    blockAds: true,
                    blockFingerprinting: true,
                    secureDNS: true,
                    vpnMode: false
                },
                3: { // Ghost Mode
                    clearHistory: true,
                    clearCookies: true,
                    clearCache: true,
                    blockTrackers: true,
                    blockAds: true,
                    blockFingerprinting: true,
                    secureDNS: true,
                    vpnMode: true,
                    sandboxMode: true,
                    clearOnClose: true
                }
            };
            
            return features[layer] || features[1];
        }
        
        function applyPrivacyFeatures(layer, webview) {
            const features = getPrivacyFeatures(layer);
            
            if (!webview) return;
            
            // Aplicar características según el layer
            webview.addEventListener('dom-ready', () => {
                console.log(`Aplicando características de privacidad Layer ${layer}...`);
                
                if (features.blockTrackers) {
                    webview.executeJavaScript(`
                        // Bloquear trackers comunes
                        const trackers = ['google-analytics', 'facebook', 'doubleclick', 'googletagmanager'];
                        trackers.forEach(tracker => {
                            const elements = document.querySelectorAll('[src*="' + tracker + '"]');
                            elements.forEach(el => el.remove());
                        });
                        console.log('🛡️ Trackers bloqueados');
                    `);
                }
                
                if (features.blockAds) {
                    webview.executeJavaScript(`
                        // Bloquear elementos de publicidad
                        const adSelectors = ['.ad', '.ads', '.advertisement', '[id*="ad"]', '[class*="ad"]'];
                        adSelectors.forEach(selector => {
                            const elements = document.querySelectorAll(selector);
                            elements.forEach(el => el.style.display = 'none');
                        });
                        console.log('🚫 Publicidad bloqueada');
                    `);
                }
                
                if (features.blockFingerprinting) {
                    webview.executeJavaScript(`
                        // Protección contra fingerprinting
                        Object.defineProperty(navigator, 'userAgent', {
                            value: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                        });
                        
                        Object.defineProperty(navigator, 'language', {
                            value: 'en-US'
                        });
                        
                        Object.defineProperty(screen, 'width', {
                            value: 1920
                        });
                        
                        Object.defineProperty(screen, 'height', {
                            value: 1080
                        });
                        
                        console.log('👤 Fingerprinting bloqueado');
                    `);
                }
                
                // Configurar partición privada
                if (features.clearCache) {
                    webview.setAttribute('partition', `private-${layer}-${Date.now()}`);
                }
                
                updateStatus(`🔒 Características de privacidad Layer ${layer} aplicadas`);
            });
        }

        // =============== MODO PRIVADO MEJORADO ===============
        function activatePrivateMode(layer) {
            console.log(`🕶️ Activando modo privado con ${getLayerName(layer)}...`);
            
            // Configurar estado global
            isPrivateMode = true;
            currentPrivacyLayer = layer;
            privateSessionId = 'priv_' + Date.now();
            
            // ABRIR NUEVA VENTANA PRIVADA - ESTO ES CRÍTICO PARA SEGURIDAD
            openNewPrivateWindow(layer);
            
            // Cambiar tema visual a modo privado
            applyPrivateTheme();
            
            // Convertir todas las pestañas existentes a privadas
            tabs.forEach(tab => {
                tab.isPrivate = true;
                tab.privacyLayer = layer;
                tab.stealthFeatures = getStealthFeatures(layer);
            });
            
            // Actualizar indicadores visuales
            updatePrivacyIndicators(layer);
            
            // Configurar características de privacidad
            configurePrivacyFeatures(layer);
            
            // Notificar al usuario
            updateStatus(`👻 Modo privado ${getLayerName(layer)} activado. Todas las pestañas son ahora privadas.`);
            
            // Mostrar indicador persistente
            showPrivacyModeIndicator(layer);
            
            console.log(`✅ Modo privado ${getLayerName(layer)} configurado exitosamente`);
        }

        function applyPrivateTheme() {
            console.log('🎨 Aplicando tema privado...');
            
            const root = document.documentElement;
            
            // Cambiar colores a tema oscuro para modo privado
            root.style.setProperty('--Neza-bg-primary', '#0a0a0a');
            root.style.setProperty('--Neza-bg-secondary', '#1a1a1a');
            root.style.setProperty('--Neza-bg-tertiary', '#2a2a2a');
            root.style.setProperty('--Neza-text-primary', '#ffffff');
            root.style.setProperty('--Neza-accent-primary', '#8A2BE2'); // Púrpura para modo privado
            
            // Agregar clase al body para estilos específicos
            document.body.classList.add('private-mode');
            document.body.classList.remove('normal-mode');
            
            // Cambiar título de la ventana
            document.title = '🕶️ Neza Browser - Modo Privado';
        }

        function updatePrivacyIndicators(layer) {
            // Actualizar pestañas con indicador privado
            renderTabs();
            
            // Agregar indicador en la barra de título
            const titleBar = document.querySelector('.title-bar');
            let privacyBadge = titleBar.querySelector('.privacy-badge');
            
            if (!privacyBadge) {
                privacyBadge = document.createElement('div');
                privacyBadge.className = 'privacy-badge';
                titleBar.appendChild(privacyBadge);
            }
            
            privacyBadge.innerHTML = `🕶️ ${getLayerName(layer)}`;
            privacyBadge.title = `Modo privado activo - ${getLayerName(layer)}`;
        }

        function configurePrivacyFeatures(layer) {
            console.log(`🔒 Configurando características de privacidad para ${getLayerName(layer)}...`);
            
            // Configurar según el nivel de privacidad
            switch(layer) {
                case 1: // Basic
                    // Bloquear cookies de terceros, historial básico
                    break;
                case 2: // Shield  
                    // + Bloquear scripts de seguimiento, ads
                    break;
                case 3: // Ghost Mode
                    // + Tor-like features, máxima privacidad
                    break;
            }
        }

        function showPrivacyModeIndicator(layer) {
            // Crear indicador persistente en la esquina
            let indicator = document.getElementById('privacyIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'privacyIndicator';
                indicator.className = 'privacy-indicator';
                indicator.innerHTML = `
                    <div class="privacy-icon">🕶️</div>
                    <div class="privacy-text">${getLayerName(layer)}</div>
                    <div class="privacy-close" onclick="deactivatePrivateMode()">×</div>
                `;
                document.body.appendChild(indicator);
            }
            
            indicator.style.display = 'block';
        }

        function deactivatePrivateMode() {
            if (confirm('¿Salir del modo privado? Se cerrarán todas las pestañas privadas.')) {
                console.log('🔄 Desactivando modo privado...');
                
                // Resetear estado global
                isPrivateMode = false;
                currentPrivacyLayer = 0;
                privateSessionId = null;
                
                // Aplicar tema normal
                applyNormalTheme();
                
                // Cerrar todas las pestañas privadas y crear una nueva normal
                tabs = [];
                tabCounter = 0;
                newTab(); // Crear nueva pestaña normal
                
                // Ocultar indicadores
                const indicator = document.getElementById('privacyIndicator');
                if (indicator) indicator.style.display = 'none';
                
                const badge = document.querySelector('.privacy-badge');
                if (badge) badge.remove();
                
                updateStatus('🔄 Modo normal restaurado');
                document.title = 'Neza Browser';
            }
        }

        function applyNormalTheme() {
            console.log('🎨 Aplicando tema normal...');
            
            const root = document.documentElement;
            
            // Cambiar a colores claros y elegantes para modo normal
            root.style.setProperty('--Neza-bg-primary', '#f8f9fa');
            root.style.setProperty('--Neza-bg-secondary', '#ffffff');
            root.style.setProperty('--Neza-bg-tertiary', '#e9ecef');
            root.style.setProperty('--Neza-text-primary', '#212529');
            root.style.setProperty('--Neza-accent-primary', '#0066cc'); // Azul elegante
            
            // Cambiar clases del body
            document.body.classList.add('normal-mode');
            document.body.classList.remove('private-mode');
        }

        function hideStealthModePanel() {
            const overlay = document.getElementById('stealthModeOverlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 300);
            }
        }

        function createStealthTab(layer) {
            console.log('👻 Creando pestaña Stealth con capa:', layer);
            
            tabCounter++;
            const stealthTab = {
                id: tabCounter,
                title: `👻 ${getLayerName(layer)}`,
                url: '',
                isActive: true,
                webview: null,
                history: [],
                historyIndex: -1,
                hasAudio: false,
                isMuted: false,
                isStealthMode: true,
                stealthLayer: layer,
                stealthFeatures: getStealthFeatures(layer)
            };
            
            // Desactivar todas las pestañas existentes
            tabs.forEach(tab => {
                tab.isActive = false;
                if (tab.webview) {
                    tab.webview.style.display = 'none';
                }
            });
            
            tabs.push(stealthTab);
            activeTabId = stealthTab.id;
            
            // Renderizar pestañas
            renderTabs();
            
            // Mostrar homepage con modo stealth
            showStealthHomepage(layer);
            
            updateStatus(`👻 ${getLayerName(layer)} activado - Navegación privada iniciada`);
            
            // Mostrar notificación de stealth
            showStealthNotification(layer);
        }

        function getStealthFeatures(layer) {
            const features = {
                1: ['noHistory', 'noCookies', 'noCache'],
                2: ['noHistory', 'noCookies', 'noCache', 'blockTrackers', 'blockFingerprinting', 'secureDNS', 'httpsRedirect'],
                3: ['noHistory', 'noCookies', 'noCache', 'blockTrackers', 'blockFingerprinting', 'secureDNS', 'httpsRedirect', 'sandboxMode', 'privateVault', 'paranoidMode', 'screenCaptureBlock']
            };
            return features[layer] || features[1];
        }

        function showStealthHomepage(layer) {
            isHomePage = true;
            document.getElementById('homepage').style.display = 'flex';
            document.getElementById('webviewContainer').classList.remove('active');
            document.getElementById('addressInput').value = '';
            
            // Modificar la página de inicio para mostrar información del stealth mode
            const homepage = document.getElementById('homepage');
            const welcomeTitle = homepage.querySelector('.welcome-title');
            if (welcomeTitle) {
                welcomeTitle.innerHTML = `
                    <div style="color: #8A2BE2; font-size: 48px; margin-bottom: 20px; text-shadow: 0 0 20px rgba(138, 43, 226, 0.8); animation: ghostFloat 3s ease-in-out infinite;">👻</div>
                    ${getLayerName(layer)} Active<br>
                    <span style="font-size: 24px; color: #DA70D6; opacity: 0.9;">Browse freely. Leave no trace.</span>
                `;
            }
            
            // Cambiar el placeholder del buscador
            const searchInput = document.getElementById('homepageSearchInput');
            if (searchInput) {
                searchInput.placeholder = `🕶️ Búsqueda privada con ${getLayerName(layer)}...`;
                searchInput.style.background = 'rgba(138, 43, 226, 0.1)';
                searchInput.style.borderColor = 'rgba(138, 43, 226, 0.3)';
            }
        }

        function showStealthNotification(layer) {
            const notifications = {
                1: '🕶️ Layer 1 - Basic activado\n\n✅ Navegación privada estándar\n• Sin historial ni cookies\n• Sesión temporal\n\nNavega con confianza.',
                2: '🛡️ Layer 2 - Shield activado\n\n✅ Protección avanzada activa\n• Bloqueo de rastreadores\n• DNS seguro\n• Anti-fingerprinting\n\nTu privacidad está protegida.',
                3: '👻 Ghost Mode activado\n\n✅ Máxima privacidad activa\n• Sandbox temporal\n• Bóveda cifrada disponible\n• Modo paranoico\n• Bloqueo de capturas\n\nEres completamente invisible.'
            };
            
            setTimeout(() => {
                alert(notifications[layer] || notifications[1]);
            }, 500);
        }

        // Cerrar menús con tecla Escape y atajos de teclado
        document.addEventListener('keydown', function(event) {
            // Tecla Escape para cerrar overlays
            if (event.key === 'Escape') {
                const settingsOverlay = document.getElementById('settingsPanelOverlay');
                const browserMenuOverlay = document.getElementById('browserMenuOverlay');
                const stealthModeOverlay = document.getElementById('stealthModeOverlay');
                
                if (settingsOverlay && settingsOverlay.classList.contains('show')) {
                    closeSettingsPanel();
                } else if (browserMenuOverlay && browserMenuOverlay.classList.contains('show')) {
                    closeBrowserMenu();
                } else if (stealthModeOverlay && stealthModeOverlay.classList.contains('show')) {
                    closeStealthMode();
                }
            }
            
            // Atajos de teclado (solo si no están abiertos overlays)
            const isOverlayOpen = 
                document.getElementById('settingsPanelOverlay')?.classList.contains('show') ||
                document.getElementById('browserMenuOverlay')?.classList.contains('show') ||
                document.getElementById('stealthModeOverlay')?.classList.contains('show');
                
            if (!isOverlayOpen) {
                // Ctrl+T - Nueva pestaña
                if (event.ctrlKey && event.key === 't') {
                    event.preventDefault();
                    newTab();
                    updateStatus('Nueva pestaña creada (Ctrl+T)');
                }
                
                // Ctrl+N - Nueva ventana (placeholder)
                else if (event.ctrlKey && event.key === 'n') {
                    event.preventDefault();
                    createNewWindow();
                }
                
                // Ctrl+Shift+N - Neza Stealth Mode
                else if (event.ctrlKey && event.shiftKey && event.key === 'N') {
                    event.preventDefault();
                    openStealthMode();
                    updateStatus('Stealth Mode abierto (Ctrl+Shift+N)');
                }
                
                // Ctrl+, - Configuraciones
                else if (event.ctrlKey && event.key === ',') {
                    event.preventDefault();
                    showSettingsPanel();
                    updateStatus('Configuraciones abiertas (Ctrl+,)');
                }
                
                // Ctrl+W - Cerrar pestaña activa
                else if (event.ctrlKey && event.key === 'w') {
                    event.preventDefault();
                    if (tabs.length > 1) {
                        closeTab(activeTabId);
                        updateStatus('Pestaña cerrada (Ctrl+W)');
                    } else {
                        updateStatus('No se puede cerrar la última pestaña');
                    }
                }
                
                // F5 - Actualizar página
                else if (event.key === 'F5') {
                    event.preventDefault();
                    refresh();
                    updateStatus('Página actualizada (F5)');
                }
                
                // Alt+Izquierda - Atrás
                else if (event.altKey && event.key === 'ArrowLeft') {
                    event.preventDefault();
                    goBack();
                }
                
                // Alt+Derecha - Adelante  
                else if (event.altKey && event.key === 'ArrowRight') {
                    event.preventDefault();
                    goForward();
                }
                
                // Ctrl+L - Enfocar barra de direcciones
                else if (event.ctrlKey && event.key === 'l') {
                    event.preventDefault();
                    const addressInput = document.getElementById('addressInput');
                    if (addressInput) {
                        addressInput.focus();
                        addressInput.select();
                        updateStatus('Barra de direcciones enfocada (Ctrl+L)');
                    }
                }
            }
        });

        // Cerrar menús al hacer click fuera
        document.addEventListener('click', function(event) {
            const browserMenuOverlay = document.getElementById('browserMenuOverlay');
            const stealthModeOverlay = document.getElementById('stealthModeOverlay');
            
            if (browserMenuOverlay && browserMenuOverlay.classList.contains('show')) {
                if (event.target === browserMenuOverlay) {
                    closeBrowserMenu();
                }
            }
            
            if (stealthModeOverlay && stealthModeOverlay.classList.contains('show')) {
                if (event.target === stealthModeOverlay) {
                    closeStealthMode();
                }
            }
        });

        // ============ STEALTH MODE ADDITIONAL FUNCTIONS ============
        
        // Función para manejar navegación en modo stealth
        function stealthNavigate(url) {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab && activeTab.isStealthMode) {
                console.log('👻 Navegación stealth iniciada:', url, 'Capa:', activeTab.stealthLayer);
                
                // Aplicar configuraciones de privacidad según la capa
                applyStealthSecurity(activeTab.stealthLayer, url);
                
                // Navegar normalmente
                navigate(url);
            } else {
                navigate(url);
            }
        }

        function applyStealthSecurity(layer, url) {
            const features = getStealthFeatures(layer);
            console.log('🛡️ Aplicando seguridad stealth:', features);
            
            // Mostrar información de protección activa
            if (layer === 3) { // Ghost Mode
                updateStatus(`👻 Ghost Mode: Navegando a ${getDomainFromUrl(url)} con máxima protección`);
            } else if (layer === 2) { // Shield
                updateStatus(`🛡️ Shield Mode: Protección avanzada activa para ${getDomainFromUrl(url)}`);
            } else { // Basic
                updateStatus(`🕶️ Basic Mode: Navegación privada a ${getDomainFromUrl(url)}`);
            }
        }

        // Función para gestionar descargas en modo stealth
        function handleStealthDownload(downloadPath, fileName) {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab && activeTab.isStealthMode && activeTab.stealthLayer === 3) {
                // En Ghost Mode, mostrar advertencia sobre bóveda privada
                const confirmDownload = confirm(
                    `👻 Ghost Mode - Descarga Detectada\n\n` +
                    `📁 Archivo: ${fileName}\n\n` +
                    `⚠️ Este archivo se guardará en tu bóveda privada temporal.\n` +
                    `Se autodestruirá al cerrar la sesión Ghost Mode.\n\n` +
                    `¿Deseas continuar con la descarga?`
                );
                
                if (confirmDownload) {
                    updateStatus('👻 Archivo descargado a bóveda privada temporal');
                } else {
                    updateStatus('👻 Descarga cancelada por el usuario');
                }
                
                return confirmDownload;
            }
            
            return true; // Permitir descarga normal en otros modos
        }

        // Función para alternar entre capas de stealth sin cerrar
        function changeStealthLayer() {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab && activeTab.isStealthMode) {
                // Mostrar selector rápido de capas
                const newLayer = prompt(
                    `Cambiar Capa de Stealth\n\n` +
                    `Capa actual: ${getLayerName(activeTab.stealthLayer)}\n\n` +
                    `Ingresa el número de la nueva capa:\n` +
                    `1 - Layer 1 Basic\n` +
                    `2 - Layer 2 Shield\n` +
                    `3 - Ghost Mode\n\n` +
                    `Nota: Esto cerrará la pestaña actual y abrirá una nueva.`
                );
                
                if (newLayer && ['1', '2', '3'].includes(newLayer)) {
                    const layerNum = parseInt(newLayer);
                    
                    // Cerrar pestaña actual
                    closeTab(activeTabId);
                    
                    // Crear nueva con la capa seleccionada
                    createStealthTab(layerNum);
                    
                    updateStatus(`🔄 Cambiado a ${getLayerName(layerNum)}`);
                }
            }
        }

        // Función para limpiar sesión stealth
        function eraseStealthSession() {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab && activeTab.isStealthMode) {
                const confirmErase = confirm(
                    `👻 Borrar Sesión Stealth\n\n` +
                    `⚠️ ADVERTENCIA: Esta acción es IRREVERSIBLE\n\n` +
                    `Se borrará:\n` +
                    `• Historial de navegación de esta sesión\n` +
                    `• Archivos descargados en bóveda privada\n` +
                    `• Cookies y datos temporales\n` +
                    `• Caché y almacenamiento local\n\n` +
                    `¿Estás seguro de que deseas continuar?`
                );
                
                if (confirmErase) {
                    const deepErase = confirm(
                        `👻 Borrado Profundo\n\n` +
                        `¿También deseas borrar:\n` +
                        `• Procesos en memoria\n` +
                        `• Archivos temporales del sistema\n` +
                        `• Rastros en registro del sistema?\n\n` +
                        `Selecciona "Sí" para borrado completo\n` +
                        `Selecciona "No" para borrado básico`
                    );
                    
                    // Simular borrado (en implementación real, aquí iría la lógica de limpieza)
                    updateStatus('👻 Iniciando borrado de sesión stealth...');
                    
                    setTimeout(() => {
                        closeTab(activeTabId);
                        
                        if (deepErase) {
                            updateStatus('👻 Sesión stealth completamente borrada - Sin rastros');
                        } else {
                            updateStatus('👻 Sesión stealth borrada - Datos básicos eliminados');
                        }
                    }, 2000);
                }
            }
        }

        // Función para mostrar estado de protección stealth
        function showStealthProtectionStatus() {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            if (activeTab && activeTab.isStealthMode) {
                const features = activeTab.stealthFeatures;
                const layer = activeTab.stealthLayer;
                
                let statusMessage = `👻 ${getLayerName(layer)} - Estado de Protección\n\n`;
                
                const featureNames = {
                    noHistory: '✅ Sin historial de navegación',
                    noCookies: '✅ Cookies bloqueadas',
                    noCache: '✅ Caché deshabilitado',
                    blockTrackers: '🛡️ Rastreadores bloqueados',
                    blockFingerprinting: '🛡️ Fingerprinting bloqueado',
                    secureDNS: '🔒 DNS seguro activo',
                    httpsRedirect: '🔒 Redirección HTTPS forzada',
                    sandboxMode: '👻 Modo sandbox activo',
                    privateVault: '👻 Bóveda privada disponible',
                    paranoidMode: '👻 Modo paranoico activo',
                    screenCaptureBlock: '👻 Capturas de pantalla bloqueadas'
                };
                
                features.forEach(feature => {
                    if (featureNames[feature]) {
                        statusMessage += featureNames[feature] + '\n';
                    }
                });
                
                statusMessage += `\n🌐 Sitio actual: ${currentUrl ? getDomainFromUrl(currentUrl) : 'Página de inicio'}`;
                statusMessage += `\n⏱️ Sesión iniciada: ${new Date().toLocaleTimeString()}`;
                
                alert(statusMessage);
            }
        }

        // Event listener para funciones especiales de stealth
        document.addEventListener('keydown', function(event) {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            
            // Solo activar en pestañas stealth
            if (activeTab && activeTab.isStealthMode) {
                // Ctrl+Shift+E - Borrar sesión stealth
                if (event.ctrlKey && event.shiftKey && event.key === 'E') {
                    event.preventDefault();
                    eraseStealthSession();
                }
                
                // Ctrl+Shift+L - Cambiar capa stealth
                else if (event.ctrlKey && event.shiftKey && event.key === 'L') {
                    event.preventDefault();
                    changeStealthLayer();
                }
                
                // Ctrl+Shift+S - Estado de protección
                else if (event.ctrlKey && event.shiftKey && event.key === 'S') {
                    event.preventDefault();
                    showStealthProtectionStatus();
                }
            }
        });

        // ============ MUSIC PANEL FUNCTIONS ============
        // currentMediaInfo ya está definido globalmente arriba

        function toggleMusicPanel() {
            const overlay = document.getElementById('musicPanelOverlay');
            const btn = document.getElementById('musicControlBtn');
            
            if (overlay.style.display === 'none') {
                // Abrir panel
                overlay.style.display = 'flex';
                btn.classList.add('active');
                
                // Inicializar estado del panel
                updateStatus('🎵 Panel de música abierto');
                console.log('🎵 Panel de música abierto - iniciando detección...');
                
                // Detectar música inmediatamente y luego con delay
                detectCurrentMedia();
                setTimeout(() => {
                    detectCurrentMedia();
                    console.log('🔄 Segunda detección de música completada');
                }, 500);
            } else {
                // Cerrar panel
                closeMusicPanel();
            }
        }

        function closeMusicPanel() {
            const overlay = document.getElementById('musicPanelOverlay');
            const btn = document.getElementById('musicControlBtn');
            const panel = document.getElementById('musicPanel');
            
            // Animación de cierre suave
            if (panel) {
                panel.style.animation = 'slideDown 0.3s ease-in';
                overlay.style.animation = 'fadeOut 0.3s ease-in';
            }
            
            setTimeout(() => {
                overlay.style.display = 'none';
                btn.classList.remove('active');
                
                // Resetear animaciones
                if (panel) {
                    panel.style.animation = '';
                    overlay.style.animation = '';
                }
            }, 300);
            
            updateStatus('🎵 Panel de música cerrado');
        }

        function detectCurrentMedia() {
            console.log('🔍 detectCurrentMedia iniciado - pestañas:', tabs.length);
            updateStatus('🔍 Detectando música...');
            
            // Buscar música en TODAS las pestañas, no solo la activa
            let foundMedia = false;
            let checkedTabs = 0;
            
            for (let tab of tabs) {
                const webview = document.getElementById('webview-' + tab.id);
                console.log(`Verificando tab ${tab.id}: webview existe=${!!webview}, src=${webview ? webview.src : 'N/A'}`);
                
                if (webview && webview.src && !webview.src.includes('about:blank')) {
                    webview.executeJavaScript(`
                        (function() {
                            console.log('🔍 Detectando música en pestaña ${tab.id}');
                            const videos = document.querySelectorAll('video');
                            const audios = document.querySelectorAll('audio');
                            
                            console.log('Videos encontrados:', videos.length, 'Audios:', audios.length);
                            
                            // Buscar videos con contenido (incluyendo pausados)
                            for (let i = 0; i < videos.length; i++) {
                                let video = videos[i];
                                console.log('Video', i, '- paused:', video.paused, 'currentTime:', video.currentTime, 'duration:', video.duration, 'readyState:', video.readyState);
                                
                                // MEJOR DETECCIÓN: Priorizar videos que están reproduciéndose
                                if (video.duration > 0 || video.readyState >= 1 || video.currentTime > 0) {
                                    let title = document.title || 'Video detectado';
                                    let isCurrentlyPlaying = !video.paused && video.currentTime > 0;
                                    
                                    // Extraer mejor título de YouTube
                                    if (window.location.hostname.includes('youtube.com')) {
                                        const ytTitle = document.querySelector('h1.title yt-formatted-string, #container h1, .title.style-scope.ytd-video-primary-info-renderer, .watch-title');
                                        if (ytTitle) title = ytTitle.textContent?.trim() || title;
                                    }
                                    
                                    // PRIORIDAD: Si está reproduciéndose ahora, devolver inmediatamente
                                    if (isCurrentlyPlaying) {
                                        console.log('🎵 REPRODUCIENDO AHORA:', title);
                                        return {
                                            isPlaying: true,
                                            title: title,
                                            artist: window.location.hostname || 'Desconocido',
                                            source: window.location.hostname,
                                            currentTime: Math.floor(video.currentTime),
                                            duration: Math.floor(video.duration),
                                            priority: 'playing_now'  // Marca de prioridad alta
                                        };
                                    }
                                    
                                    // Si no está reproduciéndose, devolver como posible
                                    return {
                                        isPlaying: false,
                                        title: title,
                                        artist: window.location.hostname || 'Desconocido',
                                        source: window.location.hostname,
                                        currentTime: Math.floor(video.currentTime || 0),
                                        totalTime: Math.floor(video.duration || 0),
                                        volume: Math.floor((video.volume || 1) * 100),
                                        type: 'video',
                                        tabId: ${tab.id},
                                        hasContent: true
                                    };
                                }
                            }
                            
                            // Buscar audios con contenido
                            for (let i = 0; i < audios.length; i++) {
                                let audio = audios[i];
                                console.log('Audio', i, '- paused:', audio.paused, 'currentTime:', audio.currentTime, 'duration:', audio.duration, 'readyState:', audio.readyState);
                                
                                if (audio.duration > 0 || audio.readyState >= 1 || audio.currentTime > 0) {
                                    return {
                                        isPlaying: !audio.paused,
                                        title: document.title || 'Audio detectado',
                                        artist: window.location.hostname || 'Desconocido',
                                        source: window.location.hostname,
                                        currentTime: Math.floor(audio.currentTime || 0),
                                        totalTime: Math.floor(audio.duration || 0),
                                        volume: Math.floor((audio.volume || 1) * 100),
                                        type: 'audio',
                                        tabId: ${tab.id},
                                        hasContent: true
                                    };
                                }
                            }
                            
                            return { 
                                isPlaying: false, 
                                videosFound: videos.length, 
                                audiosFound: audios.length,
                                hasContent: videos.length > 0 || audios.length > 0
                            };
                        })();
                    `).then(result => {
                        checkedTabs++;
                        console.log(`Tab ${tab.id} resultado:`, result);
                        
                        if (result && (result.isPlaying || result.hasContent) && !foundMedia) {
                            foundMedia = true;
                            console.log('🎵 Contenido multimedia encontrado en tab:', tab.id, 'Playing:', result.isPlaying, 'HasContent:', result.hasContent);
                            
                            // Agregar información de la pestaña
                            result.tabTitle = tab.title;
                            result.tabUrl = tab.url;
                            result.isActiveTab = tab.isActive;
                            updatePanelInfo(result, webview, tab);
                        }
                        
                        // Verificar si hemos checkeado todas las pestañas
                        if (checkedTabs >= tabs.length && !foundMedia) {
                            console.log('❌ No se encontró música en ninguna pestaña');
                            updatePanelInfo({
                                isPlaying: false,
                                title: 'Sin reproducción activa',
                                artist: 'Ninguna pestaña reproduciendo',
                                source: 'N/A',
                                tabTitle: 'N/A'
                            }, null, null);
                        }
                    }).catch(e => {
                        checkedTabs++;
                        console.error(`Error en tab ${tab.id}:`, e);
                    });
                } else {
                    checkedTabs++;
                }
            }
        }

        function updatePanelInfo(mediaInfo, webview, tab) {
            console.log('📋 Actualizando panel info:', mediaInfo, 'webview:', !!webview, 'tab:', tab ? tab.title : 'N/A');
            
            // Asegurar que currentMediaInfo existe
            if (typeof currentMediaInfo === 'undefined') {
                currentMediaInfo = {
                    isPlaying: false,
                    title: '',
                    artist: '',
                    source: '',
                    currentTime: 0,
                    totalTime: 0,
                    volume: 100,
                    shuffle: false,
                    repeat: false,
                    activeWebview: null,
                    mediaTab: null
                };
            }
            
            currentMediaInfo = { 
                ...currentMediaInfo, 
                ...mediaInfo, 
                activeWebview: webview,
                mediaTab: tab 
            };
            
            // Actualizar elementos del panel
            const remoteIndicator = document.getElementById('remoteTabIndicator');
            
            if (mediaInfo.isPlaying) {
                if (tab && !mediaInfo.isActiveTab) {
                    // Música en otra pestaña
                    const statusText = `🎵 Reproduciendo en: "${tab.title.substring(0, 25)}${tab.title.length > 25 ? '...' : ''}"`;
                    document.getElementById('musicStatus').textContent = statusText;
                    if (remoteIndicator) remoteIndicator.style.display = 'block';
                } else {
                    // Música en pestaña actual
                    document.getElementById('musicStatus').textContent = '🎵 Reproduciendo ahora';
                    if (remoteIndicator) remoteIndicator.style.display = 'none';
                }
            } else {
                document.getElementById('musicStatus').textContent = 'Sin reproducción activa';
                if (remoteIndicator) remoteIndicator.style.display = 'none';
            }
            
            document.getElementById('panelTrackTitle').textContent = mediaInfo.title || 'Sin título';
            document.getElementById('panelTrackArtist').textContent = mediaInfo.artist || 'Desconocido';
            
            // Mostrar información de la pestaña si no es la activa
            const sourceText = tab && !mediaInfo.isActiveTab ? 
                `${mediaInfo.source} (Pestaña: ${tab.title.substring(0, 20)})` : 
                mediaInfo.source || 'N/A';
            document.getElementById('panelTrackSource').textContent = sourceText;
            
            // Actualizar botón de play/pause
            const panelPlayBtn = document.getElementById('panelPlayPauseBtn');
            if (panelPlayBtn) {
                panelPlayBtn.textContent = mediaInfo.isPlaying ? '⏸️' : '▶️';
            }
            
            const playPauseBtn = document.getElementById('panelPlayPauseBtn');
            playPauseBtn.textContent = mediaInfo.isPlaying ? '⏸️' : '▶️';
            
            if (mediaInfo.volume !== undefined) {
                document.getElementById('volumeSlider').value = mediaInfo.volume;
                document.getElementById('volumePercent').textContent = mediaInfo.volume + '%';
            }
            
            updateProgressDisplay(mediaInfo.currentTime || 0, mediaInfo.totalTime || 0);
            
            // Indicar visualmente si la música está en otra pestaña
            updateMusicControlButton(mediaInfo.isPlaying, tab);
            
            // Actualizar controles para pestaña remota
            updateRemoteTabControls();
        }
        
        function updateMusicControlButton(isPlaying, tab) {
            const btn = document.getElementById('musicControlBtn');
            const activeTab = tabs.find(t => t.isActive);
            
            if (isPlaying && tab && tab.id !== activeTab?.id) {
                // Música está en otra pestaña - pulsar el botón
                btn.style.animation = 'musicPulse 1s infinite';
                btn.style.background = 'linear-gradient(135deg, var(--neza-primary), var(--neza-secondary))';
                btn.style.color = '#000';
            } else if (isPlaying) {
                // Música está en pestaña actual
                btn.style.animation = 'musicPulse 2s infinite';
                btn.style.background = 'var(--neza-primary)';
                btn.style.color = '#000';
            } else {
                // No hay música
                btn.style.animation = 'none';
                btn.style.background = '';
                btn.style.color = '';
            }
        }

        function togglePlayPause() {
            console.log('🎵 togglePlayPause llamado. activeWebview:', !!currentMediaInfo.activeWebview);
            
            // Si no hay webview activa, buscar en todas las pestañas
            if (!currentMediaInfo.activeWebview) {
                updateStatus('🔍 Buscando música activa...');
                
                // Buscar en la pestaña activa primero
                const activeTab = tabs.find(t => t.isActive);
                if (activeTab) {
                    const webview = document.getElementById('webview-' + activeTab.id);
                    if (webview && webview.src && !webview.src.includes('about:blank')) {
                        console.log('🎯 Usando pestaña activa para control de música');
                        currentMediaInfo.activeWebview = webview;
                        currentMediaInfo.mediaTab = activeTab;
                    }
                }
                
                // Si aún no hay, detectar automáticamente
                if (!currentMediaInfo.activeWebview) {
                    detectCurrentMedia();
                    setTimeout(() => {
                        if (currentMediaInfo.activeWebview) {
                            togglePlayPause(); // Reintentar
                        } else {
                            updateStatus('❌ No se encontró música activa');
                        }
                    }, 500);
                    return;
                }
            }
            
            if (currentMediaInfo.activeWebview) {
                updateStatus('🔄 Controlando reproducción...');
                currentMediaInfo.activeWebview.executeJavaScript(`
                    (function() {
                        const videos = document.querySelectorAll('video');
                        const audios = document.querySelectorAll('audio');
                        
                        for (let video of videos) {
                            if (!video.paused || !video.ended) {
                                if (video.paused) {
                                    video.play();
                                    return { action: 'play' };
                                } else {
                                    video.pause();
                                    return { action: 'pause' };
                                }
                            }
                        }
                        
                        for (let audio of audios) {
                            if (!audio.paused || !audio.ended) {
                                if (audio.paused) {
                                    audio.play();
                                    return { action: 'play' };
                                } else {
                                    audio.pause();
                                    return { action: 'pause' };
                                }
                            }
                        }
                        
                        return { action: 'none' };
                    })();
                `).then(result => {
                    const playPauseBtn = document.getElementById('playPauseBtn');
                    if (result.action === 'play') {
                        playPauseBtn.textContent = '⏸️';
                        currentMediaInfo.isPlaying = true;
                    } else if (result.action === 'pause') {
                        playPauseBtn.textContent = '▶️';
                        currentMediaInfo.isPlaying = false;
                    }
                }).catch(e => {
                    console.error('Error en togglePlayPause:', e);
                    updateStatus('❌ Error controlando reproducción');
                });
            }
        }

        function previousTrack() {
            if (!currentMediaInfo.activeWebview) {
                updateStatus('🔍 Buscando música activa...');
                detectCurrentMedia();
                return;
            }
            
            if (currentMediaInfo.activeWebview) {
                // Intentar ir al track anterior o reiniciar el actual
                currentMediaInfo.activeWebview.executeJavaScript(`
                    (function() {
                        const videos = document.querySelectorAll('video');
                        const audios = document.querySelectorAll('audio');
                        
                        for (let media of [...videos, ...audios]) {
                            if (!media.paused || !media.ended) {
                                if (media.currentTime > 3) {
                                    media.currentTime = 0;
                                } else {
                                    // Simular tecla de anterior en YouTube, Spotify, etc.
                                    const prevBtn = document.querySelector('[data-testid="control-button-skip-back"], .ytp-prev-button, [title*="anterior"], [title*="Previous"]');
                                    if (prevBtn) prevBtn.click();
                                }
                                return true;
                            }
                        }
                        return false;
                    })();
                `).then(result => {
                    updateStatus('⏮️ Pista anterior');
                }).catch(e => {
                    updateStatus('❌ Error: anterior');
                });
            }
        }

        function nextTrack() {
            if (!currentMediaInfo.activeWebview) {
                updateStatus('🔍 Buscando música activa...');
                detectCurrentMedia();
                return;
            }
            
            if (currentMediaInfo.activeWebview) {
                currentMediaInfo.activeWebview.executeJavaScript(`
                    (function() {
                        // Simular tecla de siguiente en YouTube, Spotify, etc.
                        const nextBtn = document.querySelector('[data-testid="control-button-skip-forward"], .ytp-next-button, [title*="siguiente"], [title*="Next"]');
                        if (nextBtn) {
                            nextBtn.click();
                            return true;
                        }
                        return false;
                    })();
                `).then(result => {
                    updateStatus('⏭️ Siguiente pista');
                }).catch(e => {
                    updateStatus('❌ Error: siguiente');
                });
            }
        }

        function updateProgressDisplay(current, total) {
            const progressFill = document.getElementById('panelProgressFill');
            const progressThumb = document.getElementById('panelProgressThumb');
            const currentTimeEl = document.getElementById('panelCurrentTime');
            const totalTimeEl = document.getElementById('panelTotalTime');
            
            if (total > 0) {
                const percentage = (current / total) * 100;
                if (progressFill) progressFill.style.width = percentage + '%';
                if (progressThumb) progressThumb.style.left = percentage + '%';
            }
            
            if (currentTimeEl) currentTimeEl.textContent = formatTime(current);
            if (totalTimeEl) totalTimeEl.textContent = formatTime(total);
        }

        function seekToPosition(event) {
            if (currentMediaInfo.activeWebview && currentMediaInfo.totalTime > 0) {
                const container = event.currentTarget;
                const rect = container.getBoundingClientRect();
                const clickX = event.clientX - rect.left;
                const percentage = clickX / rect.width;
                const newTime = percentage * currentMediaInfo.totalTime;
                
                currentMediaInfo.activeWebview.executeJavaScript(`
                    (function() {
                        const videos = document.querySelectorAll('video');
                        const audios = document.querySelectorAll('audio');
                        
                        for (let video of videos) {
                            if (!video.paused || !video.ended) {
                                video.currentTime = ${newTime};
                                return true;
                            }
                        }
                        
                        for (let audio of audios) {
                            if (!audio.paused || !audio.ended) {
                                audio.currentTime = ${newTime};
                                return true;
                            }
                        }
                        
                        return false;
                    })();
                `).then(result => {
                    if (result) {
                        updateStatus('⏩ Saltando a ' + formatTime(newTime));
                        updateProgressDisplay(newTime, currentMediaInfo.totalTime);
                    }
                }).catch(e => {
                    updateStatus('❌ Error saltando en la reproducción');
                });
            }
        }

        function adjustVolume(volume) {
            document.getElementById('volumePercent').textContent = volume + '%';
            currentMediaInfo.volume = parseInt(volume);
            
            if (!currentMediaInfo.activeWebview) {
                updateStatus('🔍 Buscando música activa...');
                detectCurrentMedia();
                return;
            }
            
            if (currentMediaInfo.activeWebview) {
                currentMediaInfo.activeWebview.executeJavaScript(`
                    (function() {
                        const videos = document.querySelectorAll('video');
                        const audios = document.querySelectorAll('audio');
                        const newVolume = ${volume} / 100;
                        
                        for (let video of videos) {
                            video.volume = newVolume;
                        }
                        
                        for (let audio of audios) {
                            audio.volume = newVolume;
                        }
                        
                        return true;
                    })();
                `).then(() => {
                    updateStatus('🔊 Volumen: ' + volume + '%');
                }).catch(e => {
                    updateStatus('❌ Error ajustando volumen');
                });
            }
        }

        function shuffleToggle() {
            currentMediaInfo.shuffle = !currentMediaInfo.shuffle;
            const btn = document.getElementById('shuffleBtn');
            
            if (currentMediaInfo.shuffle) {
                btn.classList.add('active');
                updateStatus('🔀 Modo aleatorio activado');
            } else {
                btn.classList.remove('active');
                updateStatus('🔀 Modo aleatorio desactivado');
            }
        }

        function debugAudioDetection() {
            updateStatus('🐛 Ejecutando debug de detección...');
            
            let debugInfo = 'DEBUG INFO:\n';
            debugInfo += `Pestañas totales: ${tabs.length}\n`;
            debugInfo += `Active webview: ${!!currentMediaInfo.activeWebview}\n\n`;
            
            // Debug cada pestaña
            for (let i = 0; i < tabs.length; i++) {
                const tab = tabs[i];
                const webview = document.getElementById('webview-' + tab.id);
                debugInfo += `TAB ${i+1} (ID: ${tab.id}):\n`;
                debugInfo += `  Título: ${tab.title}\n`;
                debugInfo += `  URL: ${tab.url}\n`;
                debugInfo += `  Webview existe: ${!!webview}\n`;
                debugInfo += `  Webview src: ${webview ? webview.src : 'N/A'}\n`;
                debugInfo += `  Es activa: ${tab.isActive}\n`;
                
                // Probar detección de audio en esta pestaña específica
                if (webview && webview.src && !webview.src.includes('about:blank')) {
                    webview.executeJavaScript(`
                        (function() {
                            return {
                                videos: document.querySelectorAll('video').length,
                                audios: document.querySelectorAll('audio').length,
                                title: document.title,
                                host: window.location.hostname
                            };
                        })();
                    `).then(result => {
                        console.log(`Tab ${tab.id} media info:`, result);
                    }).catch(e => {
                        console.log(`Tab ${tab.id} error:`, e.message);
                    });
                }
                
                debugInfo += `\n`;
            }
            
            console.log(debugInfo);
            alert(debugInfo);
            
            // También intentar detectar música
            setTimeout(() => {
                detectCurrentMedia();
            }, 1000);
        }

        function repeatToggle() {
            currentMediaInfo.repeat = !currentMediaInfo.repeat;
            const btn = document.getElementById('repeatBtn');
            
            if (currentMediaInfo.repeat) {
                btn.classList.add('active');
                btn.textContent = '🔂';
                updateStatus('🔁 Modo repetir activado');
            } else {
                btn.classList.remove('active');
                btn.textContent = '🔁';
                updateStatus('🔁 Modo repetir desactivado');
            }
        }

        function downloadAudio() {
            updateStatus('💾 Función de descarga próximamente disponible');
        }

        function shareMusic() {
            if (currentMediaInfo.activeWebview && currentMediaInfo.mediaTab) {
                const url = currentMediaInfo.mediaTab.url;
                const title = currentMediaInfo.title;
                
                navigator.clipboard.writeText(`🎵 ${title} - ${url}`).then(() => {
                    updateStatus('📤 Enlace copiado al portapapeles');
                }).catch(() => {
                    updateStatus('❌ Error copiando enlace');
                });
            }
        }
        
        // Función para ir a la pestaña con música
        function goToMusicTab() {
            if (currentMediaInfo.mediaTab && currentMediaInfo.mediaTab.id) {
                const tabTitle = currentMediaInfo.mediaTab.title.substring(0, 40);
                
                // Cambiar a la pestaña que tiene música
                switchToTab(currentMediaInfo.mediaTab.id);
                updateStatus(`� Navegando a pestaña con música: ${tabTitle}...`);
                
                // Cerrar automáticamente el panel de música para mejor experiencia
                setTimeout(() => {
                    closeMusicPanel();
                    updateStatus(`✅ Ahora en pestaña: ${tabTitle} - Panel cerrado automáticamente`);
                }, 300); // Pequeño delay para que se vea la transición
            }
        }
        
        // Actualizar controles para trabajar con pestaña remota
        function updateRemoteTabControls() {
            const panel = document.getElementById('musicPanel');
            if (panel && currentMediaInfo.mediaTab) {
                const activeTab = tabs.find(tab => tab.isActive);
                
                if (currentMediaInfo.mediaTab.id !== activeTab?.id) {
                    // Agregar botón para ir a pestaña con música si no existe
                    let goToTabBtn = document.getElementById('goToMusicTabBtn');
                    if (!goToTabBtn) {
                        goToTabBtn = document.createElement('button');
                        goToTabBtn.id = 'goToMusicTabBtn';
                        goToTabBtn.className = 'extra-btn';
                        const tabTitle = currentMediaInfo.mediaTab.title.substring(0, 20);
                        goToTabBtn.innerHTML = `🎯 Ver: ${tabTitle}${currentMediaInfo.mediaTab.title.length > 20 ? '...' : ''}`;
                        goToTabBtn.onclick = goToMusicTab;
                        
                        const additionalControls = panel.querySelector('.additional-controls');
                        if (additionalControls) {
                            additionalControls.insertBefore(goToTabBtn, additionalControls.firstChild);
                        }
                    }
                    goToTabBtn.style.display = 'block';
                } else {
                    // Ocultar botón si ya estamos en la pestaña correcta
                    const goToTabBtn = document.getElementById('goToMusicTabBtn');
                    if (goToTabBtn) {
                        goToTabBtn.style.display = 'none';
                    }
                }
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return minutes + ':' + (secs < 10 ? '0' : '') + secs;
        }

        function setupMusicPanelEvents() {
            // Cerrar panel al hacer click fuera
            const overlay = document.getElementById('musicPanelOverlay');
            const panel = document.getElementById('musicPanel');
            
            if (overlay && panel) {
                overlay.addEventListener('click', function(e) {
                    if (e.target === overlay) {
                        closeMusicPanel();
                    }
                });
            }
        }

        function setupMediaProgressClick() {
            const progressBar = document.querySelector('.progress-bar');
            if (progressBar) {
                progressBar.addEventListener('click', function(e) {
                    if (currentMediaInfo.activeWebview && currentMediaInfo.totalTime > 0) {
                        const rect = progressBar.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const percentage = clickX / rect.width;
                        const newTime = percentage * currentMediaInfo.totalTime;
                        
                        currentMediaInfo.activeWebview.executeJavaScript(`
                            (function() {
                                const videos = document.querySelectorAll('video');
                                const audios = document.querySelectorAll('audio');
                                
                                for (let video of videos) {
                                    if (!video.paused || !video.ended) {
                                        video.currentTime = ${newTime};
                                        return true;
                                    }
                                }
                                
                                for (let audio of audios) {
                                    if (!audio.paused || !audio.ended) {
                                        audio.currentTime = ${newTime};
                                        return true;
                                    }
                                }
                                
                                return false;
                            })();
                        `).then(result => {
                            if (result) {
                                updateStatus('⏩ Saltando a ' + formatTime(newTime));
                            }
                        }).catch(e => {
                            updateStatus('❌ Error saltando en la reproducción');
                        });
                    }
                });
            }
        }

        // Sugerencias de búsqueda
        function updateSuggestions() {
            // Funcionalidad de autocompletado próximamente
        }

        function startVoiceSearch() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'es-ES';

                recognition.onstart = function() {
                    updateStatus('🎤 Listening... Speak now!');
                    const voiceBtn = document.querySelector('.search-voice-btn');
                    voiceBtn.style.color = 'var(--neza-primary)';
                    voiceBtn.style.animation = 'musicPulse 1s infinite';
                };

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('homepageSearchInput').value = transcript;
                    updateStatus('🎤 Voice search: "' + transcript + '"');
                    
                    // Auto-search after voice input
                    setTimeout(() => {
                        handleHomepageSearch({ key: 'Enter' });
                    }, 500);
                };

                recognition.onerror = function(event) {
                    updateStatus('❌ Voice recognition error: ' + event.error);
                };

                recognition.onend = function() {
                    const voiceBtn = document.querySelector('.search-voice-btn');
                    voiceBtn.style.color = '';
                    voiceBtn.style.animation = '';
                };

                recognition.start();
            } else {
                updateStatus('❌ Voice recognition not supported in this browser');
            }
        }

        function isURL(str) {
            // Versión simplificada y segura
            if (str.includes('http://') || str.includes('https://')) return true;
            if (str.includes('www.')) return true;
            if (str.includes('.com') || str.includes('.org') || str.includes('.net')) return true;
            return false;
        }

        // ============ SEARCH ENGINE MANAGEMENT ============
        let currentSearchEngine = 'google'; // Neza usa Google por defecto

        const searchEngines = {
            google: {
                name: 'Neza Search',
                icon: '�',
                url: 'https://www.google.com/search?q=',
                placeholder: 'Search with Neza...'
            }
        };

        // Funciones simplificadas para Neza Search
        function updateSearchEngineUI() {
            const indicator = document.getElementById('searchEngineIndicator');
            const input = document.getElementById('homepageSearchInput');
            
            if (indicator) {
                indicator.textContent = '🚀';
                indicator.title = 'Powered by Neza';
            }
            
            if (input) {
                input.placeholder = 'Search with Neza...';
            }
        }

        function getCurrentSearchUrl(query) {
            return 'https://www.google.com/search?q=' + encodeURIComponent(query);
        }

        // Función de búsqueda principal de Neza
        function handleHomepageSearch(event) {
            if (event.key === 'Enter') {
                const query = document.getElementById('homepageSearchInput').value.trim();
                if (query) {
                    // Si es una URL, navegar directamente
                    if (isURL(query)) {
                        navigate(query);
                    } else {
                        // Buscar con Neza (powered by Google)
                        const searchUrl = 'https://www.google.com/search?q=' + encodeURIComponent(query);
                        navigate(searchUrl);
                        updateStatus('� Buscando con Neza: "' + query + '"');
                    }
                }
            }
        }

        // Función de búsqueda unificada
        function searchFor(query) {
            const searchUrl = 'https://www.google.com/search?q=' + encodeURIComponent(query);
            navigate(searchUrl);
            updateStatus('� Buscando con Neza: "' + query + '"');
        }

        // Inicializar pestañas y asegurar visualización correcta
        renderTabs();
        
        // Asegurar que la primera pestaña esté visible
        setTimeout(() => {
            if (tabs.length > 0) {
                forceTabVisibility();
                
                // Asegurar estado correcto de la interfaz
                const activeTab = tabs.find(tab => tab.isActive);
                if (activeTab && !activeTab.url) {
                    isHomePage = true;
                    document.getElementById('homepage').style.display = 'flex';
                    document.getElementById('webviewContainer').classList.remove('active');
                }
            }
        }, 200);
        
        // Easter eggs y efectos
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                document.getElementById('addressInput').focus();
                updateStatus('Búsqueda rápida activada');
            }
        });

        // ===========================================
        // FUNCIONES DE CONTROL DE AUDIO EN PESTAÑAS
        // ===========================================
        
        function checkTabAudio() {
            console.log('=== Verificando audio en pestañas ===');
            
            tabs.forEach((tab) => {
                const webview = document.getElementById('webview-' + tab.id);
                const tabElement = document.getElementById('tab-' + tab.id);
                const audioButton = tabElement?.querySelector('.tab-audio-button');
                
                console.log(`Tab ${tab.id}:`, {
                    webview: !!webview,
                    tabElement: !!tabElement,
                    audioButton: !!audioButton,
                    url: webview?.src || 'No URL'
                });
                
                if (webview && tabElement && audioButton && webview.src) {
                    try {
                        // Detectar si es un sitio que típicamente tiene audio
                        const audioSites = [
                            'youtube.com', 'youtu.be',
                            'twitch.tv',
                            'spotify.com', 'music.spotify.com',
                            'soundcloud.com',
                            'netflix.com',
                            'vimeo.com',
                            'dailymotion.com'
                        ];
                        
                        const hasAudio = !webview.src.includes('about:blank') && 
                                        audioSites.some(site => webview.src.toLowerCase().includes(site));
                        
                        console.log(`Tab ${tab.id} tiene audio:`, hasAudio);
                        
                        if (hasAudio) {
                            tabElement.classList.add('has-audio');
                            audioButton.innerHTML = '�';
                            audioButton.title = 'Controlar audio (aparece al hover)';
                            console.log(`Audio habilitado para tab ${tab.id}`);
                        } else {
                            tabElement.classList.remove('has-audio', 'audio-muted');
                        }
                    } catch (err) {
                        console.error(`Error checking audio for tab ${tab.id}:`, err);
                        tabElement.classList.remove('has-audio', 'audio-muted');
                    }
                }
            });
            
            console.log('=== Fin verificación audio ===');
        }
        
        function toggleTabAudio(tabId, event) {
            event.stopPropagation();
            
            console.log('=== TOGGLE AUDIO SIMPLE ===', tabId);
            
            const webview = document.getElementById('webview-' + tabId);
            const tabElement = document.getElementById('tab-' + tabId);
            const tab = tabs.find(t => t.id === tabId);
            
            if (!webview || !tabElement || !tab) {
                console.error('Elementos faltantes');
                updateStatus('❌ Error: elementos faltantes');
                return;
            }
            
            console.log('Controlando audio en:', tab.title);
            
            webview.executeJavaScript(`
                const videos = document.querySelectorAll('video');
                const audios = document.querySelectorAll('audio');
                let changed = false;
                let newMuted = false;
                
                [...videos, ...audios].forEach(media => {
                    if (media.src || media.currentSrc) {
                        newMuted = !media.muted;
                        media.muted = newMuted;
                        changed = true;
                    }
                });
                
                return { success: changed, muted: newMuted };
            `).then(result => {
                console.log('Resultado audio:', result);
                
                if (result.success) {
                    const audioButton = tabElement.querySelector('.tab-audio-button');
                    
                    if (result.muted) {
                        tabElement.classList.add('audio-muted');
                        if (audioButton) audioButton.innerHTML = '🔇';
                        updateStatus('🔇 Audio silenciado');
                    } else {
                        tabElement.classList.remove('audio-muted');
                        if (audioButton) audioButton.innerHTML = '🔊';
                        updateStatus('🔊 Audio activado');
                    }
                } else {
                    updateStatus('⚠️ No se encontró audio');
                }
            }).catch(err => {
                console.error('Error audio:', err);
                updateStatus('❌ Error controlando audio');
            });
        }
        
        // Función de fallback removida - se simplificó en toggleTabAudioSimple

        // ===========================================
        // FUNCIONES DE VIDEO FLOTANTE (PiP)
        // ===========================================
        
        let pipState = {
            active: false,
            size: 'normal', // 'normal' o 'large'
            dragging: false,
            sourceTab: -1,
            syncInterval: null
        };
        
        function startPictureInPicture() {
            const activeTab = tabs.find(tab => tab.isActive);
            if (!activeTab) {
                updateStatus('No hay pestaña activa');
                return;
            }
            
            const activeWebview = document.getElementById('webview-' + activeTab.id);
            
            if (!activeWebview || !activeWebview.src || activeWebview.src.includes('about:blank')) {
                updateStatus('⚠️ No hay contenido para mostrar en modo flotante');
                return;
            }
            
            // Verificar si es una página de video
            const videoSites = ['youtube.com', 'twitch.tv', 'netflix.com', 'vimeo.com', 'dailymotion.com'];
            const isVideoSite = videoSites.some(site => activeWebview.src.includes(site));
            
            if (!isVideoSite) {
                updateStatus('⚠️ Esta página no soporta video flotante');
                return;
            }
            
            // Usar siempre el sistema flotante personalizado
            startCustomPiP(activeTab, activeWebview);
        }
        
        function startCustomPiP(activeTab, activeWebview) {
            const pipContainer = document.getElementById('pipContainer');
            const pipVideo = document.getElementById('pipVideo');
            
            // Para YouTube, extraer el ID y crear embed
            if (activeWebview.src.includes('youtube.com')) {
                const videoId = extractYouTubeVideoId(activeWebview.src);
                if (videoId) {
                    // Obtener el tiempo actual si es posible
                    activeWebview.executeJavaScript(`
                        const video = document.querySelector('video');
                        return video ? video.currentTime : 0;
                    `).then(currentTime => {
                        const startTime = Math.floor(currentTime);
                        pipVideo.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&modestbranding=1&start=${startTime}`;
                        
                        pipContainer.classList.add('active');
                        pipState.active = true;
                        pipState.sourceTab = activeTab.id;
                        
                        updateStatus(`📺 Video flotante activado desde "${activeTab.title}"`);
                        makePipDraggable();
                        startPipSync(activeTab.id);
                    }).catch(() => {
                        pipVideo.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&modestbranding=1`;
                        activatePip(activeTab);
                    });
                } else {
                    updateStatus('⚠️ No se pudo extraer el video de YouTube');
                }
            } else {
                // Para otros sitios, usar la URL directa
                pipVideo.src = activeWebview.src;
                activatePip(activeTab);
            }
        }
        
        function activatePip(activeTab) {
            const pipContainer = document.getElementById('pipContainer');
            pipContainer.classList.add('active');
            pipState.active = true;
            pipState.sourceTab = activeTab.id;
            updateStatus(`📺 Video flotante activado desde "${activeTab.title}"`);
            makePipDraggable();
            startPipSync(activeTab.id);
        }
        
        function startFallbackPiP(activeTab, activeWebview) {
            const pipContainer = document.getElementById('pipContainer');
            const pipVideo = document.getElementById('pipVideo');
            
            // Sistema de respaldo: crear iframe enfocado en el video
            if (activeWebview.src.includes('youtube.com')) {
                // Para YouTube, extraer el ID del video y crear un embed
                const videoId = extractYouTubeVideoId(activeWebview.src);
                if (videoId) {
                    pipVideo.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&modestbranding=1`;
                } else {
                    pipVideo.src = activeWebview.src;
                }
            } else {
                // Para otros sitios, usar URL directa
                pipVideo.src = activeWebview.src;
            }
            
            pipContainer.classList.add('active');
            pipState.active = true;
            pipState.sourceTab = activeTab.id;
            
            updateStatus(`📺 Video flotante activado (modo compatibilidad) desde "${activeTab.title}"`);
            makePipDraggable();
        }
        
        function extractYouTubeVideoId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }
        
        function closePip() {
            const pipContainer = document.getElementById('pipContainer');
            const pipVideo = document.getElementById('pipVideo');
            
            pipContainer.classList.remove('active');
            pipVideo.src = 'about:blank';
            
            // Limpiar sincronización
            if (pipState.syncInterval) {
                clearInterval(pipState.syncInterval);
                pipState.syncInterval = null;
            }
            
            pipState.active = false;
            pipState.sourceTab = -1;
            
            updateStatus('📺 Video flotante cerrado');
        }
        
        function togglePipSize() {
            const pipContainer = document.getElementById('pipContainer');
            const resizeBtn = document.getElementById('pipResizeBtn');
            
            if (pipState.size === 'normal') {
                // Cambiar a tamaño grande
                pipContainer.style.width = '480px';
                pipContainer.style.height = '270px';
                pipState.size = 'large';
                resizeBtn.innerHTML = '⇲';
                resizeBtn.title = 'Reducir';
                updateStatus('Video flotante ampliado');
            } else {
                // Cambiar a tamaño normal
                pipContainer.style.width = '320px';
                pipContainer.style.height = '180px';
                pipState.size = 'normal';
                resizeBtn.innerHTML = '⇱';
                resizeBtn.title = 'Ampliar';
                updateStatus('Video flotante reducido');
            }
        }
        
        function makePipDraggable() {
            const pipContainer = document.getElementById('pipContainer');
            let isDragging = false;
            let startX, startY, startLeft, startTop;
            
            pipContainer.addEventListener('mousedown', function(e) {
                // Solo permitir arrastre desde el área superior (no desde los botones)
                if (e.target.classList.contains('pip-control-btn')) return;
                
                isDragging = true;
                pipState.dragging = true;
                pipContainer.classList.add('dragging');
                
                startX = e.clientX;
                startY = e.clientY;
                startLeft = parseInt(window.getComputedStyle(pipContainer).left, 10);
                startTop = parseInt(window.getComputedStyle(pipContainer).top, 10);
                
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const newLeft = startLeft + (e.clientX - startX);
                const newTop = startTop + (e.clientY - startY);
                
                // Limitar al área visible de la ventana
                const maxLeft = window.innerWidth - pipContainer.offsetWidth;
                const maxTop = window.innerHeight - pipContainer.offsetHeight;
                
                pipContainer.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + 'px';
                pipContainer.style.top = Math.max(0, Math.min(newTop, maxTop)) + 'px';
                pipContainer.style.right = 'auto';
                pipContainer.style.bottom = 'auto';
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    pipState.dragging = false;
                    pipContainer.classList.remove('dragging');
                }
            });
        }

        // ===========================================
        // EVENTOS Y MONITOREO
        // ===========================================
        
        // Verificar audio cada 2 segundos
        setInterval(checkTabAudio, 2000);
        
        // ===========================================
        // CONTROLES DEL VIDEO FLOTANTE
        // ===========================================
        
        function pipVideoControl(action) {
            const sourceWebview = document.getElementById('webview-' + pipState.sourceTab);
            const pipVideo = document.getElementById('pipVideo');
            
            if (!sourceWebview) return;
            
            switch(action) {
                case 'playpause':
                    sourceWebview.executeJavaScript(`
                        const video = document.querySelector('video');
                        if (video) {
                            if (video.paused) {
                                video.play();
                                return false; // no pausado
                            } else {
                                video.pause();
                                return true; // pausado
                            }
                        }
                        return null;
                    `).then(isPaused => {
                        const playBtn = document.getElementById('pipPlayBtn');
                        if (isPaused !== null) {
                            playBtn.innerHTML = isPaused ? '▶️' : '⏸️';
                        }
                    });
                    break;
                    
                case 'mute':
                    sourceWebview.executeJavaScript(`
                        const video = document.querySelector('video');
                        if (video) {
                            video.muted = !video.muted;
                            return video.muted;
                        }
                        return null;
                    `).then(isMuted => {
                        const muteBtn = document.getElementById('pipMuteBtn');
                        if (isMuted !== null) {
                            muteBtn.innerHTML = isMuted ? '🔇' : '🔊';
                        }
                    });
                    break;
                    
                case 'previous':
                    // Para YouTube, ir al video anterior en la playlist
                    sourceWebview.executeJavaScript(`
                        const prevBtn = document.querySelector('.ytp-prev-button');
                        if (prevBtn) {
                            prevBtn.click();
                            return true;
                        }
                        return false;
                    `).then(success => {
                        if (success) updateStatus('⏮️ Video anterior');
                    });
                    break;
                    
                case 'next':
                    // Para YouTube, ir al siguiente video
                    sourceWebview.executeJavaScript(`
                        const nextBtn = document.querySelector('.ytp-next-button');
                        if (nextBtn) {
                            nextBtn.click();
                            return true;
                        }
                        return false;
                    `).then(success => {
                        if (success) updateStatus('⏭️ Siguiente video');
                    });
                    break;
            }
        }
        
        function startPipSync(tabId) {
            if (pipState.syncInterval) {
                clearInterval(pipState.syncInterval);
            }
            
            pipState.syncInterval = setInterval(() => {
                const sourceWebview = document.getElementById('webview-' + tabId);
                if (!sourceWebview || !pipState.active) {
                    clearInterval(pipState.syncInterval);
                    return;
                }
                
                // Sincronizar tiempo y estado
                sourceWebview.executeJavaScript(`
                    const video = document.querySelector('video');
                    if (video) {
                        return {
                            currentTime: video.currentTime,
                            duration: video.duration,
                            paused: video.paused,
                            muted: video.muted
                        };
                    }
                    return null;
                `).then(videoState => {
                    if (videoState) {
                        updatePipDisplay(videoState);
                    }
                }).catch(() => {
                    // Error silencioso
                });
            }, 1000);
        }
        
        function updatePipDisplay(videoState) {
            const timeDisplay = document.getElementById('pipTimeDisplay');
            const playBtn = document.getElementById('pipPlayBtn');
            const muteBtn = document.getElementById('pipMuteBtn');
            
            if (timeDisplay && videoState.duration) {
                const current = formatTime(videoState.currentTime);
                const total = formatTime(videoState.duration);
                timeDisplay.textContent = `${current} / ${total}`;
            }
            
            if (playBtn) {
                playBtn.innerHTML = videoState.paused ? '▶️' : '⏸️';
            }
            
            if (muteBtn) {
                muteBtn.innerHTML = videoState.muted ? '🔇' : '🔊';
            }
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Función SIMPLIFICADA para overlay de video
        function injectVideoOverlay() {
            console.log('=== INYECTANDO OVERLAY SIMPLIFICADO ===');
            
            const activeTab = tabs.find(tab => tab.isActive);
            if (!activeTab) return;
            
            const webview = document.getElementById('webview-' + activeTab.id);
            if (!webview?.src) return;
            
            const isYoutube = webview.src.includes('youtube.com') || webview.src.includes('youtu.be');
            console.log('Es YouTube:', isYoutube);
            
            if (isYoutube && !pipState.active) {
                webview.executeJavaScript(`
                    // OVERLAY ULTRA SIMPLE
                    const existing = document.getElementById('Neza-pip-overlay');
                    if (existing) existing.remove();
                    
                    const overlay = document.createElement('div');
                    overlay.id = 'Neza-pip-overlay';
                    overlay.innerHTML = '🎬 CLICK PARA VIDEO FLOTANTE';
                    overlay.style.cssText = \`
                        position: fixed !important;
                        top: 20px !important;
                        left: 50% !important;
                        transform: translateX(-50%) !important;
                        background: #FF0000 !important;
                        color: white !important;
                        padding: 20px !important;
                        font-size: 20px !important;
                        font-weight: bold !important;
                        z-index: 999999 !important;
                        cursor: pointer !important;
                        border-radius: 10px !important;
                    \`;
                    
                    overlay.onclick = () => {
                        console.log('OVERLAY CLICKEADO!');
                        overlay.innerHTML = 'ACTIVANDO...';
                        window.parent.postMessage('activate-pip', '*');
                        setTimeout(() => overlay.remove(), 2000);
                    };
                    
                    document.body.appendChild(overlay);
                    console.log('OVERLAY ROJO CREADO');
                    
                    setTimeout(() => overlay.remove(), 15000);
                `).catch(err => console.error('Error overlay:', err));
            }
        }
        
        // Escuchar mensajes del webview para activar PiP
        window.addEventListener('message', (event) => {
            console.log('Mensaje recibido:', event.data);
            if (event.data === 'activate-pip') {
                console.log('Activando PiP desde mensaje');
                startPictureInPicture();
            }
        });
        
        // Escuchar eventos personalizados
        document.addEventListener('Neza-pip-activate', (event) => {
            console.log('Evento PiP personalizado recibido:', event.detail);
            startPictureInPicture();
        });
        
        window.addEventListener('Neza-pip-activate', (event) => {
            console.log('Evento PiP personalizado en window:', event.detail);
            startPictureInPicture();
        });
        
        // Configurar listeners para webviews
        function setupWebviewListeners() {
            tabs.forEach(tab => {
                const webview = document.getElementById('webview-' + tab.id);
                if (webview && !webview.NezaListenersSetup) {
                    webview.NezaListenersSetup = true;
                    
                    webview.addEventListener('ipc-message', (event) => {
                        if (event.channel === 'activate-pip') {
                            console.log('PiP activado desde webview');
                            startPictureInPicture();
                        }
                    });
                    
                    webview.addEventListener('dom-ready', () => {
                        console.log('Webview DOM ready, inyectando overlay');
                        setTimeout(() => injectVideoOverlay(), 2000);
                    });
                }
            });
        }
        
        // Configurar listeners y overlay injection más frecuente
        setInterval(() => {
            setupWebviewListeners();
            injectVideoOverlay();
        }, 2000);
        
        // Inyección adicional al cambiar de página
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                setTimeout(() => {
                    injectVideoOverlay();
                }, 1000);
            }
        });
        
        // Atajo de teclado para video flotante (Ctrl+Shift+P)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                if (!pipState.active) {
                    startPictureInPicture();
                } else {
                    closePip();
                }
            }
        });

        // ===========================================
        // FUNCIÓN DE DEBUG Y VERIFICACIÓN
        // ===========================================
        
        function debugMultimedia() {
            console.log('=== DEBUG MULTIMEDIA Neza ===');
            
            // Verificar tabs activos
            const activeTab = tabs.find(t => t.isActive);
            console.log('Tab activo:', activeTab);
            
            if (activeTab) {
                const webview = document.getElementById('webview-' + activeTab.id);
                console.log('Webview encontrado:', !!webview);
                console.log('Webview src:', webview ? webview.src : 'N/A');
                
                // Verificar si es sitio de video
                const videoSites = ['youtube.com', 'youtu.be', 'twitch.tv', 'netflix.com', 'vimeo.com'];
                const isVideoSite = webview && videoSites.some(site => webview.src.includes(site));
                console.log('Es sitio de video:', isVideoSite);
                
                // Verificar estado del audio
                const tabElement = document.getElementById('tab-' + activeTab.id);
                const hasAudio = tabElement ? tabElement.classList.contains('has-audio') : false;
                console.log('Tiene audio detectado:', hasAudio);
                
                // Verificar botón de audio
                const audioButton = tabElement ? tabElement.querySelector('.tab-audio-button') : null;
                console.log('Botón de audio encontrado:', !!audioButton);
                
                if (webview && isVideoSite) {
                    console.log('Intentando inyectar overlay de video...');
                    injectVideoOverlay();
                }
            }
            
            console.log('Estado PiP:', pipState);
            console.log('=== FIN DEBUG ===');
        }
        
        // Atajo Ctrl+Shift+D para debug
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                debugMultimedia();
            }
            // Atajo Ctrl+Shift+V para forzar overlay de video
            if (e.ctrlKey && e.shiftKey && e.key === 'V') {
                e.preventDefault();
                console.log('Forzando overlay de video...');
                injectVideoOverlay();
                updateStatus('🎬 Overlay de video forzado - busca en la parte superior central');
            }
        });
        
        // ===========================================
        // FUNCIONES MULTIMEDIA CORREGIDAS Y FUNCIONALES
        // ===========================================
        
        // Función duplicada eliminada - usando la versión mejorada más abajo
        
        function injectVideoOverlaySimple() {
            try {
                console.log('🎬 === DIAGNOSTICO OVERLAY DE VIDEO ===');
                
                const activeTab = tabs.find(tab => tab.isActive);
                console.log('Tab activo encontrado:', !!activeTab, activeTab?.id);
                if (!activeTab) {
                    console.log('❌ No hay tab activo');
                    return;
                }
                
                const webview = document.getElementById('webview-' + activeTab.id);
                console.log('Webview encontrado:', !!webview);
                console.log('Webview src:', webview?.src);
                if (!webview || !webview.src) {
                    console.log('❌ No hay webview o src');
                    return;
                }            // Detectar sitios de video más agresivamente
            const currentUrl = webview.src.toLowerCase();
            const isYoutube = currentUrl.includes('youtube.com') || currentUrl.includes('youtu.be');
            const isVideoSite = isYoutube || 
                currentUrl.includes('netflix') || 
                currentUrl.includes('twitch') || 
                currentUrl.includes('vimeo') || 
                currentUrl.includes('video');
                
            console.log('🔍 URL actual:', currentUrl);
            console.log('🎥 Es YouTube:', isYoutube);
            console.log('🎬 Es sitio de video:', isVideoSite);
            console.log('🏁 PiP activo:', pipState.active);
            
            // Inyectar overlay en CUALQUIER sitio por ahora (para testing)
            if (true) { // Forzar para debugging
                console.log('✅ Forzando creación de overlay...');
                
                webview.executeJavaScript(`
                    (function() {
                        try {
                            console.log('Neza: Creando overlay test');
                            
                            // Remover overlay existente
                            var existing = document.getElementById('Neza-test-overlay');
                            if (existing) existing.remove();
                            
                            // Crear overlay súper simple
                            var overlay = document.createElement('div');
                            overlay.id = 'Neza-test-overlay';
                            overlay.innerHTML = 'Neza TEST';
                            overlay.setAttribute('style', 'position:fixed;top:50px;left:50px;background:red;color:white;padding:20px;z-index:999999;cursor:pointer;border:3px solid yellow;font-size:20px;font-weight:bold;');
                            
                            // Click simple
                            overlay.onclick = function() {
                                overlay.innerHTML = 'CLICKED!';
                                overlay.style.background = 'green';
                            };
                            
                            // Agregar al body
                            document.body.appendChild(overlay);
                            
                            // Auto-remover
                            setTimeout(function() {
                                if (overlay.parentNode) overlay.remove();
                            }, 20000);
                            
                            return 'OK';
                        } catch(e) {
                            return 'ERROR';
                        }
                    })();
                `).then(result => {
                    console.log('✅ RESULTADO OVERLAY:', result);
                    if (result === 'OK') {
                        updateStatus('🎬 ¡OVERLAY CREADO! Mira la esquina superior izquierda de la página');
                    } else if (result === 'ERROR') {
                        updateStatus('❌ Error creando overlay');
                        console.log('Intentando método alternativo...');
                        tryAlternativeOverlay(webview);
                    } else {
                        updateStatus('⚠️ Resultado inesperado: ' + result);
                    }
                }).catch(err => {
                    console.error('❌ Error ejecutando JavaScript:', err);
                    updateStatus('❌ Error: ' + err.message);
                    tryAlternativeOverlay(webview);
                });
            } else {
                console.log('No es YouTube o PiP ya activo');
            }
            } catch(error) {
                console.error('Error en injectVideoOverlaySimple:', error);
            }
        }
        
        // Método alternativo para crear overlay usando CSS
        function tryAlternativeOverlay(webview) {
            try {
                console.log('🔄 Probando método alternativo para overlay...');
                
                // Inyectar CSS primero
                webview.insertCSS(`
                    #Neza-alternative-overlay {
                        position: fixed !important;
                        top: 100px !important;
                        right: 100px !important;
                        background: #FF6600 !important;
                        color: white !important;
                        padding: 25px !important;
                        font-size: 22px !important;
                        font-weight: bold !important;
                        z-index: 2147483647 !important;
                        cursor: pointer !important;
                        border: 4px solid #FFD700 !important;
                        border-radius: 12px !important;
                        box-shadow: 0 0 20px rgba(255, 102, 0, 0.8) !important;
                        font-family: Arial, sans-serif !important;
                    }
                    #Neza-alternative-overlay:hover {
                        background: #FF8800 !important;
                        transform: scale(1.05) !important;
                    }
                `);
                
                // Luego inyectar el HTML
                setTimeout(() => {
                    webview.executeJavaScript(`
                        (function() {
                            try {
                                var existing = document.getElementById('Neza-alternative-overlay');
                                if (existing) existing.remove();
                                
                                var overlay = document.createElement('div');
                                overlay.id = 'Neza-alternative-overlay';
                                overlay.innerHTML = '🎬 VIDEO PIP 🎬';
                                
                                overlay.onclick = function() {
                                    overlay.innerHTML = '✅ ACTIVADO';
                                    overlay.style.background = '#00AA00';
                                    window.parent.postMessage('pip-test', '*');
                                };
                                
                                document.body.appendChild(overlay);
                                
                                setTimeout(function() {
                                    if (overlay.parentNode) overlay.remove();
                                }, 25000);
                                
                                return 'ALTERNATIVE_OK';
                            } catch(e) {
                                return 'ALTERNATIVE_ERROR';
                            }
                        })();
                    `).then(result => {
                        console.log('✅ Resultado método alternativo:', result);
                        if (result === 'ALTERNATIVE_OK') {
                            updateStatus('🎬 ¡Overlay alternativo creado! Mira la esquina superior derecha');
                        }
                    }).catch(err => {
                        console.error('❌ Error en método alternativo:', err);
                    });
                }, 500);
                
            } catch(error) {
                console.error('❌ Error en método alternativo:', error);
            }
        }
        
        // Escuchar mensajes de activación de PiP
        window.addEventListener('message', (event) => {
            console.log('� Mensaje recibido:', event.data);
            if (event.data === 'activate-pip') {
                console.log('🎬 Activando PiP desde overlay');
                startPictureInPicture();
            }
        });
        
        // Actualizar funciones de verificación
        function checkTabAudioSimple() {
            console.log('🔍 Verificando audio en pestañas...');
            
            tabs.forEach(tab => {
                if (!tab.isActive) return;
                
                const webview = document.getElementById('webview-' + tab.id);
                const tabElement = document.getElementById('tab-' + tab.id);
                
                if (webview && tabElement && webview.src) {
                    const audioSites = [
                        'youtube.com', 'youtu.be', 'music.youtube.com',
                        'twitch.tv', 'spotify.com', 'soundcloud.com',
                        'netflix.com', 'disney', 'hulu.com', 'prime', 'amazon',
                        'vimeo.com', 'dailymotion.com', 'facebook.com',
                        'instagram.com', 'tiktok.com', 'twitter.com', 'x.com',
                        'radio', 'podcast', 'music', 'audio', 'video'
                    ];
                    const hasAudio = audioSites.some(site => webview.src.toLowerCase().includes(site.toLowerCase()));
                    
                    if (hasAudio) {
                        tab.hasAudio = true;
                        tabElement.classList.add('has-audio');
                        console.log('✅ Audio detectado en tab:', tab.id);
                        
                        // Re-renderizar para mantener el estado visual
                        setTimeout(() => {
                            renderTabs();
                        }, 50);
                    } else {
                        tab.hasAudio = false;
                        tabElement.classList.remove('has-audio');
                    }
                }
            });
        }
        
        // Configurar intervalos para verificación y overlay (menos frecuente para evitar errores)
        setInterval(() => {
            try {
                checkTabAudioSimple();
                forceVisualStateUpdate(); // Forzar mantenimiento visual
                
                // SIEMPRE detectar música en todas las pestañas para el botón
                detectGlobalMusic();
                
                // Auto-actualizar panel si está abierto
                const overlay = document.getElementById('musicPanelOverlay');
                if (overlay && overlay.style.display !== 'none') {
                    detectCurrentMedia();
                }
            } catch(e) {
                console.error('Error en checkTabAudioSimple:', e);
            }
        }, 2000);
        
        // Función para detectar música globalmente (para el botón)
        function detectGlobalMusic() {
            let hasMusic = false;
            let musicTab = null;
            
            for (let tab of tabs) {
                const webview = document.getElementById('webview-' + tab.id);
                if (webview) {
                    webview.executeJavaScript(`
                        (function() {
                            const videos = document.querySelectorAll('video');
                            const audios = document.querySelectorAll('audio');
                            
                            for (let video of videos) {
                                if (!video.paused && !video.ended) return true;
                            }
                            
                            for (let audio of audios) {
                                if (!audio.paused && !audio.ended) return true;
                            }
                            
                            return false;
                        })();
                    `).then(result => {
                        if (result && !hasMusic) {
                            hasMusic = true;
                            musicTab = tab;
                            updateMusicControlButton(true, tab);
                        }
                    }).catch(e => {
                        // Silenciar errores
                    });
                }
            }
            
            // Si no hay música, resetear botón
            setTimeout(() => {
                if (!hasMusic) {
                    updateMusicControlButton(false, null);
                }
            }, 300);
        }
        
        // Video overlay solo se activa manualmente con Ctrl+Shift+V
        
        // Forzar estado visual cada 2 segundos para asegurar persistencia
        setInterval(() => {
            try {
                forceVisualStateUpdate();
            } catch(e) {
                console.error('Error en forceVisualStateUpdate:', e);
            }
        }, 2000);
        
        // Mensaje de bienvenida con instrucciones
        setTimeout(() => {
            updateStatus('¡Bienvenido a Neza Browser! 🚀 Atajos: Ctrl+Shift+M (panel música), Ctrl+Shift+G (ir a pestaña), Espacio (play/pause), Escape (cerrar)');
        }, 2000);
        
        // Función simplificada para listeners
        function setupWebviewEventListeners() {
            try {
                tabs.forEach(tab => {
                    const webview = document.getElementById('webview-' + tab.id);
                    if (webview && !webview.NezaListenersConfigured) {
                        webview.NezaListenersConfigured = true;
                        
                        // Solo cuando se carga completamente
                        webview.addEventListener('did-finish-load', () => {
                            setTimeout(() => {
                                try {
                                    checkTabAudioSimple();
                                } catch(e) {
                                    console.error('Error en event listener:', e);
                                }
                            }, 3000);
                        });
                    }
                });
            } catch(e) {
                console.error('Error configurando listeners:', e);
            }
        }
        
        // Ejecutar setup de listeners menos frecuente
        setInterval(setupWebviewEventListeners, 10000);
        
        // Atajos adicionales para testing
        document.addEventListener('keydown', function(e) {
            // Ctrl+Shift+V para forzar overlay de video
            if (e.ctrlKey && e.shiftKey && e.key === 'V') {
                e.preventDefault();
                console.log('🎬 Forzando inyección de overlay de video...');
                injectVideoOverlaySimple();
                updateStatus('🎬 Overlay de video forzado - revisa la página activa');
            }
            
            // Ctrl+Shift+O para test directo de overlay
            if (e.ctrlKey && e.shiftKey && e.key === 'O') {
                e.preventDefault();
                console.log('🔥 Test directo de overlay...');
                const activeTab = tabs.find(tab => tab.isActive);
                if (activeTab) {
                    const webview = document.getElementById('webview-' + activeTab.id);
                    if (webview) {
                        tryAlternativeOverlay(webview);
                    }
                }
                updateStatus('🔥 Test de overlay ejecutado - Ctrl+Shift+O');
            }
            
            // Ctrl+Shift+A para probar audio
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                console.log('🔊 Forzando detección de audio...');
                checkTabAudioSimple();
                updateStatus('🔊 Detección de audio forzada');
            }

            // ============ MUSIC PANEL SHORTCUTS ============
            // Ctrl+Shift+M para abrir/cerrar panel de música
            if (e.ctrlKey && e.shiftKey && e.key === 'M') {
                e.preventDefault();
                toggleMusicPanel();
            }

            // Espacio para Play/Pause (solo si el panel está abierto)
            if (e.code === 'Space') {
                const overlay = document.getElementById('musicPanelOverlay');
                if (overlay && overlay.style.display !== 'none') {
                    e.preventDefault();
                    togglePlayPause();
                }
            }

            // Ctrl+Shift+P para Play/Pause forzado
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                togglePlayPause();
                updateStatus('🎵 Play/Pause manual');
            }

            // Ctrl+Shift+Left para pista anterior
            if (e.ctrlKey && e.shiftKey && e.key === 'ArrowLeft') {
                e.preventDefault();
                previousTrack();
            }

            // Ctrl+Shift+Right para pista siguiente
            if (e.ctrlKey && e.shiftKey && e.key === 'ArrowRight') {
                e.preventDefault();
                nextTrack();
            }

            // Escape para cerrar panel de música
            if (e.key === 'Escape') {
                const overlay = document.getElementById('musicPanelOverlay');
                if (overlay && overlay.style.display !== 'none') {
                    e.preventDefault();
                    closeMusicPanel();
                }
            }

            // Ctrl+Shift+G para ir rápidamente a pestaña con música
            if (e.ctrlKey && e.shiftKey && e.key === 'G') {
                e.preventDefault();
                if (currentMediaInfo.mediaTab && currentMediaInfo.mediaTab.id) {
                    const activeTab = tabs.find(tab => tab.isActive);
                    if (activeTab && currentMediaInfo.mediaTab.id !== activeTab.id) {
                        goToMusicTab();
                    } else {
                        updateStatus('🎵 Ya estás en la pestaña con música');
                    }
                } else {
                    updateStatus('❌ No hay música reproduciéndose en ninguna pestaña');
                }
            }
            
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                e.preventDefault();
                console.log('🧪 Test manual activado');
                checkTabAudioSimple();
                injectVideoOverlaySimple();
                updateStatus('🧪 Test manual ejecutado - ve la consola');
            }
        });
        
        // Función de inicialización para asegurar propiedades de audio en pestañas existentes
        function initializeTabAudioProperties() {
            tabs.forEach(tab => {
                if (tab.hasAudio === undefined) tab.hasAudio = false;
                if (tab.isMuted === undefined) tab.isMuted = false;
            });
        }
        
        // Función para forzar el mantenimiento del estado visual
        function forceVisualStateUpdate() {
            tabs.forEach(tab => {
                const tabElement = document.getElementById('tab-' + tab.id);
                if (tabElement && tab.hasAudio) {
                    // Forzar clases CSS
                    tabElement.classList.add('has-audio');
                    
                    if (tab.isMuted) {
                        tabElement.classList.add('audio-muted');
                        
                        // Asegurar que el botón tenga el ícono correcto
                        const audioButton = tabElement.querySelector('.tab-audio-button');
                        if (audioButton) {
                            audioButton.innerHTML = '🔇';
                            audioButton.title = 'Audio silenciado - Clic para activar';
                        }
                        
                        console.log('🔇 Estado visual forzado para tab silenciado:', tab.id);
                    } else {
                        tabElement.classList.remove('audio-muted');
                        
                        const audioButton = tabElement.querySelector('.tab-audio-button');
                        if (audioButton) {
                            audioButton.innerHTML = '🔊';
                            audioButton.title = 'Audio activo - Clic para silenciar';
                        }
                    }
                }
            });
        }
        
        // Ejecutar inicialización al cargar
        document.addEventListener('DOMContentLoaded', () => {
            initializeTabAudioProperties();
            renderTabs();
            setupMediaProgressClick();
            setupMusicPanelEvents();
            updateSearchEngineUI();
            setupSettingsEvents();  // Configurar eventos del panel de settings
            setupSupportPanelEvents();  // Configurar eventos de los paneles de soporte
            setupZoomWheelControl();     // Configurar control de zoom con rueda del ratón
            setupFullscreenListeners();  // Configurar listeners de pantalla completa
            
            // Inicializar homepage hermosa
            const homepageInput = document.getElementById('homepageSearchInput');
            if (homepageInput) {
                homepageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performHomepageSearch();
                    }
                });
                
                // Enfocar automáticamente
                setTimeout(() => homepageInput.focus(), 100);
            }

            // Crear efectos visuales de la homepage
            setTimeout(() => {
                createHomepageParticles();
                animateHomepageStats();
            }, 500);
            
            // Detectar si se está iniciando en modo Stealth
            checkStealthModeParameters();
            
            // ===== LISTENERS DE ELECTRON API =====
            // Escuchar evento para abrir URLs en pestañas nuevas (en lugar de ventanas)
            if (typeof window.electronAPI !== 'undefined' && window.electronAPI.onOpenUrlInNewTab) {
                window.electronAPI.onOpenUrlInNewTab((event, url) => {
                    console.log('🔗 Abriendo URL en nueva pestaña:', url);
                    // Crear nueva pestaña con la URL
                    createNewTab(url);
                    updateStatus(`🔗 Abriendo: ${new URL(url).hostname}`);
                });
            }
            
            // Escuchar notificación de actualización disponible
            if (typeof window.electronAPI !== 'undefined' && window.electronAPI.onUpdateAvailableNotification) {
                window.electronAPI.onUpdateAvailableNotification((event, data) => {
                    console.log('🎉 Actualización disponible:', data.version);
                    showNotification(`🎉 Nueva versión ${data.version} disponible`, 'Se está verificando la actualización...', 5000);
                });
            }
        });
        
        // También ejecutar después de un breve delay para asegurar
        setTimeout(() => {
            initializeTabAudioProperties();
            renderTabs();
        }, 1000);

        // ============ SETTINGS EVENT HANDLERS ============
        
        function setupSettingsEvents() {
            console.log('⚙️ Configurando eventos del panel de settings');
            
            // Event listeners para los toggles de configuración
            const setupToggle = (id, callback) => {
                const toggle = document.getElementById(id);
                if (toggle) {
                    toggle.addEventListener('change', function() {
                        console.log(`⚙️ Toggle ${id}:`, this.checked);
                        if (callback) callback(this.checked);
                        saveSettingsToLocalStorage();
                    });
                }
            };

            // Configurar todos los toggles
            setupToggle('showSidebar', (checked) => {
                updateStatus(checked ? '📂 Barra lateral activada' : '📂 Barra lateral desactivada');
            });

            setupToggle('showHomeButton', (checked) => {
                updateStatus(checked ? '🏠 Botón de inicio activado' : '🏠 Botón de inicio desactivado');
            });

            setupToggle('askWhereToSave', (checked) => {
                updateStatus(checked ? '💾 Se preguntará dónde guardar' : '💾 Descarga automática activada');
            });

            setupToggle('continueWhereLeftOff', (checked) => {
                updateStatus(checked ? '🔄 Continuidad activada' : '🔄 Pestañas nuevas al iniciar');
            });

            setupToggle('guardianMode', (checked) => {
                updateStatus(checked ? '🛡️ Guardian Mode activado' : '🛡️ Guardian Mode desactivado');
            });

            setupToggle('adBlocker', (checked) => {
                updateStatus(checked ? '🚫 Bloqueador de anuncios activado' : '🚫 Bloqueador de anuncios desactivado');
            });

            setupToggle('antiTracking', (checked) => {
                updateStatus(checked ? '🔒 Protección anti-seguimiento activada' : '🔒 Protección anti-seguimiento desactivada');
            });

            setupToggle('autoCleanOnExit', (checked) => {
                updateStatus(checked ? '🧹 Limpieza automática al salir activada' : '🧹 Limpieza automática desactivada');
            });

            // Event listeners para selects y inputs
            const searchEngine = document.getElementById('searchEngine');
            if (searchEngine) {
                searchEngine.addEventListener('change', function() {
                    console.log('🔍 Motor de búsqueda cambiado a:', this.value);
                    updateStatus('🔍 Motor de búsqueda: ' + this.options[this.selectedIndex].text);
                    saveSettingsToLocalStorage();
                });
            }

            const homepage = document.getElementById('homepage');
            if (homepage) {
                homepage.addEventListener('change', function() {
                    console.log('🏠 Página de inicio cambiada a:', this.value);
                    updateStatus('🏠 Página de inicio actualizada');
                    saveSettingsToLocalStorage();
                });
            }

            const language = document.getElementById('language');
            if (language) {
                language.addEventListener('change', function() {
                    console.log('🌐 Idioma cambiado a:', this.value);
                    updateStatus('🌐 Idioma: ' + this.options[this.selectedIndex].text);
                    saveSettingsToLocalStorage();
                });
            }

            // Cargar configuraciones guardadas
            loadSettingsFromLocalStorage();
        }

        function saveSettingsToLocalStorage() {
            try {
                const settings = {
                    searchEngine: document.getElementById('searchEngine')?.value || 'google',
                    homepage: document.getElementById('homepage')?.value || 'Neza.com',
                    language: document.getElementById('language')?.value || 'es',
                    showSidebar: document.getElementById('showSidebar')?.checked || true,
                    showHomeButton: document.getElementById('showHomeButton')?.checked || false,
                    askWhereToSave: document.getElementById('askWhereToSave')?.checked || true,
                    continueWhereLeftOff: document.getElementById('continueWhereLeftOff')?.checked || true,
                    guardianMode: document.getElementById('guardianMode')?.checked || true,
                    adBlocker: document.getElementById('adBlocker')?.checked || true,
                    antiTracking: document.getElementById('antiTracking')?.checked || true,
                    autoCleanOnExit: document.getElementById('autoCleanOnExit')?.checked || false
                };
                
                localStorage.setItem('NezaSettings', JSON.stringify(settings));
                console.log('💾 Configuraciones guardadas:', settings);
            } catch (error) {
                console.error('❌ Error guardando configuraciones:', error);
            }
        }

        function loadSettingsFromLocalStorage() {
            try {
                const savedSettings = localStorage.getItem('NezaSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    console.log('📥 Cargando configuraciones guardadas:', settings);
                    
                    // Aplicar configuraciones guardadas
                    Object.keys(settings).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = settings[key];
                            } else {
                                element.value = settings[key];
                            }
                        }
                    });
                    
                    updateStatus('⚙️ Configuraciones cargadas');
                }
            } catch (error) {
                console.error('❌ Error cargando configuraciones:', error);
            }
        }

        // ============ SUPPORT PANEL EVENT HANDLERS ============
        
        function setupSupportPanelEvents() {
            console.log('🆘 Configurando eventos de los paneles de soporte');
            
            // Event listeners para cerrar paneles al hacer click en el overlay
            const supportOverlay = document.getElementById('supportPanelOverlay');
            if (supportOverlay) {
                supportOverlay.addEventListener('click', function(e) {
                    // Solo cerrar si el click es en el overlay, no en el contenido del panel
                    if (e.target === supportOverlay) {
                        closeSupportPanel();
                    }
                });
            }
            
            const feedbackOverlay = document.getElementById('feedbackPanelOverlay');
            if (feedbackOverlay) {
                feedbackOverlay.addEventListener('click', function(e) {
                    // Solo cerrar si el click es en el overlay, no en el contenido del panel
                    if (e.target === feedbackOverlay) {
                        closeFeedbackPanel();
                    }
                });
            }
            
            // Event listener para la tecla Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // Cerrar panel de feedback si está abierto
                    const feedbackPanel = document.getElementById('feedbackPanelOverlay');
                    if (feedbackPanel && feedbackPanel.classList.contains('show')) {
                        closeFeedbackPanel();
                        return;
                    }
                    
                    // Cerrar panel de soporte si está abierto
                    const supportPanel = document.getElementById('supportPanelOverlay');
                    if (supportPanel && supportPanel.classList.contains('show')) {
                        closeSupportPanel();
                        return;
                    }
                }
            });
            
            // Prevenir que los formularios de feedback se envíen con Enter accidentalmente
            const feedbackForm = document.querySelector('#feedbackPanelOverlay form');
            if (feedbackForm) {
                feedbackForm.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                        e.preventDefault();
                    }
                });
            }
            
            // Auto-resize para el textarea de descripción
            const feedbackDescription = document.getElementById('feedbackDescription');
            if (feedbackDescription) {
                feedbackDescription.addEventListener('input', function() {
                    // Auto-resize del textarea
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
            }
            
            console.log('✅ Eventos de paneles de soporte configurados');
        }

        // ============ SISTEMA DE MÚSICA SIMPLIFICADO ============
        
        function initializeMusicDetection() {
            console.log('🎵 Iniciando sistema de detección de música...');
            
            // Verificar audio cada 3 segundos
            setInterval(() => {
                detectAudioInAllTabs();
            }, 3000);
        }
        
        function detectAudioInAllTabs() {
            tabs.forEach(tab => {
                if (tab.webview && tab.url && (tab.url.includes('youtube.com') || tab.url.includes('spotify.com') || tab.url.includes('soundcloud.com'))) {
                    // Solo verificar si realmente hay contenido multimedia, no marcar automáticamente
                    const webview = document.getElementById('webview-' + tab.id);
                    if (webview) {
                        webview.executeJavaScript(`
                            (function() {
                                const videos = document.querySelectorAll('video');
                                const audios = document.querySelectorAll('audio');
                                let hasActiveMedia = false;
                                
                                // Verificar si hay contenido multimedia real
                                for (let video of videos) {
                                    if (video.duration > 0 || video.currentTime > 0 || !video.paused) {
                                        hasActiveMedia = true;
                                        break;
                                    }
                                }
                                
                                if (!hasActiveMedia) {
                                    for (let audio of audios) {
                                        if (audio.duration > 0 || audio.currentTime > 0 || !audio.paused) {
                                            hasActiveMedia = true;
                                            break;
                                        }
                                    }
                                }
                                
                                return hasActiveMedia;
                            })();
                        `).then(hasMedia => {
                            if (hasMedia && !tab.hasAudio) {
                                tab.hasAudio = true;
                                tab.isMuted = false; // Por defecto NO está silenciado
                                renderTabs(); // Re-renderizar para mostrar la nueva UI
                                console.log('🎵 Audio real detectado en:', tab.title);
                            }
                        }).catch(e => {
                            // Silenciar errores de detección
                        });
                    }
                }
            });
        }
        
        function updateTabAudioUI(tab) {
            // Esta función ahora solo actualiza las clases CSS, no colores directos
            const tabElement = document.querySelector(`[onclick*="switchToTab(${tab.id})"]`);
            if (tabElement) {
                // Remover estilos directos y usar solo clases CSS
                tabElement.style.backgroundColor = '';
                tabElement.style.color = '';
                
                // Actualizar clases CSS
                tabElement.classList.toggle('has-audio', tab.hasAudio);
                tabElement.classList.toggle('audio-muted', tab.isMuted);
            }
        }
        
        // Función simple para silenciar/activar audio de pestaña
        function toggleTabAudioSimple(tabId, event) {
            if (event) event.stopPropagation();
            
            console.log('🔇 Toggle RÁPIDO audio pestaña:', tabId);
            
            const tab = tabs.find(t => t.id === tabId);
            const webview = document.getElementById('webview-' + tabId);
            
            if (tab && webview) {
                // PREVENIR CLICS MÚLTIPLES RÁPIDOS
                const now = Date.now();
                if (tab.lastAudioToggle && (now - tab.lastAudioToggle) < 300) {
                    console.log('⚡ Clic demasiado rápido, ignorando...');
                    return;
                }
                tab.lastAudioToggle = now;
                
                const newMutedState = !tab.isMuted;
                console.log('🎵 Cambio INMEDIATO a:', newMutedState ? 'MUTED' : 'UNMUTED');
                
                // ACTUALIZAR INTERFAZ INMEDIATAMENTE (sin esperar)
                tab.isMuted = newMutedState;
                updateTabAudioUI(tab);
                updateStatus(`${newMutedState ? '🔇' : '🔊'} ${newMutedState ? 'SILENCIANDO...' : 'ACTIVANDO...'}`);
                renderTabs();
                
                // MÉTODO OPTIMIZADO: Control rápido de volumen
                webview.executeJavaScript(`
                    (function() {
                        console.log('⚡ CONTROL RÁPIDO - Estado:', ${newMutedState});
                        var success = false;
                        var methods = [];
                        var elementsFound = 0;
                        
                        // CONTROL DIRECTO Y RÁPIDO de videos
                        var videos = document.querySelectorAll('video');
                        for (var i = 0; i < videos.length; i++) {
                            var video = videos[i];
                            try {
                                // Aplicar inmediatamente
                                video.muted = ${newMutedState};
                                video.volume = ${newMutedState} ? 0 : 1;
                                
                                methods.push('video_' + i);
                                elementsFound++;
                                success = true;
                            } catch(e) {
                                console.log('Error video', i, ':', e);
                            }
                        }
                        
                        // CONTROL DIRECTO Y RÁPIDO de audios
                        var audios = document.querySelectorAll('audio');
                        for (var i = 0; i < audios.length; i++) {
                            var audio = audios[i];
                            try {
                                // Aplicar inmediatamente
                                audio.muted = ${newMutedState};
                                audio.volume = ${newMutedState} ? 0 : 1;
                                
                                methods.push('audio_' + i);
                                elementsFound++;
                                success = true;
                            } catch(e) {
                                console.log('Error audio', i, ':', e);
                            }
                        }
                        
                        // YouTube RÁPIDO - botón mute directo
                        try {
                            var muteBtn = document.querySelector('.ytp-mute-button');
                            if (muteBtn) {
                                // Aplicar directamente sin verificar estado actual
                                muteBtn.click();
                                methods.push('youtube_mute');
                                success = true;
                            }
                        } catch(e) {
                            // Silencioso - no importa si falla
                        }
                        
                        // Retorno rápido y simple
                        return { 
                            success: success, 
                            methods: methods, 
                            elementsFound: elementsFound
                        };
                    })();
                `).then(result => {
                    console.log('⚡ Control RÁPIDO completado:', result.elementsFound, 'elementos');
                    
                    // Actualización final del estado (ya se hizo arriba inmediatamente)
                    updateStatus(`${newMutedState ? '🔇 SILENCIADO' : '🔊 ACTIVADO'} (${result.elementsFound})`);
                }).catch(err => {
                    console.error('❌ Error control rápido:', err);
                    // Mantener el estado visual aunque falle el JavaScript
                });
            } else {
                console.log('❌ Tab o webview no encontrados');
            }
        }
        
        // ============ STEALTH MODE AUTO-DETECTION ============
        
        function checkStealthModeParameters() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const stealthLayer = urlParams.get('stealth');
                const sessionType = urlParams.get('session');
                
                // Si hay configuración automática de stealth mode
                if (window.stealthAutoConfig && window.stealthAutoConfig.autoStart) {
                    console.log('🕶️ Auto-iniciando Stealth Mode desde ventana:', window.stealthAutoConfig);
                    
                    const layer = window.stealthAutoConfig.layer || 3;
                    
                    // Mostrar indicador visual de stealth mode
                    showStealthWindowIndicator(layer);
                    
                    // Crear pestaña stealth automáticamente
                    setTimeout(() => {
                        createStealthTab(layer);
                        updateStatus(`👻 ${getLayerName(layer)} - Ventana Privada Iniciada`);
                    }, 1000);
                    
                } else if (stealthLayer) {
                    console.log('🕶️ Parámetro Stealth detectado en URL:', stealthLayer);
                    
                    const layer = parseInt(stealthLayer) || 3;
                    
                    // Mostrar confirmación de stealth mode
                    setTimeout(() => {
                        if (confirm(`🕶️ Neza Stealth Mode\n\n¿Iniciar ${getLayerName(layer)} en esta ventana?\n\nEsta ventana se configurará como privada automáticamente.`)) {
                            createStealthTab(layer);
                            showStealthWindowIndicator(layer);
                            updateStatus(`👻 ${getLayerName(layer)} - Iniciado desde URL`);
                        }
                    }, 500);
                }
                
            } catch (error) {
                console.error('❌ Error detectando parámetros Stealth:', error);
            }
        }
        
        function showStealthWindowIndicator(layer) {
            // Modificar título de la ventana
            document.title = `👻 Neza Stealth - ${getLayerName(layer)}`;
            
            // Agregar indicador visual en la barra de título
            const titleBar = document.querySelector('.title-bar');
            if (titleBar && !titleBar.querySelector('.stealth-window-indicator')) {
                const indicator = document.createElement('div');
                indicator.className = 'stealth-window-indicator';
                indicator.innerHTML = `
                    <span style="
                        background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
                        color: #00D4AA;
                        padding: 2px 8px;
                        border-radius: 10px;
                        font-size: 10px;
                        font-weight: bold;
                        border: 1px solid #00D4AA;
                        box-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
                        animation: stealthGlow 2s ease-in-out infinite alternate;
                    ">👻 STEALTH</span>
                `;
                
                // Agregar animación CSS si no existe
                if (!document.querySelector('#stealthIndicatorStyle')) {
                    const style = document.createElement('style');
                    style.id = 'stealthIndicatorStyle';
                    style.textContent = `
                        @keyframes stealthGlow {
                            0% { box-shadow: 0 0 5px rgba(0, 212, 170, 0.3); }
                            100% { box-shadow: 0 0 15px rgba(0, 212, 170, 0.6); }
                        }
                        .stealth-window-indicator {
                            position: absolute;
                            top: 5px;
                            right: 120px;
                            z-index: 1000;
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                titleBar.appendChild(indicator);
            }
            
            // Cambiar favicon si es posible
            try {
                const favicon = document.querySelector('link[rel="icon"]') || document.createElement('link');
                favicon.rel = 'icon';
                favicon.href = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><text y="24" font-size="24">👻</text></svg>';
                if (!document.querySelector('link[rel="icon"]')) {
                    document.head.appendChild(favicon);
                }
            } catch (e) {
                console.log('ℹ️ No se pudo cambiar el favicon');
            }
        }
        
        // ============ WINDOW MANAGEMENT HELPERS ============
        
        function handleWindowClose() {
            // Si es ventana stealth, confirmar cierre
            if (document.title.includes('Stealth')) {
                return confirm('👻 ¿Cerrar ventana Stealth?\n\nTodos los datos de navegación privada se eliminarán.');
            }
            return true;
        }
        
        function setupWindowEventListeners() {
            // Manejar cierre de ventana
            window.addEventListener('beforeunload', (event) => {
                if (!handleWindowClose()) {
                    event.preventDefault();
                    event.returnValue = '';
                }
            });
            
            // Detectar cuando la ventana pierde el foco (para Stealth Mode)
            window.addEventListener('blur', () => {
                if (document.title.includes('Stealth')) {
                    console.log('👻 Ventana Stealth perdió foco - Modo paranoid activo');
                }
            });
            
            // Detectar cuando la ventana gana el foco
            window.addEventListener('focus', () => {
                if (document.title.includes('Stealth')) {
                    console.log('👻 Ventana Stealth ganó foco');
                }
            });
        }
        
        // Inicializar listeners de ventana
        setTimeout(() => {
            setupWindowEventListeners();
            setupUpdateListeners();
        }, 1000);

        // Sistema de actualizaciones automáticas
        function setupUpdateListeners() {
            if (typeof window.electronAPI !== 'undefined') {
                // Eventos de actualización
                window.electronAPI.onUpdateChecking(() => {
                    showUpdateNotification('🔄 Verificando actualizaciones...', 'info');
                });

                window.electronAPI.onUpdateAvailable((event, info) => {
                    console.log('Update available:', info);
                    showUpdateAvailableDialog(info);
                });

                window.electronAPI.onUpdateNotAvailable(() => {
                    showUpdateNotification('✅ Neza Browser está actualizado', 'success', 3000);
                });

                window.electronAPI.onUpdateError((event, error) => {
                    console.error('Update error:', error);
                    showUpdateNotification('❌ Error al verificar actualizaciones', 'error');
                });

                window.electronAPI.onUpdateProgress((event, progress) => {
                    updateDownloadProgress(progress);
                });

                window.electronAPI.onUpdateDownloaded((event, info) => {
                    showUpdateReadyDialog(info);
                });

                window.electronAPI.onUpdateDownloading(() => {
                    showUpdateNotification('⬇️ Descargando actualización...', 'info');
                });
            }
        }

        function showUpdateAvailableDialog(info) {
            const modal = document.createElement('div');
            modal.className = 'update-modal-overlay';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease-out;
            `;

            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                    border: 2px solid #00D4AA;
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0, 212, 170, 0.3);
                    color: white;
                    text-align: center;
                    position: relative;
                ">
                    <div style="font-size: 48px; margin-bottom: 20px;">🚀</div>
                    <h2 style="color: #00D4AA; margin-bottom: 15px; font-size: 24px;">
                        ¡Nueva Actualización Disponible!
                    </h2>
                    <p style="margin-bottom: 20px; font-size: 16px; line-height: 1.5;">
                        <strong>Versión ${info.version}</strong><br>
                        Una nueva versión de Neza Browser está lista para descargar.
                    </p>
                    <div style="background: rgba(0, 212, 170, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 25px; text-align: left; font-size: 14px;">
                        <strong>🆕 Nuevas características:</strong><br>
                        ${info.releaseNotes ? info.releaseNotes.substring(0, 200) + '...' : '• Mejoras de rendimiento<br>• Corrección de errores<br>• Nuevas funcionalidades'}
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="downloadUpdate()" style="
                            background: linear-gradient(135deg, #00D4AA 0%, #00A8FF 100%);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 25px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: transform 0.2s;
                            font-size: 14px;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ⬇️ Descargar Ahora
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            background: transparent;
                            color: #888;
                            border: 1px solid #444;
                            padding: 12px 24px;
                            border-radius: 25px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                            font-size: 14px;
                        " onmouseover="this.style.borderColor='#666'; this.style.color='#aaa'" onmouseout="this.style.borderColor='#444'; this.style.color='#888'">
                            Más Tarde
                        </button>
                        <button onclick="viewChangelog()" style="
                            background: transparent;
                            color: #00D4AA;
                            border: 1px solid #00D4AA;
                            padding: 12px 24px;
                            border-radius: 25px;
                            font-weight: 600;
                            cursor: pointer;
                            font-size: 14px;
                        ">
                            📋 Ver Cambios
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Funciones del modal
            window.downloadUpdate = function() {
                modal.remove();
                window.electronAPI.downloadUpdate();
                showUpdateNotification('⬇️ Descargando actualización en segundo plano...', 'info');
            };

            window.viewChangelog = function() {
                window.electronAPI.openExternal('https://github.com/H1C0d3/NezaBrowser/releases');
            };
        }

        function updateDownloadProgress(progress) {
            let progressBar = document.getElementById('updateProgressBar');
            if (!progressBar) {
                // Crear barra de progreso
                progressBar = document.createElement('div');
                progressBar.id = 'updateProgressBar';
                progressBar.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: ${progress.percent}%;
                    height: 3px;
                    background: linear-gradient(90deg, #00D4AA, #00A8FF);
                    z-index: 10002;
                    transition: width 0.3s ease;
                    box-shadow: 0 0 10px rgba(0, 212, 170, 0.5);
                `;
                document.body.appendChild(progressBar);
                
                showUpdateNotification(
                    `⬇️ Descargando... ${progress.percent}% (${Math.round(progress.transferred / 1024 / 1024)}MB / ${Math.round(progress.total / 1024 / 1024)}MB)`, 
                    'info', 
                    1000
                );
            } else {
                progressBar.style.width = progress.percent + '%';
                
                // Actualizar notificación cada 10%
                if (progress.percent % 10 === 0) {
                    showUpdateNotification(
                        `⬇️ Descarga en progreso: ${progress.percent}%`, 
                        'info', 
                        2000
                    );
                }
            }

            // Remover barra cuando termine
            if (progress.percent >= 100) {
                setTimeout(() => {
                    if (progressBar) progressBar.remove();
                }, 1000);
            }
        }

        function showUpdateReadyDialog(info) {
            const modal = document.createElement('div');
            modal.className = 'update-ready-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(15px);
                z-index: 10003;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease-out;
            `;

            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #0f0f3d 0%, #1a1a2e 100%);
                    border: 2px solid #00D4AA;
                    border-radius: 25px;
                    padding: 40px;
                    max-width: 450px;
                    width: 90%;
                    box-shadow: 0 25px 80px rgba(0, 212, 170, 0.4);
                    color: white;
                    text-align: center;
                    position: relative;
                ">
                    <div style="font-size: 64px; margin-bottom: 25px; animation: bounce 1s infinite;">🎉</div>
                    <h2 style="color: #00D4AA; margin-bottom: 15px; font-size: 26px;">
                        ¡Actualización Lista!
                    </h2>
                    <p style="margin-bottom: 25px; font-size: 16px; line-height: 1.6;">
                        <strong>Neza Browser ${info.version}</strong> se ha descargado correctamente.<br>
                        <span style="opacity: 0.8;">La actualización se aplicará al reiniciar la aplicación.</span>
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="installNow()" style="
                            background: linear-gradient(135deg, #00D4AA 0%, #00A8FF 100%);
                            color: white;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 30px;
                            font-weight: 700;
                            cursor: pointer;
                            transition: transform 0.2s;
                            font-size: 16px;
                            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.3);
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            🔄 Reiniciar Ahora
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            background: transparent;
                            color: #888;
                            border: 1px solid #444;
                            padding: 15px 30px;
                            border-radius: 30px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s;
                            font-size: 16px;
                        " onmouseover="this.style.borderColor='#666'; this.style.color='#aaa'" onmouseout="this.style.borderColor='#444'; this.style.color='#888'">
                            Más Tarde
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            window.installNow = function() {
                window.electronAPI.installUpdate();
            };

            // Agregar animación bounce
            if (!document.getElementById('bounceAnimation')) {
                const style = document.createElement('style');
                style.id = 'bounceAnimation';
                style.textContent = `
                    @keyframes bounce {
                        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                        40% { transform: translateY(-10px); }
                        60% { transform: translateY(-5px); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Función para configurar eventos de click
        function setupClickEvents() {
            console.log('🖱️ Configurando eventos de click...');
            
            // FORZAR EVENTOS DE CLICK CON MÚLTIPLES MÉTODOS
            
            // Método 1: Event listeners directos
            setTimeout(() => {
                // Barra de direcciones
                const addressInput = document.getElementById('addressInput');
                if (addressInput) {
                    // Remover listener anterior si existe
                    addressInput.removeEventListener('keypress', handleAddressInput);
                    addressInput.addEventListener('keypress', handleAddressInput);
                    console.log('✅ Event listener agregado a barra de direcciones');
                }
                
                // Botones de navegación
                const backBtn = document.getElementById('backBtn');
                if (backBtn) {
                    backBtn.removeEventListener('click', goBack);
                    backBtn.addEventListener('click', goBack);
                    console.log('✅ Event listener agregado al botón Atrás');
                }
                
                const forwardBtn = document.getElementById('forwardBtn');
                if (forwardBtn) {
                    forwardBtn.removeEventListener('click', goForward);
                    forwardBtn.addEventListener('click', goForward);
                    console.log('✅ Event listener agregado al botón Adelante');
                }
                
                // Método 2: Accesos rápidos con múltiples handlers
                document.querySelectorAll('.homepage-shortcut-card').forEach((card, index) => {
                    // Remover listeners anteriores
                    card.removeEventListener('click', card._clickHandler);
                    
                    // Crear handler personalizado
                    card._clickHandler = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const onclick = this.getAttribute('onclick');
                        console.log('🖱️ Click detectado en acceso rápido:', onclick);
                        
                        if (onclick && onclick.includes('navigate(')) {
                            const urlMatch = onclick.match(/'([^']+)'/);
                            if (urlMatch) {
                                console.log('🚀 Navegando a:', urlMatch[1]);
                                navigate(urlMatch[1]);
                            }
                        } else if (onclick && onclick.includes('testBrowserNavigation')) {
                            console.log('🔧 Ejecutando test de navegación');
                            testBrowserNavigation();
                        }
                    };
                    
                    // Agregar múltiples eventos
                    card.addEventListener('click', card._clickHandler);
                    card.addEventListener('mousedown', card._clickHandler);
                    
                    // Método 3: Forzar propiedades CSS
                    card.style.pointerEvents = 'auto';
                    card.style.cursor = 'pointer';
                    card.style.userSelect = 'none';
                });
                
                console.log('✅ Eventos de click configurados con múltiples métodos');
                
            }, 500);
            
            // Método 4: Event delegation en el documento
            document.addEventListener('click', function(e) {
                const target = e.target.closest('.homepage-shortcut-card');
                if (target) {
                    console.log('🖱️ Click delegation detectado en acceso rápido');
                    const onclick = target.getAttribute('onclick');
                    if (onclick && onclick.includes('navigate(')) {
                        e.preventDefault();
                        const urlMatch = onclick.match(/'([^']+)'/);
                        if (urlMatch) {
                            console.log('🚀 Navegando via delegation:', urlMatch[1]);
                            navigate(urlMatch[1]);
                        }
                    }
                }
            });
        }
        
        // Handler para barra de direcciones
        function handleAddressInput(e) {
            if (e.key === 'Enter') {
                const url = this.value.trim();
                if (url) {
                    console.log('🔍 Navegando desde barra de direcciones:', url);
                    navigate(url);
                }
            }
        }
        
        // Función para forzar que los controles sean clickeables
        function forceControlsClickable() {
            const elements = [
                '.homepage-shortcut-card',
                '.nav-button',
                '.tab',
                '.new-tab-button',
                '.control-button'
            ];
            
            elements.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    el.style.pointerEvents = 'auto';
                    el.style.cursor = 'pointer';
                });
            });
        }

        // Función de prueba de navegación
        function testBrowserNavigation() {
            console.log('🔧 Iniciando prueba de navegación...');
            
            // Lista de URLs de prueba
            const testUrls = [
                'https://example.com',
                'https://httpbin.org/html',
                'https://www.wikipedia.org',
                'https://duckduckgo.com'
            ];
            
            // Mostrar diálogo de selección
            const selectedUrl = prompt(
                '🔧 Selecciona una URL de prueba:\n\n' +
                '1. Example.com (básica)\n' +
                '2. HTTPBin (test HTML)\n' +
                '3. Wikipedia\n' +
                '4. DuckDuckGo\n' +
                '5. URL personalizada\n\n' +
                'Ingresa el número (1-5) o una URL:'
            );
            
            let urlToTest = '';
            
            if (selectedUrl === '1') {
                urlToTest = testUrls[0];
            } else if (selectedUrl === '2') {
                urlToTest = testUrls[1];
            } else if (selectedUrl === '3') {
                urlToTest = testUrls[2];
            } else if (selectedUrl === '4') {
                urlToTest = testUrls[3];
            } else if (selectedUrl === '5') {
                urlToTest = prompt('Ingresa una URL personalizada:');
            } else if (selectedUrl && selectedUrl.includes('http')) {
                urlToTest = selectedUrl;
            } else {
                console.log('❌ Prueba cancelada');
                return;
            }
            
            if (urlToTest) {
                console.log('🌐 Navegando a URL de prueba:', urlToTest);
                navigate(urlToTest);
                
                // Mostrar información de debug después de 5 segundos
                setTimeout(() => {
                    showDebugInfo(urlToTest);
                }, 5000);
            }
        }
        
        // Función para mostrar información de debug
        function showDebugInfo(expectedUrl) {
            const activeTab = tabs.find(tab => tab.id === activeTabId);
            const debugInfo = {
                'URL Esperada': expectedUrl,
                'URL Actual': activeTab?.webview?.src || 'No disponible',
                'Pestaña Activa': activeTab?.id || 'No disponible',
                'Webview Existe': !!activeTab?.webview,
                'Webview Visible': activeTab?.webview?.style?.display || 'No disponible',
                'Contenedor Activo': document.getElementById('webviewContainer')?.classList?.contains('active')
            };
            
            console.table(debugInfo);
            
            alert(
                '🔍 Información de Debug:\n\n' +
                Object.entries(debugInfo)
                    .map(([key, value]) => `${key}: ${value}`)
                    .join('\n')
            );
        }
        
        // Función de diagnóstico completo de eventos
        function diagnoseClickEvents() {
            console.log('🔍 DIAGNÓSTICO DE EVENTOS DE CLICK:');
            
            // Verificar accesos rápidos
            const shortcuts = document.querySelectorAll('.homepage-shortcut-card');
            console.log(`📋 Encontrados ${shortcuts.length} accesos rápidos`);
            
            shortcuts.forEach((card, i) => {
                const onclick = card.getAttribute('onclick');
                const style = window.getComputedStyle(card);
                console.log(`🔸 Acceso ${i + 1}:`, {
                    onclick: onclick,
                    pointerEvents: style.pointerEvents,
                    cursor: style.cursor,
                    hasClickListener: !!card._clickHandler
                });
            });
            
            // Verificar pestañas
            const tabs = document.querySelectorAll('.tab');
            console.log(`📑 Encontradas ${tabs.length} pestañas`);
            
            // Verificar botones
            const buttons = document.querySelectorAll('button, .nav-button');
            console.log(`🔘 Encontrados ${buttons.length} botones`);
            
            // Test manual de click
            console.log('🧪 Para probar manualmente, ejecuta:');
            console.log('navigate("https://example.com")');
            console.log('testBrowserNavigation()');
        }
        
        // Exponer funciones globalmente para debugging
        window.diagnoseClickEvents = diagnoseClickEvents;
        window.navigate = navigate;
        window.testBrowserNavigation = testBrowserNavigation;

        // Capturar errores globales
        window.addEventListener('error', function(event) {
            console.error('💥 Error JavaScript:', event.error);
            console.error('📍 En archivo:', event.filename, 'línea:', event.lineno);
        });
        
    </script>
</body>
</html>
